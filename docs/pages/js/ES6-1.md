# QUES

[å°¾é€’å½’ä¼˜åŒ–ï¼ˆéä¸¥æ ¼æ¨¡å¼ï¼‰](https://wangdoc.com/es6/function.html#%E5%B0%BE%E9%80%92%E5%BD%92%E4%BC%98%E5%8C%96%E7%9A%84%E5%AE%9E%E7%8E%B0)

# å‰ç½®

## Babel

[Babel](https://babeljs.io/) æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ ES6 è½¬ç å™¨ï¼Œå¯ä»¥å°† ES6 ä»£ç è½¬ä¸º ES5 ä»£ç ï¼Œä»è€Œåœ¨è€ç‰ˆæœ¬çš„æµè§ˆå™¨æ‰§è¡Œ

```shell
npm install --save-dev @babel/core
```

### é…ç½®æ–‡ä»¶ .babelrc

å­˜æ”¾æ ¹ç›®å½•ä¸‹

```js
{
  "presets": [],
  "plugins": []
}
```

`presets`å­—æ®µè®¾å®šè½¬ç è§„åˆ™ï¼Œå®˜æ–¹æä¾›ä»¥ä¸‹çš„è§„åˆ™é›†

```shell
# æœ€æ–°è½¬ç è§„åˆ™
npm install --save-dev @babel/preset-env

# react è½¬ç è§„åˆ™
npm install --save-dev @babel/preset-react
```

```js
 {
    "presets": [
      "@babel/env",
      "@babel/preset-react"
    ],
    "plugins": []
  }
```

### @babel/cli

Babel æä¾›å‘½ä»¤è¡Œå·¥å…·`@babel/cli`ï¼Œç”¨äºå‘½ä»¤è¡Œè½¬ç 

```shell
npm install --save-dev @babel/cli
```

```shell
# è½¬ç ç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º
npx babel example.js

# è½¬ç ç»“æœå†™å…¥ä¸€ä¸ªæ–‡ä»¶
# --out-file æˆ– -o å‚æ•°æŒ‡å®šè¾“å‡ºæ–‡ä»¶
npx babel example.js --out-file compiled.js
# æˆ–è€…
npx babel example.js -o compiled.js

# æ•´ä¸ªç›®å½•è½¬ç 
# --out-dir æˆ– -d å‚æ•°æŒ‡å®šè¾“å‡ºç›®å½•
npx babel src --out-dir lib
# æˆ–è€…
npx babel src -d lib

# -s å‚æ•°ç”Ÿæˆsource mapæ–‡ä»¶
npx babel src -d lib -s
```

### @babel/node

`@babel/node`æ¨¡å—çš„`babel-node`å‘½ä»¤ï¼Œæä¾›ä¸€ä¸ªæ”¯æŒ ES6 çš„ REPL ç¯å¢ƒã€‚å®ƒæ”¯æŒ Node çš„ REPL ç¯å¢ƒçš„æ‰€æœ‰åŠŸèƒ½ï¼Œè€Œä¸”å¯ä»¥ç›´æ¥è¿è¡Œ ES6 ä»£ç ã€‚

```shell
npm install --save-dev @babel/node
```

è¿›å…¥ REPL ç¯å¢ƒ

```js
npx babel-node
> (x => x * 2)(1)
2
```

è¿è¡Œè„šæœ¬

```js
npx babel-node es6.js
2
```

### @babel/register

`@babel/register`æ¨¡å—æ”¹å†™`require`å‘½ä»¤ï¼Œä¸ºå®ƒåŠ ä¸Šä¸€ä¸ªé’©å­ã€‚æ­¤åï¼Œæ¯å½“ä½¿ç”¨`require`åŠ è½½`.js`ã€`.jsx`ã€`.es`å’Œ`.es6`åç¼€åçš„æ–‡ä»¶ï¼Œå°±ä¼šå…ˆç”¨ Babel è¿›è¡Œè½¬ç ã€‚

- åªä¼šå¯¹ require åŠ è½½å‘½ä»¤è½¬ç 
- å®æ—¶è½¬ç ï¼Œåªé€‚åˆå¼€å‘ç¯å¢ƒ

```shell
npm install --save-dev @babel/register
```

```js
// index.js
require('@babel/register')
require('./es6.js')
```

```js
node index.js
2
```

### ployfill

Babel é»˜è®¤è½¬ Javascript è¯­æ³•ï¼Œè€Œä¸è½¬ APIï¼Œå¦‚ Proxyã€Setã€Map ç­‰å…¨å±€å¯¹è±¡

```shell
$ npm install --save-dev core-js regenerator-runtime
```

ç¤ºä¾‹ï¼šArray.from çš„ Babel æ”¯æŒï¼Œä½¿ç”¨`core-js`å’Œ`regenerator-runtime`(åè€…æä¾› generator å‡½æ•°çš„è½¬ç )ï¼Œä¸ºå½“å‰ç¯å¢ƒæä¾›ä¸€ä¸ªå«ç‰‡

```js
import 'core-js'
import 'regenerator-runtime/runtime' // è¿›è¡Œ generator å‡½æ•°è½¬ç 
// æˆ–è€…
require('core-js')
require('regenerator-runtime/runtime')
```

Babel é»˜è®¤ä¸è½¬ç çš„ AP å¯ä»¥æŸ¥çœ‹`babel-plugin-transform-runtime`æ¨¡å—çš„[definitions.js](https://github.com/babel/babel/blob/master/packages/babel-plugin-transform-runtime/src/runtime-corejs3-definitions.js)æ–‡ä»¶ã€‚

### @babel/standalone

Babel ä¹Ÿå¯ä»¥ç”¨äºæµè§ˆå™¨ç¯å¢ƒ

```html
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
  // Your ES6 code
</script>
```

# ES6

## let å’Œ const

JS ä½œç”¨åŸŸï¼šå…¨å±€ä½œç”¨åŸŸï¼ˆvar å£°æ˜ï¼Œå˜é‡æå‡ï¼‰ã€å‡½æ•°ä½œç”¨åŸŸã€å—çº§ä½œç”¨åŸŸï¼ˆes6 æ–°å¢ï¼‰

### let

**let å…³é”®å­—**ï¼šå£°æ˜çš„å˜é‡åªåœ¨å½“å‰ä»£ç å—ä¸­ç”Ÿæ•ˆï¼ˆå—çº§ä½œç”¨åŸŸï¼‰

- å¯ä»¥é‡æ–°èµ‹å€¼
- ä¸èƒ½åœ¨åŒä¸€ä½œç”¨åŸŸé‡å¤å£°æ˜
- æ— å˜é‡æå‡ - é˜²æ­¢å˜é‡å£°æ˜å‰ä½¿ç”¨å˜é‡

è§£å†³é—®é¢˜ï¼š

- **è§£å†³ i ä¸¢å¤±**çš„é—®é¢˜ - ä¸åŒäº var**å…¨å±€æœ‰æ•ˆ**ï¼Œæ¯æ¬¡å¾ªç¯**let**éƒ½æ˜¯é‡æ–°å£°æ˜çš„å˜é‡
- å†…å±‚å˜é‡å¯èƒ½ä¼šè¦†ç›–å¤–å±‚å˜é‡
- æ›¿ä»£åŒ¿åå‡½æ•°

### const

const å£°æ˜ä¸ºåªè¯»å¸¸é‡ï¼Œå£°æ˜åä¸å¯æ”¹

- å¿…é¡»ç»™åˆå§‹å€¼
- åªåœ¨å£°æ˜æ‰€åœ¨çš„å—çº§ä½œç”¨åŸŸå†…æœ‰æ•ˆ
- å­˜åœ¨æš‚æ—¶æ€§æ­»åŒº

åªè¯»å¸¸é‡ï¼š**å˜é‡æŒ‡å‘çš„å†…å­˜åœ°å€ä¸èƒ½æ”¹åŠ¨**ï¼Œåªå½±å“ä¸€å±‚ã€‚

```js
const foo = {}

// ä¸º foo æ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œå¯ä»¥æˆåŠŸ
foo.prop = 123
foo.prop // 123

// å°† foo æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä¼šæŠ¥é”™
foo = {} // TypeError: "foo" is read-only
```

å¯¹è±¡å†»ç»“ï¼Œåº”è¯¥ä½¿ç”¨`Object.freeze`æ–¹æ³•ï¼Œå†»ç»“åæ·»åŠ æ–°å±æ€§ä¸èµ·ä½œç”¨

```js
const foo = Object.freeze({})

// å¸¸è§„æ¨¡å¼æ—¶ï¼Œä¸‹é¢ä¸€è¡Œä¸èµ·ä½œç”¨ï¼›
// ä¸¥æ ¼æ¨¡å¼æ—¶ï¼Œè¯¥è¡Œä¼šæŠ¥é”™
foo.prop = 123
```

ä¸åŒç±»å‹å€¼å­˜æ”¾æƒ…å†µ

æ™®é€šç±»å‹ï¼šå€¼ä¿å­˜åœ¨å˜é‡æŒ‡å‘å†…å­˜åœ°å€
å¼•ç”¨ç±»å‹ï¼šå˜é‡æŒ‡å‘å­˜æ”¾å®é™…æ•°æ®çš„æŒ‡é’ˆ

> å…­ç§å£°æ˜å˜é‡æ–¹æ³• ï¼š`varã€functionã€letã€constã€importã€class`

### æš‚æ—¶æ€§æ­»åŒº

ES6 è§„å®šï¼ŒåŒºå—ä¸­å­˜åœ¨`let`å’Œ`const`å‘½ä»¤ï¼ŒåŒºå—å¯¹`let const`å£°æ˜çš„å˜é‡ï¼Œå½¢æˆäº†å°é—­ä½œç”¨åŸŸã€‚å£°æ˜ä¹‹å‰å°±ä½¿ç”¨è¿™äº›å˜é‡ï¼Œå°±ä¼šæŠ¥é”™ï¼Œç§°ä¸º**æš‚æ—¶æ€§æ­»åŒº**ï¼ˆtemporal dead zoneï¼‰

**æœ¬è´¨**ï¼šè¿›å…¥ä½œç”¨åŸŸï¼Œå˜é‡å°±å·²ç»å­˜åœ¨äº†ï¼Œä½†æ˜¯ä¸å¯è·å–ï¼Œåªæœ‰å£°æ˜å˜é‡çš„é‚£ä¸€è¡Œä»£ç ä¹‹åï¼ˆtdz ç»“æŸï¼‰ï¼Œæ‰å¯ä»¥è·å–å’Œä½¿ç”¨è¯¥å˜é‡ã€‚

typeof ä¸å† ç™¾åˆ†ç™¾å®‰å…¨

```js
typeof x // ReferenceError
```

éšè”½çš„æ­»åŒº

```js
function bar(x = y, y = 2) {
  return [x, y]
}

bar() // æŠ¥é”™
```

```js
var x = x // ä¸æŠ¥é”™
let x = x // æŠ¥é”™
```

### å—çº§ä½œç”¨åŸŸ

#### ä¸ºä»€ä¹ˆéœ€è¦å—çº§ä½œç”¨åŸŸ

åœ¨å—çº§ä½œç”¨åŸŸå‡ºç°ä¹‹å‰ï¼Œä¼šå‡ºç°ä¸åˆç†åœºæ™¯ã€‚

ç¬¬ä¸€ç§åœºæ™¯ï¼Œå†…å±‚å˜é‡å¯èƒ½ä¼šè¦†ç›–å¤–å±‚å˜é‡ã€‚

```js
var tmp = new Date()

function f() {
  console.log(tmp)
  if (false) {
    var tmp = 'hello world'
  }
}

f() // undefined
```

ç¬¬äºŒç§åœºæ™¯ï¼Œå¾ªç¯å˜é‡æ³„éœ²ä¸ºå…¨å±€å˜é‡

```js
var s = 'hello'

for (var i = 0; i < s.length; i++) {
  console.log(s[i])
}

console.log(i) // 5
```

#### å—çº§ä½œç”¨åŸŸ

ES6 å…è®¸å—çº§ä½œç”¨åŸŸçš„ä»»æ„åµŒå¥—ï¼Œå¹¶ä¸”æ¯å±‚éƒ½æœ‰å•ç‹¬ä½œç”¨åŸŸ

```js
{
  {
    {
      {
        let insane = 'Hello World'
        {
          let insane = 'Hello World'
        }
      }
    }
  }
}
```

#### å—çº§ä½œç”¨åŸŸä¸å‡½æ•°å£°æ˜

ç¤ºä¾‹

```js
function f() {
  console.log('I am outside!')
}

;(function () {
  if (false) {
    function f() {
      console.log('I am inside!')
    }
  }
  f()
})()
```

ES5ï¼šè¾“å‡º I am inside!ï¼Œå®ƒå°† f å‡½æ•° æå‡åˆ°å‡½æ•°é¡¶éƒ¨

```js
;(function () {
  function f() {
    console.log('I am inside!')
  }
  if (false) {
  }
  f()
})()
```

ES6ï¼šæŠ¥é”™ Uncaught TypeError: f is not a functionã€‚éµå¾ªä»¥ä¸‹ä¸‰æ¡è§„åˆ™

- å…è®¸åœ¨å—çº§ä½œç”¨åŸŸå†…å£°æ˜å‡½æ•°ã€‚
- å‡½æ•°å£°æ˜ç±»ä¼¼äº`var`ï¼Œå³ä¼šæå‡åˆ°å…¨å±€ä½œç”¨åŸŸæˆ–å‡½æ•°ä½œç”¨åŸŸçš„å¤´éƒ¨ã€‚
- åŒæ—¶ï¼Œå‡½æ•°å£°æ˜è¿˜ä¼šæå‡åˆ°æ‰€åœ¨çš„å—çº§ä½œç”¨åŸŸçš„å¤´éƒ¨ã€‚

```js
;(function () {
  var f = undefined
  if (false) {
    function f() {
      console.log('I am inside!')
    }
  }
  f()
})()
```

**ES6 çš„å—çº§ä½œç”¨åŸŸå¿…é¡»æœ‰å¤§æ‹¬å·ï¼Œå¦‚æœæ²¡æœ‰å¤§æ‹¬å·ï¼ŒJavaScript å¼•æ“å°±è®¤ä¸ºä¸å­˜åœ¨å—çº§ä½œç”¨åŸŸã€‚**

### é¡¶å±‚å¯¹è±¡

é¡¶å±‚å±æ€§å’Œå…¨å±€å˜é‡æŒ‚é’©çš„é—®é¢˜

1. æ— æ³•åœ¨ç¼–è¯‘é˜¶æ®µæŠ¥å‡ºå˜é‡æœªå£°æ˜é”™è¯¯
2. è¯¯åˆ›å…¨å±€å˜é‡
3. é¡¶å±‚å¯¹è±¡å¯è¯»å†™ï¼Œä¸åˆ©äºæ¨¡å—åŒ–
4. window æœ‰å®ä½“æ„ä¹‰

ä» ES6 å¼€å§‹

`var`ã€`function`å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¾æ—§æ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§

`let`ã€`const`ã€`class`å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¸å±äºé¡¶å±‚å¯¹è±¡çš„å±æ€§

#### globalThis å¯¹è±¡

æµè§ˆå™¨ï¼šé¡¶å±‚å¯¹è±¡ `window`ï¼Œnode å’Œ Web Worker æ²¡æœ‰

æµè§ˆå™¨ã€Web Worker ï¼šé¡¶å±‚å¯¹è±¡`self`ï¼Œnode æ²¡æœ‰

Node ï¼šé¡¶å±‚å¯¹è±¡`global`ï¼Œå…¶ä»–ç¯å¢ƒæ²¡æœ‰

```js
// æ–¹æ³•ä¸€
typeof window !== 'undefined'
  ? window
  : typeof process === 'object' && typeof require === 'function' && typeof global === 'object'
  ? global
  : this

// æ–¹æ³•äºŒ
var getGlobal = function () {
  if (typeof self !== 'undefined') {
    return self
  }
  if (typeof window !== 'undefined') {
    return window
  }
  if (typeof global !== 'undefined') {
    return global
  }
  throw new Error('unable to locate global object')
}
```

ES2020 å¼•å…¥`globalThis`ä½œä¸ºé¡¶å±‚å¯¹è±¡ï¼ŒæŒ‡å‘å…¨å±€ç¯å¢ƒä¸‹çš„`this`ã€‚

## è§£æ„èµ‹å€¼

**è§£æ„**ï¼šè‡ªåŠ¨è§£ææ•°ç»„æˆ–å¯¹è±¡ä¸­çš„å€¼ï¼Œå¹¶èµ‹å€¼ç»™æŒ‡å®šçš„å˜é‡

### æ•°ç»„è§£æ„

**æŒ‰åºæ¬¡**æ’åˆ—ï¼Œè§£æ„ä¸æˆåŠŸ ï¼Œè¿”å› undefined

è§£æ„ç©ºæ•°ç»„ï¼ŒåŸæ ·è¿”å›

```js
let [a, b, c] = [1, 2, 3]
let [foo, [[bar], baz]] = [1, [[2], 3]]
let [, , third] = ['foo', 'bar', 'baz']
let [x, y, ...z] = ['a'] // a undefined []
let [a, [b], d] = [1, [2, 3], 4, 5] // éƒ¨åˆ†è§£æ„
```

ä¸èƒ½è§£æ„ä¸å¯å˜é‡å¯¹è±¡

```js
// æŠ¥é”™
let [foo] = 1
let [foo] = false
let [foo] = NaN
let [foo] = undefined
let [foo] = null
let [foo] = {}
```

#### é»˜è®¤å€¼

ES6 å†…éƒ¨ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ`===`ï¼‰ï¼Œåˆ¤æ–­ä¸€ä¸ªä½ç½®æ˜¯å¦æœ‰å€¼ï¼Œå°±æ˜¯åˆ¤æ–­æ˜¯å¦ä¸¥æ ¼ç­‰äº`undefined`ã€‚

```js
let [foo = true] = [] // æŒ‡å®šé»˜è®¤å€¼
```

å–é»˜è®¤å€¼ä¸ºæƒ°æ€§æ±‚å€¼

```js
let [x = f()] = [1]
```

```js
function f() {
  console.log('aaa')
}

let [x = f()] = [1] // xèƒ½è§£æ„åˆ°å€¼ï¼Œä¸ä¼šè¾“å‡ºaaa
```

é»˜è®¤å€¼å¼•ç”¨å…¶ä»–å˜é‡

```js
let [x = 1, y = x] = [] // x=1; y=1
let [x = 1, y = x] = [2] // x=2; y=2
let [x = 1, y = x] = [1, 2] // x=1; y=2
let [x = y, y = 1] = [] // ReferenceError: y is not defined
```

### å¯¹è±¡è§£æ„

å¯¹è±¡è§£æ„

1. è§£æ„æ— æ¬¡åºï¼Œä½†è¦ä¿è¯ è§£æ„åç§°ä¸å¯¹è±¡åç§°åŒå

2. è§£æ„ä¸æˆåŠŸ ï¼Œè¿”å› undefined

3. å¯ä»¥è§£æ„åŸå‹é“¾ä¸Šçš„å˜é‡

```javascript
// åŒåå˜é‡å¯ä»¥ç®€å†™
let { bar, foo } = { foo: 'aaa', bar: 'bbb' }
const { log } = console
```

å–åˆ«åï¼šçœŸæ­£èµ‹å€¼çš„å˜é‡æ˜¯åˆ«åï¼Œè€Œä¸æ˜¯åŸå§‹åç§°ã€‚

```js
let { first: f, last: l } = { first: 'hello', last: 'world' }

// first =>  error: is not undefined
// f => 'hello'
```

è§£æ„åµŒå¥—å¯¹è±¡

```js
let obj = {
  p: ['Hello', { y: 'World' }]
}

let {
  p,
  p: [x, { y }]
} = obj
x // "Hello"
y // "World"
p // ["Hello", {y: "World"}]
```

è¿›ä¸€æ­¥ç†è§£è§£æ„èµ‹å€¼ä¸­çš„**èµ‹å€¼**

```js
let obj = {}
let arr = []

;({ foo: obj.prop, bar: arr[0] } = { foo: 123, bar: true })

obj // {prop:123}
arr // [true]
```

#### é»˜è®¤å€¼

```js
var { x = 3 } = {}
x // 3

var { x: y = 3 } = {}
y // 3

var { x: y = 3 } = { x: 5 }
y // 5
```

#### æ³¨æ„ç‚¹

1. å¯¹å£°æ˜çš„å˜é‡è¿›è¡Œè§£æ„

```js
// é”™è¯¯çš„å†™æ³•
let x;
{x} = {x: 1}; // SyntaxError: syntax error

// æ­£ç¡®çš„å†™æ³•
let x;
({x} = {x: 1});
```

Javascript ä¼šå°† {x} ç†è§£ä¸ºä»£ç å—

2. å…è®¸ç­‰å·å·¦è¾¹çš„æ¨¡å¼ä¹‹ä¸­ï¼Œä¸æ”¾ç½®ä»»ä½•å˜é‡åã€‚ï¼ˆæ— æ„ä¹‰ï¼‰

```js
;({} = [true, false])
;({} = 'abc')
;({} = [])
```

3. æ•°ç»„æœ¬è´¨ä¸ºç‰¹æ®Šå¯¹è±¡ï¼Œå¯ä»¥å¯¹æ•°ç»„è¿›è¡Œå¯¹è±¡è§£æ„

```js
let arr = [1, 2, 3]
let { 0: first, [arr.length - 1]: last } = arr
first // 1
last // 3
```

### å­—ç¬¦ä¸²è§£æ„

```js
const [a, b, c, d, e] = 'hello'
let { length: len } = 'hello'
```

> å­—ç¬¦ä¸²ä¼šè¢«è½¬ä¸ºç±»ä¼¼æ•°ç»„çš„å¯¹è±¡

### æ•°å€¼å’Œå¸ƒå°”å€¼è§£æ„

è§£æ„èµ‹å€¼æ—¶ï¼Œç­‰å·å³è¾¹çš„å€¼**ä¸æ˜¯å¯¹è±¡æˆ–æ•°ç»„**ï¼Œåˆ™ä¼š**å…ˆè½¬ä¸ºå¯¹è±¡**ã€‚

`undefined`å’Œ`null`æ— æ³•è½¬ä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥è§£æ„èµ‹å€¼æŠ¥é”™

æ•°å€¼å’Œå¸ƒå°”å€¼çš„åŒ…è£…å¯¹è±¡éƒ½æœ‰`toString`å±æ€§

```js
let { toString: s } = 123
s === Number.prototype.toString // true

let { toString: s } = true
s === Boolean.prototype.toString // true
```

### å‡½æ•°å‚æ•°è§£æ„

```js
function add([x, y]) {
  // ...
}
add([1, 2]) // 3
// å«é»˜è®¤å€¼
function move({ x = 0, y = 0 } = {}) {
  return [x, y]
}
move({ x: 3, y: 8 }) // [3, 8]
move({ x: 3 }) // [3, 0]
move({}) // [0, 0]
move() // [0, 0]

function move({ x, y } = { x: 0, y: 0 }) {
  return [x, y]
}

move({ x: 3, y: 8 }) // [3, 8]
move({ x: 3 }) // [3, undefined]
move({}) // [undefined, undefined]
move() // [0, 0]
```

å‡½æ•°å‚æ•°ä½¿ç”¨è§£æ„æ•°ç»„/å¯¹è±¡ï¼Œè°ƒç”¨å‡½æ•°ä¸ä¼ å‚æ•°ä¼šæŠ¥é”™ã€‚ä¸èƒ½è§£æ„ undefined

```js
function fn([x, y, z]) {
  console.log(x, y, z)
}
fn() //ä¼šæŠ¥é”™
```

### åœ†æ‹¬å·é—®é¢˜

ä»¥ä¸‹**ä¸‰ç§æƒ…å†µ**ä¸ä½¿ç”¨åœ†æ‹¬å·

#### å˜é‡å£°æ˜è¯­å¥

å˜é‡å£°æ˜è¯­å¥ä¸èƒ½ä½¿ç”¨åœ†æ‹¬å·

```js
//  å…¨éƒ¨æŠ¥é”™
let [(a)] = [1];
let {x: (c)} = {};
let ({x: c}) = {};
let {(x: c)} = {};
let {(x): c} = {};
let { o: ({ p: p }) } = { o: { p: 2 } };
```

#### å‡½æ•°å‚æ•°

å‡½æ•°å‚æ•°ä¹Ÿå±äºå˜é‡å£°æ˜

```js
// æŠ¥é”™
function f([(z)]) { return z; }
// æŠ¥é”™
function f([z,(x)]) { return x; }
```

#### èµ‹å€¼è¯­å¥

```js
// å…¨éƒ¨æŠ¥é”™
({ p: a }) = { p: 42 };
([a]) = [5];
[({ p: a }), { x: c }] = [{}, {}];
```

#### å¯ä»¥ä½¿ç”¨åœ†æ‹¬å·

èµ‹å€¼è¯­å¥ï¼Œå¹¶ä¸”åœ†æ‹¬å·ä¸å±äºæ¨¡å¼ï¼ˆè§£æ„ï¼‰ä¸€éƒ¨åˆ†ã€‚

```js
;[b] = [3] // æ­£ç¡®
;({ p: d } = {}) // æ­£ç¡®
;[parseInt.prop] = [3] // æ­£ç¡®
```

ç¬¬ä¸€è¡Œè¯­å¥ä¸­ï¼Œæ¨¡å¼æ˜¯å–æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œè·Ÿåœ†æ‹¬å·æ— å…³ï¼›
ç¬¬äºŒè¡Œè¯­å¥ä¸­ï¼Œæ¨¡å¼æ˜¯`p`ï¼Œè€Œä¸æ˜¯`d`ï¼›
ç¬¬ä¸‰è¡Œè¯­å¥ä¸ç¬¬ä¸€è¡Œè¯­å¥çš„æ€§è´¨ä¸€è‡´ã€‚

### åº”ç”¨

**ï¼ˆ1ï¼‰äº¤æ¢å˜é‡çš„å€¼**

```js
;[x, y] = [y, x]
```

ï¼ˆ2ï¼‰ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼
ï¼ˆ3ï¼‰å‡½æ•°å‚æ•°çš„å®šä¹‰
ï¼ˆ4ï¼‰æå– JSON æ•°æ®
ï¼ˆ5ï¼‰å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼
**ï¼ˆ6ï¼‰éå† Map ç»“æ„**

```js
const map = new Map()
map.set('first', 'hello')
map.set('second', 'world')
for (let [key, value] of map) {
  console.log(key + ' is ' + value)
}
```

```js
// è·å–é”®å
for (let [key] of map) {
  // ...
}

// è·å–é”®å€¼
for (let [, value] of map) {
  // ...
}
```

ï¼ˆ7ï¼‰è¾“å…¥æ¨¡å—çš„æŒ‡å®šæ–¹æ³•

```js
const { SourceMapConsumer, SourceNode } = require('source-map')
```

## å­—ç¬¦ä¸²æ‰©å±•

### [å­—ç¬¦çš„unicode](https://wangdoc.com/es6/string.html#%E5%AD%97%E7%AC%A6%E7%9A%84-unicode-%E8%A1%A8%E7%A4%BA%E6%B3%95)

### å­—ç¬¦ä¸²éå†æ¥å£

ES6 ä¸ºå­—ç¬¦ä¸²æ·»åŠ äº†éå†å™¨æ¥å£ï¼Œä½¿å¾—å­—ç¬¦ä¸²å¯ä»¥è¢«`for...of`å¾ªç¯éå†ã€‚

```js
for (let codePoint of 'foo') {
  console.log(codePoint)
}
// "f"
// "o"
// "o"
```

for...of ä¼˜åŠ¿ï¼šè¯†åˆ« `0xFFFF`ç ç‚¹ï¼Œä¼ ç»Ÿ`for`æ— æ³•è¯†åˆ«

## [ç›´æ¥è¾“å…¥ U+2028 å’Œ U+2029](https://wangdoc.com/es6/string.html#%E7%9B%B4%E6%8E%A5%E8%BE%93%E5%85%A5-u2028-%E5%92%8C-u2029)

## [JSON.stringify() çš„æ”¹é€ ](https://wangdoc.com/es6/string.html#%E7%9B%B4%E6%8E%A5%E8%BE%93%E5%85%A5-u2028-%E5%92%8C-u2029)

`JSON.stringify()`çš„é—®é¢˜åœ¨äºï¼Œå®ƒå¯èƒ½è¿”å›`0xD800`åˆ°`0xDFFF`ä¹‹é—´çš„å•ä¸ªç ç‚¹ã€‚

[ES2019](https://github.com/tc39/proposal-well-formed-stringify) æ”¹å˜äº†`JSON.stringify()`çš„è¡Œä¸ºã€‚å¦‚æœé‡åˆ°`0xD800`åˆ°`0xDFFF`ä¹‹é—´çš„å•ä¸ªç ç‚¹ï¼Œæˆ–è€…ä¸å­˜åœ¨çš„é…å¯¹å½¢å¼ï¼Œå®ƒä¼š**è¿”å›è½¬ä¹‰å­—ç¬¦ä¸²**ã€‚

```js
// Non-BMP characters still serialize to surrogate pairs.
JSON.stringify('ğŒ†')
// â†’ '"ğŒ†"'
JSON.stringify('\uD834\uDF06')
// â†’ '"ğŒ†"'

// Unpaired surrogate code units will serialize to escape sequences.
JSON.stringify('\uDF06\uD834')
// â†’ '"\\udf06\\ud834"'
JSON.stringify('\uDEAD')
// â†’ '"\\udead"'
```

### å­—ç¬¦ä¸²æ¨¡æ¿

å•åŒå¼•å·å­—ç¬¦ä¸²ï¼šå‡ä¸è§£æå˜é‡ï¼Œéœ€è¦ä½¿ç”¨ + å·å°†å˜é‡æ‹¼æ¥åœ¨å­—ç¬¦ä¸²ä¸­

**å­—ç¬¦ä¸²æ¨¡æ¿**ï¼ˆæ¨¡æ¿å­—é¢é‡ï¼‰ï¼šå…è®¸ä½¿ç”¨åå¼•å·**``**æ¥åˆ›å»ºå­—ç¬¦ä¸²

1. ç©ºæ ¼æ¢è¡Œä¿ç•™

2. å˜é‡å†™åœ¨ `${}`ä¸­ï¼Œéå­—ç¬¦ä¸²ï¼Œå¦‚å¯¹è±¡ï¼Œè°ƒç”¨`toString()`

3. å¯ç”¨Jsè¡¨è¾¾å¼ï¼Œèƒ½è°ƒç”¨å‡½æ•°

```js
function fn() {
  return "Hello World";
}

`foo ${fn()} bar`
// foo Hello World bar
```

4. æ”¯æŒåµŒå¥—

```js
const tmpl = addrs => `
  <table>
  ${addrs.map(addr => `
    <tr><td>${addr.first}</td></tr>
    <tr><td>${addr.last}</td></tr>
  `).join('')}
  </table>
`;
```

5. å¼•ç”¨æœ¬èº«ï¼Œå†™æˆå‡½æ•°

```js
let func = (name) => `Hello ${name}!`;
func('Jack') // "Hello Jack!" å¼•ç”¨æœ¬èº«
```

### [æ¨¡æ¿ç¼–è¯‘](https://wangdoc.com/es6/string.html#%E5%AE%9E%E4%BE%8B%EF%BC%9A%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91)

```js
let template = `
<ul>
  <% for(let i=0; i < data.supplies.length; i++) { %>
    <li><%= data.supplies[i] %></li>
  <% } %>
</ul>
`;
```

å°†å…¶è½¬æ¢ä¸º javascript è¡¨è¾¾å¼

```js
echo('<ul>');
for(let i=0; i < data.supplies.length; i++) {
  echo('<li>');
  echo(data.supplies[i]);
  echo('</li>');
};
echo('</ul>');
```

ä½¿ç”¨éè´ªå©ªåŒ¹é…çš„åŸå› ï¼šä¿è¯ <% é‡è§ä¸‹ä¸€ä¸ª %>å°±åŒ¹é…ã€‚ 

```js
function compile(template){
  const evalExpr = /<%=(.+?)%>/g;
  const expr = /<%([\s\S]+?)%>/g; // éè´ªå©ªåŒ¹é… +?

  template = template
    .replace(evalExpr, '`); \n  echo( $1 ); \n  echo(`')
    .replace(expr, '`); \n $1 \n  echo(`');

  template = 'echo(`' + template + '`);';

  let script =
  `(function parse(data){
    let output = "";

    function echo(html){
      output += html;
    }

    ${ template }

    return output;
  })`;

  return script;
}
```

### æ ‡ç­¾æ¨¡æ¿

æ ‡ç­¾æ¨¡æ¿ï¼šå‡½æ•°è°ƒç”¨ç‰¹æ®Šå½¢å¼

æ¨¡æ¿å­—ç¬¦ä¸²å‰é¢æœ‰ä¸€ä¸ªæ ‡è¯†å`tag`ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æ•´ä¸ªè¡¨è¾¾å¼çš„è¿”å›å€¼ï¼Œå°±æ˜¯`tag`å‡½æ•°å¤„ç†æ¨¡æ¿å­—ç¬¦ä¸²åçš„è¿”å›å€¼

```js
let a = 5;
let b = 10;

tag`Hello ${ a + b } world ${ a * b }`;

// ç­‰åŒäº
tag(['Hello ', ' world ', ''], 15, 50);
```

å‚æ•°ä¸€ï¼š['Hello ', ' world ', '']

å‚æ•°äºŒï¼š15

å‚æ•°ä¸‰ï¼š50

```js
// ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•°ç»„ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²ä¸­æ²¡æœ‰è¢«å˜é‡æ›¿æ¢çš„éƒ¨åˆ†
// å…¶ä»–å‚æ•°ä¸ºæ›¿æ¢å˜é‡
function tag(stringArr, value1, value2){
  // ...
  // stringArr - ['hello ',' world ','']
  // value1 - 15
  // value2 - 50
}
// ç­‰åŒäº
function tag(stringArr, ...values){
  // ...
}
```

[é‡è¦åº”ç”¨](https://wangdoc.com/es6/string.html#%E6%A0%87%E7%AD%BE%E6%A8%A1%E6%9D%BF)ï¼š

- è¿‡æ»¤HTMLï¼Œé˜²æ­¢ç”¨æˆ·è¾“å…¥æ¶æ„å†…å®¹
- å¤šè¯­è¨€è½¬æ¢

### [æ¨¡æ¿å­—ç¬¦ä¸²é™åˆ¶](https://wangdoc.com/es6/string.html#%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E9%99%90%E5%88%B6)

## å­—ç¬¦ä¸²æ–°å¢æ–¹æ³•

### String.fromCodePoint()

ES5 - `String.fromCharCode()`ï¼šä»Unicodeç ç‚¹è¿”å›å­—ç¬¦ä¸²ã€‚

é—®é¢˜ï¼šä¸èƒ½è¯†åˆ«å¤§äº0xFFFFçš„å­—ç¬¦ï¼Œ`0x20BBF` èˆå¼ƒé«˜ä½å˜ä¸º `0x0BBF`

`String.fromCodePoint()`ï¼šä¸`codePointAt()`ç›¸åï¼Œå¤šä¸ªå‚æ•°ï¼Œåˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²

`fromCodePoint`å®šä¹‰åœ¨Stringå¯¹è±¡ä¸Šï¼Œ`codePointAt`å®šä¹‰åœ¨å­—ç¬¦ä¸²å¯¹è±¡ä¸Š

### String.raw()

ES6ä¸ºåŸç”Ÿ String å¯¹è±¡ æä¾› raw()æ–¹æ³•ã€‚

ä½œç”¨ï¼šè¿”å›æ–œæ éƒ½è¢«è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚å°†å˜é‡æ›¿æ¢ï¼Œå¯¹æ–œæ è½¬ä¹‰ã€‚

```js
String.raw`Hi\n${2+3}!`
// å®é™…è¿”å› "Hi\\n5!"ï¼Œæ˜¾ç¤ºçš„æ˜¯è½¬ä¹‰åçš„ç»“æœ "Hi\n5!"

// `foo${1 + 2}bar`
// ç­‰åŒäº
String.raw({ raw: ['foo', 'bar'] }, 1 + 2) // "foo3bar"
```

### å®åˆ—æ–¹æ³• - charCodeAt()

ES5 - `charAt()`ï¼šä»ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­è¿”å›æŒ‡å®šçš„å­—ç¬¦

ES5 - `charCodeAt()`ï¼šæ–¹æ³•è¿”å› `0` åˆ° `65535` ä¹‹é—´çš„æ•´æ•°ï¼Œè¡¨ç¤ºç»™å®šç´¢å¼•å¤„çš„ UTF-16 ä»£ç å•å…ƒ

JavaScript å†…éƒ¨ï¼Œå­—ç¬¦ä»¥ UTF-16 çš„æ ¼å¼å‚¨å­˜ï¼Œæ¯ä¸ªå­—ç¬¦å›ºå®šä¸º`2`ä¸ªå­—èŠ‚ã€‚

é—®é¢˜ï¼šæ— æ³•è§£å†³4ä¸ªå­—èŠ‚å­—ç¬¦ï¼ˆå¤§äº`0xFFFF`ï¼‰ï¼ŒJavaScript ä¼šè®¤ä¸ºå®ƒä»¬æ˜¯ä¸¤ä¸ªå­—ç¬¦ã€‚

`codePointAt()`ï¼šå¤„ç†4ä¸ªå­—èŠ‚å­˜å‚¨çš„å­—ç¬¦

ğ ®· - ç ç‚¹`0x20BB7`ï¼ŒUTF-16 ç¼–ç ä¸º`0xD842 0xDFB7`

```js
let s = 'ğ ®·a';

s.codePointAt(0) // 134071
s.codePointAt(1) // 57271

s.codePointAt(2) // 97
```

æµ‹è¯•ä¸€ä¸ªå­—ç¬¦ç”±ä¸¤ä¸ªå­—èŠ‚è¿˜æ˜¯ç”±å››ä¸ªå­—èŠ‚ç»„æˆ

```js
function is32Bit(c) {
  return c.codePointAt(0) > 0xFFFF;
}

is32Bit("ğ ®·") // true
is32Bit("a") // false
```

è¡¥å……ï¼šUnicode ã€UTF-8ã€UTF-8 [^1]

Unicodeï¼šä¸€ä¸ªç¬¦å·é›†ï¼Œ å®ƒåªè§„å®šäº†æ¯ä¸ªç¬¦å·çš„äºŒè¿›åˆ¶å€¼ã€‚å°†ä¸–ç•Œå„ç§è¯­è¨€çš„æ¯ä¸ªå­—ç¬¦å®šä¹‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–ç 

UTF-8ï¼šä¸€ç§å˜é•¿å­—ç¬¦ç¼–ç ï¼Œå°†ç ç‚¹ç¼–ç ä¸º 1 è‡³ 4 ä¸ªå­—èŠ‚ï¼Œå­—èŠ‚æ•°å–å†³äºç ç‚¹æ•°å€¼ä¸­æœ‰æ•ˆäºŒè¿›åˆ¶ä½çš„æ•°é‡

UTF-16ï¼šUTF-16 ä¹Ÿæ˜¯ä¸€ç§å˜é•¿å­—ç¬¦ç¼–ç , è¿™ç§ç¼–ç æ–¹å¼æ¯”è¾ƒç‰¹æ®Š, å®ƒå°†å­—ç¬¦ç¼–ç æˆ 2 å­—èŠ‚ æˆ–è€… 4 å­—èŠ‚

### å®ä¾‹æ–¹æ³• - [normalize()](https://wangdoc.com/es6/string-methods.html#%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95normalize)

`normalize()`ï¼šå°†å­—ç¬¦çš„ä¸åŒè¡¨ç¤ºæ–¹æ³•ç»Ÿä¸€ä¸ºåŒæ ·çš„å½¢å¼ï¼Œè¿™ç§°ä¸º Unicode æ­£è§„åŒ–

### å®ä¾‹æ–¹æ³• - includes()ï¼ŒstartsWith()ï¼ŒendsWith()

**es5** - `indexOf()`ï¼šæŸ¥æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åœ¨é‡Œä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚

é—®é¢˜ï¼šä¸å¤Ÿç›´è§‚ï¼Œè¿”å›çš„ number

`includes(string, number)`ï¼š**æ‰¾åˆ°string**ï¼Œnumberä¸ºèµ·å§‹ä½ç½®

`startsWith(string, number)`ï¼š**ä»¥stringå¼€å¤´**çš„å­—ç¬¦ä¸²ï¼Œnumberä¸ºèµ·å§‹ä½ç½®

`endsWith(string, number)`ï¼š**ä»¥stringç»“å°¾**çš„å­—ç¬¦ä¸²ï¼Œnumberä¸ºå‰nä¸ªå­—ç¬¦

```js
let s = 'Hello world!';

s.startsWith('world', 6) // true
s.endsWith('Hello', 5) // true
s.includes('Hello', 6) // false
```

> å‡è¿”å› boolean

### å®ä¾‹æ–¹æ³• - repeat()

`repeat()`ï¼šè¿”å›æ–°å­—ç¬¦ä¸²ï¼ŒåŸå­—ç¬¦ä¸²é‡å¤næ¬¡

- nä¸º`å°æ•°`ï¼Œå–æ•´
- nä¸º`è´Ÿæ•°`ï¼Œ`infinity`æŠ¥é”™
- nä¸º`-1~0`ï¼Œ`NaN` ï¼Œå‡ä¸º0ï¼Œè¿”å›ç©ºå€¼

```js
'hello'.repeat(2) // "hellohello"
'na'.repeat(0) // ""
'na'.repeat(NaN) // ""
```

```js
// 1.å°æ•°ç‚¹å–æ•´
'na'.repeat(-0.9) // ""
// 2.è´Ÿæ•°å’Œ Infinity æŠ¥é”™
'na'.repeat(Infinity) // RangeError
'na'.repeat(-1) // RangeError
// 3.å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—
'na'.repeat('na') // ""
'na'.repeat('3') // "nanana"
```

### å®ä¾‹æ–¹æ³• - padStart()ï¼ŒpadEnd()

`padStart()`ï¼šå¤´éƒ¨è¡¥å…¨

- å‚æ•°1ï¼šè¡¥å…¨æœ€å¤§é•¿åº¦
- å‚æ•°2ï¼šè¡¥å…¨å­—ç¬¦ä¸²ï¼ˆé»˜è®¤ç©ºæ ¼ï¼‰

è¡¥å…¨è§„åˆ™

1. **å¤§äºç­‰äº**é•¿åº¦ï¼Œè¿”å›åŸä¸²

2. **è¡¥å…¨é•¿åº¦ + åŸä¸² > æœ€å¤§é•¿åº¦**ï¼Œæˆªå–è¡¥å…¨å­—ç¬¦ä¸²

```js
'x'.padStart(5, 'ab') // 'ababx'
'x'.padEnd(5, 'ab') // 'xabab'

'xxx'.padStart(2, 'ab') // 'xxx'
'xxx'.padEnd(2, 'ab') // 'xxx'

'abc'.padStart(10, '0123456789') // '0123456abc'
```

`padEnd()`ï¼šå°¾éƒ¨è¡¥å…¨ï¼ŒåŒä¸Š

ç”¨é€”

1. æ•°å€¼è¡¥0

```js
'123456'.padStart(10, '0') // "0000123456"
```

2. å­—ç¬¦ä¸²æ ¼å¼æç¤º

```js
'09-12'.padStart(10, 'YYYY-MM-DD') // "YYYY-09-12"
```

### å®ä¾‹æ–¹æ³• - trimStart(),trimEnd()

`trimStart()`ï¼šæ¶ˆé™¤å¤´éƒ¨ç©ºæ ¼

`trimEnd()`ï¼šæ¶ˆé™¤å°¾éƒ¨ç©ºæ ¼

> è¿”å›æ–°å­—ç¬¦ä¸²

### å®ä¾‹æ–¹æ³• - matchAll()

ES5 - `regexp.exec()`ï¼šè·å–åŒ¹é…é¡¹ä¿¡æ¯

è·å–æ‰€æœ‰åŒ¹é…é¡¹ï¼Œéœ€è¦å¾ªç¯

```js
const regexp = RegExp('foo[a-z]*','g');
const str = 'table football, foosball';
let match;

while ((match = regexp.exec(str)) !== null) {
  console.log(`Found ${match[0]} start=${match.index} end=${regexp.lastIndex}.`);
  // expected output: "Found football start=6 end=14."
  // expected output: "Found foosball start=16 end=24."
}
```

ES2020 - `matchAll()`ï¼š**è¿”å›**ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åœ¨å½“å‰å­—ç¬¦ä¸²çš„**æ‰€æœ‰åŒ¹é…**

```js
const regexp = RegExp('foo[a-z]*','g');
const str = 'table football, foosball';
const matches = str.matchAll(regexp);

for (const match of matches) {
  console.log(`Found ${match[0]} start=${match.index} end=${match.index + match[0].length}.`);
}
// expected output: "Found football start=6 end=14."
// expected output: "Found foosball start=16 end=24."
```

> æ²¡æœ‰ `/g` æ ‡å¿—ï¼Œ`matchAll` ä¼šæŠ›å‡ºå¼‚å¸¸

### å®ä¾‹æ–¹æ³• - replaceAll()

ES5 - `replace()`ï¼šå°†åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œç”¨æŒ‡å®šå­—ç¬¦ä¸²æ›¿æ¢

```js
'aabbcc'.replace('b', '_') // æ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…
'aabbcc'.replace(/b/g, '_') // æ›¿æ¢æ‰€æœ‰åŒ¹é…
```

`replaceAll( searchValue, replacement)`ï¼šæ‰€æœ‰åŒ¹é…çš„å­—ç¬¦ä¸²æ›¿æ¢

searchValue - å­—ç¬¦ä¸² or **å…¨å±€**æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå¸¦`g`ä¿®é¥°ç¬¦ï¼Œä¸å¸¦æŠ¥é”™ï¼‰

replacement - å­—ç¬¦ä¸² or å‡½æ•°ï¼Œæ ‡è¯†æ›¿æ¢æ–‡æœ¬ã€‚

- å­—ç¬¦ä¸²
  - `$&`ï¼šåŒ¹é…çš„**å­å­—ç¬¦ä¸²**ã€‚
  - **$`**ï¼šåŒ¹é…ç»“æœ**å‰é¢**çš„æ–‡æœ¬ã€‚
  - `$'`ï¼šåŒ¹é…ç»“æœ**åé¢**çš„æ–‡æœ¬ã€‚
  - `$n`ï¼šåŒ¹é…æˆåŠŸçš„ç¬¬`n`ç»„å†…å®¹ï¼ˆ**nä»1**å¼€å§‹ï¼‰ï¼Œå‰ææ˜¯ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚
  - `$$`ï¼šæŒ‡ä»£ç¾å…ƒç¬¦å·`$`ã€‚

```js
// $& è¡¨ç¤ºåŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œå³`b`æœ¬èº«
// æ‰€ä»¥è¿”å›ç»“æœä¸åŸå­—ç¬¦ä¸²ä¸€è‡´
'abbc'.replaceAll('b', '$&')
// 'abbc'

// $` è¡¨ç¤ºåŒ¹é…ç»“æœä¹‹å‰çš„å­—ç¬¦ä¸²
// å¯¹äºç¬¬ä¸€ä¸ª`b`ï¼Œ$` æŒ‡ä»£`a`
// å¯¹äºç¬¬äºŒä¸ª`b`ï¼Œ$` æŒ‡ä»£`ab`
'abbc'.replaceAll('b', '$`')
// 'aaabc'

// $' è¡¨ç¤ºåŒ¹é…ç»“æœä¹‹åçš„å­—ç¬¦ä¸²
// å¯¹äºç¬¬ä¸€ä¸ª`b`ï¼Œ$' æŒ‡ä»£`bc`
// å¯¹äºç¬¬äºŒä¸ª`b`ï¼Œ$' æŒ‡ä»£`c`
'abbc'.replaceAll('b', `$'`)
// 'abccc'

// $1 è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªç»„åŒ¹é…ï¼ŒæŒ‡ä»£`ab`
// $2 è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„ç¬¬äºŒä¸ªç»„åŒ¹é…ï¼ŒæŒ‡ä»£`bc`
'abbc'.replaceAll(/(ab)(bc)/g, '$2$1')
// 'bcab'

// $$ æŒ‡ä»£ $
'abc'.replaceAll('b', '$$')
// 'a$c'
```

- å‡½æ•°

```js
const str = '123abc456';
const regex = /(\d+)([a-z]+)(\d+)/g;
/*
params #1 - åŒ¹é…å†…å®¹
params #2 - æ•æ‰åˆ°æ˜¯ç»„åŒ¹é…ï¼ˆæœ‰å¤šå°‘ä¸ªç»„åŒ¹é…ï¼Œå°±æœ‰å¤šå°‘ä¸ªå¯¹åº”çš„å‚æ•°ï¼‰
...
params #n-1 - æ•è·å†…å®¹åœ¨å­—ç¬¦ä¸²ä½ç½®
parmas #n - åŸå­—ç¬¦ä¸²
*/
function replacer(match, p1, p2, p3, offset, string) {
  return [p1, p2, p3].join(' - ');
}
str.replaceAll(regex, replacer)
// 123 - abc - 456
```

### å®ä¾‹æ–¹æ³• - at()

`at()`ï¼šæ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›å‚æ•°æŒ‡å®šä½ç½®çš„å­—ç¬¦ã€‚ï¼ˆæ”¯æŒè´Ÿç´¢å¼•ï¼‰

```js
const str = 'hello';
str.at(1) // "e"
str.at(-1) // "o"
str.at(1111) // undefined
```

> è¶…å‡ºèŒƒå›´ï¼Œè¿”å›undefined

## æ­£åˆ™æ‰©å±•

### RegExpæ„é€ å‡½æ•°

ES5 - RegExp æœ‰ä¸¤ç§å½¢å¼æ„é€ å‚æ•°

å­—ç¬¦ä¸² + ä¿®é¥°ç¬¦

```js
var regex = new RegExp('xyz', 'i');
// ç­‰ä»·äº
var regex = /xyz/i;
```

æ­£åˆ™è¡¨è¾¾å¼

```js
var regex = new RegExp(/xyz/i);
// ç­‰ä»·äº
var regex = /xyz/i;
```

ES6 - å¼•å…¥ç¬¬ä¸‰ç§æƒ…å†µï¼Œæ­£åˆ™è¡¨è¾¾å¼ + ä¿®é¥°ç¬¦

```js
var regex = new RegExp(/abc/ig, 'i')
regex.flags // i
```

>  `flag`ä¼šè¦†ç›–åŸæœ‰ä¿®é¥°ç¬¦

### å­—ç¬¦ä¸²æ­£åˆ™æ–¹æ³•

ES5 - `match()`ã€`replace()`ã€`search()`ã€`split()`

ES6 - å°†Stringå¯¹è±¡æ–¹æ³•å…³è”åˆ°  RegExpå¯¹è±¡

- `String.prototype.match` è°ƒç”¨ `RegExp.prototype[Symbol.match]`
- `String.prototype.replace` è°ƒç”¨ `RegExp.prototype[Symbol.replace]`
- `String.prototype.search` è°ƒç”¨ `RegExp.prototype[Symbol.search]`
- `String.prototype.split` è°ƒç”¨ `RegExp.prototype[Symbol.split]`

*ES2020* - `String.prototype.matchAll()`ï¼šä¸€æ¬¡æ€§å–å‡ºæ‰€æœ‰åŒ¹é…ã€‚

è¿”å›å€¼ï¼šéå†å™¨ï¼ˆIteratorï¼‰ï¼Œè€Œä¸æ˜¯æ•°ç»„ã€‚

```js
const string = 'test1test2test3';
const regex = /t(e)(st(\d?))/g;

for (const match of string.matchAll(regex)) {
  console.log(match);
}
// ["test1", "e", "st1", "1", index: 0, input: "test1test2test3"]
// ["test2", "e", "st2", "2", index: 5, input: "test1test2test3"]
// ["test3", "e", "st3", "3", index: 10, input: "test1test2test3"]
```

### [u ä¿®é¥°ç¬¦](https://wangdoc.com/es6/regex.html#u-%E4%BF%AE%E9%A5%B0%E7%AC%A6)

`u`ä¿®é¥°ç¬¦ï¼šç”¨æ¥æ­£ç¡®å¤„ç†å¤§äº`\uFFFF`çš„ Unicode å­—ç¬¦

```js
/^\uD83D/u.test('\uD83D\uDC2A') // false
/^\uD83D/.test('\uD83D\uDC2A') // true
```

### RegExp.prototype.unicode å±æ€§

`unicode`å±æ€§ï¼šè¡¨ç¤ºæ˜¯å¦è®¾ç½®äº†`u`ä¿®é¥°ç¬¦

```js
const r1 = /hello/;
const r2 = /hello/u;

r1.unicode // false
r2.unicode // true
```

### y ä¿®é¥°ç¬¦

y ä¿®é¥°ç¬¦ï¼ˆç²˜è¿ä¿®é¥°ç¬¦ï¼‰ï¼šå…¨å±€åŒ¹é…ä¸­åä¸€æ¬¡åŒ¹é…éƒ½ä»ä¸Šä¸€æ¬¡åŒ¹é…æˆåŠŸçš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹ã€‚

> gä¿®é¥°ç¬¦ åœ¨å‰©ä½™ä½ç½®ä¸­å–

`lastIndex`å±æ€§ï¼šæ¯æ¬¡æœç´¢å¼€å§‹ä½ç½®

```js
var s = 'aaa_aa_a';
var r1 = /a+/g;
var r2 = /a+/y;

r1.exec(s) // ["aaa"] r1.lastIndex = 0
r1.exec(s) // ["aa"] r1.lastIndex = 3

r2.exec(s) // ["aaa"] r2.lastIndex = 0
r2.exec(s) // null r2.lastIndex = 3
```

```js
const REGEX = /a/gy;
'aaxa'.replace(REGEX, '-') // '--xa'
```

```js
'a1a2a3'.match(/a\d/y) // ["a1"]
'a1a2a3'.match(/a\d/gy) // ["a1", "a2", "a3"]
```

> ==@DIF== -  `y` ä¸ä¼šå¿½ç•¥éæ³•å­—ç¬¦

### RegExp.prototype.sticky å±æ€§

`sticky`å±æ€§ï¼šè¡¨ç¤ºæ˜¯å¦è®¾ç½®äº†`y`ä¿®é¥°ç¬¦

```js
var r = /hello\d/y;
r.sticky // true
```

### RegExp.prototype.flags å±æ€§

`flags`å±æ€§ï¼šä¼šè¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦

```js
// ES5 çš„ source å±æ€§
// è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„æ­£æ–‡
/abc/ig.source
// "abc"

// ES6 çš„ flags å±æ€§
// è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦
/abc/ig.flags
// 'gi'
```

### [s ä¿®é¥°ç¬¦ï¼šdotAll æ¨¡å¼](https://wangdoc.com/es6/regex.html#s-%E4%BF%AE%E9%A5%B0%E7%AC%A6%EF%BC%9Adotall-%E6%A8%A1%E5%BC%8F)

`Â·`ï¼šä»£è¡¨ä»»æ„å•ä¸ªå­—ç¬¦ã€‚å­˜åœ¨ä¸¤ä¸ªä¾‹å¤–

1. UTF-16å­—ç¬¦
2. è¡Œç»ˆæ­¢ç¬¦ï¼Œå¦‚ä¸‹

- U+000A æ¢è¡Œç¬¦ï¼ˆ`\n`ï¼‰
- U+000D å›è½¦ç¬¦ï¼ˆ`\r`ï¼‰
- U+2028 è¡Œåˆ†éš”ç¬¦ï¼ˆline separator
- U+2029 æ®µåˆ†éš”ç¬¦ï¼ˆparagraph separatorï¼‰

```js
/foo.bar/.test('foo\nbar')
// false
/foo[^]bar/.test('foo\nbar')
// true
```

ES2018 - `s`ä¿®é¥°ç¬¦ï¼šä½¿å¾—`.`å¯ä»¥åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦

```js
// es2018
/foo.bar/s.test('foo\nbar'); // true
```

è¿™è¢«ç§°ä¸º`dotAll`æ¨¡å¼ï¼Œå³ç‚¹ï¼ˆdotï¼‰ä»£è¡¨ä¸€åˆ‡å­—ç¬¦ã€‚

`dotAll`å±æ€§ï¼šæ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦å¤„åœ¨`dotAll`æ¨¡å¼

```js
const re = /foo.bar/s;
// å¦ä¸€ç§å†™æ³•
// const re = new RegExp('foo.bar', 's');

re.test('foo\nbar') // true
re.dotAll // true
re.flags // 's'
```

### æ–­è¨€

å…ˆè¡Œæ–­è¨€ ï¼š`x`åªæœ‰åœ¨`y`å‰é¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ`/x(?=y)/`

```js
/\d+(?=%)/.exec('100% of US presidents have been male');  // ["100"]
```

å…ˆè¡Œå¦å®šæ–­è¨€ï¼š`x`åªæœ‰ä¸åœ¨`y `å‰é¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ`/x(?!y)/`

```js
/\d+(?!%)/.exec('thatâ€™s all 44 of them');                 // ["44"]
```

 ES2018 - å¼•å…¥

åè¡Œæ–­è¨€ï¼š`x`åªæœ‰åœ¨`y`åé¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ`/(?<=y)x/`

```js
/(?<=\$)\d+/.exec('Benjamin Franklin is on the $100 bill');  // ["100"]
```

åè¡Œå¦å®šæ–­è¨€ ï¼š`x`åªæœ‰ä¸åœ¨`y`åé¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ`/(?<!y)x/`

```js
/(?<!\$)\d+/.exec('itâ€™s is worth about â‚¬90');                // ["90"]
```

åè¡Œæ–­è¨€ç»„åŒ¹é…ï¼šå…ˆåŒ¹é…`/(?<=y)x/`çš„`x`ï¼Œç„¶åå†å›åˆ°å·¦è¾¹ï¼ŒåŒ¹é…`y`çš„éƒ¨åˆ†ï¼Œ**å…ˆå³å†å·¦**

```js
// åŒ¹é…åœ¨(\d+)(\d+)åé¢çš„ä¸²ï¼Œç¬¬2ä¸ª(\d+)å…ˆè´ªå©ªåŒ¹é…
/(?<=(\d+)(\d+))$/.exec('1053'); // ["", "1", "053"]
// ç¬¬1ä¸ª(\d+)å…ˆè´ªå©ªåŒ¹é…
/^(\d+)(\d+)$/.exec('1053'); // ["1053", "105", "3"]
```

ä¸Šé¢ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹éƒ½æ˜¯è´ªå©ªåŒ¹é…ï¼Œ053 å’Œ 105 ï¼Œåªæ˜¯é¡ºåºä¸åŒ

è¡¥å……ï¼š`/(?<=(\d+)(\d+))$/` - æ•´ä¸ªè¡¨è¾¾å¼éƒ½ä¸ºæ–­è¨€ï¼Œæ‰€ä»¥æœªåŒ¹é…åˆ°ä¸²

```js
/(?<=(\d+)(\d+))1$/.exec('1053'); // ["1", "0", "53"]
```

*åæ–œæ å¼•ç”¨*ï¼Œ**ä¹Ÿ**ä¸é€šå¸¸çš„é¡ºåº**ç›¸å**

```js
/(?<=(o)d\1)r/.exec('hodor');  // null
/(?<=\1d(o))r/.exec('hodor');  // ["r", "o"]
```

è¡¥å……ï¼š\1 è¡¨ç¤º ç¬¬ä¸€ä¸ªæ•è·å€¼ã€‚åè¡Œæ–­è¨€ä»å³å¾€å·¦ï¼Œç¬¬ä¸€è¡Œä»£ç ï¼Œ\1 åœ¨  (\d) ä¹‹å‰ï¼ˆæ•è·å€¼åœ¨ æ•è·ä¹‹å‰ï¼‰ï¼Œæ‰€ä»¥æ— æ³•åŒ¹é…ã€‚

### [Unicode å±æ€§ç±»](https://wangdoc.com/es6/regex.html#unicode-%E5%B1%9E%E6%80%A7%E7%B1%BB)

### å…·åç»„åŒ¹é…

ä½¿ç”¨åœ†æ‹¬å·è¿›è¡Œç»„åŒ¹é…

```js
const RE_DATE = /(\d{4})-(\d{2})-(\d{2})/;

const matchObj = RE_DATE.exec('1999-12-31');
const year = matchObj[1]; // 1999
const month = matchObj[2]; // 12
const day = matchObj[3]; // 31
```

ES2018 - å…·åç»„åŒ¹é…

è¯­æ³•ï¼š`?<ç»„å>`

ä¸ºæ¯ä¸€ç»„åŒ¹é…æŒ‡å®šä¸€ä¸ªåç§°ï¼ŒæœªåŒ¹é…å€¼ä¸º`undefined`

```js
const RE_DATE = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/;

const matchObj = RE_DATE.exec('1999-12-31');
const year = matchObj.groups.year; // "1999"
const month = matchObj.groups.month; // "12"
const day = matchObj.groups.day; // "31"

// const {groups: {year, month}} = RE_DATE.exec('1999-12-31');
```

å¼•ç”¨ç»„å

è¯­æ³•ï¼š`$<ç»„å>`

```js
let re = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/u;

// params#2 String
'2015-01-02'.replace(re, '$<day>/$<month>/$<year>')
// '02/01/2015'

// params#2 Function
'2015-01-02'.replace(re, (
   matched, // æ•´ä¸ªåŒ¹é…ç»“æœ 2015-01-02
   capture1, // ç¬¬ä¸€ä¸ªç»„åŒ¹é… 2015
   capture2, // ç¬¬äºŒä¸ªç»„åŒ¹é… 01
   capture3, // ç¬¬ä¸‰ä¸ªç»„åŒ¹é… 02
   position, // åŒ¹é…å¼€å§‹çš„ä½ç½® 0
   S, // åŸå­—ç¬¦ä¸² 2015-01-02
   groups // å…·åç»„æ„æˆçš„ä¸€ä¸ªå¯¹è±¡ {year, month, day}
 ) => {
 let {day, month, year} = groups;
 return `${day}/${month}/${year}`;
});
```

å†…éƒ¨åº”ç”¨

è¯­æ³•ï¼š`k<ç»„å>`

æ­£åˆ™è¡¨è¾¾å¼å†…éƒ¨å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨ `\1`è¿›è¡Œæ•è·

```js
const RE_TWICE = /^(?<word>[a-z]+)!\k<word>!\1$/;
RE_TWICE.test('abc!abc!abc') // true
RE_TWICE.test('abc!abc!ab') // false
```

### æ­£åˆ™åŒ¹é…ç´¢å¼•

`exec()`è¿”å›indexå±æ€§ï¼šè·å–æ•´ä¸ªåŒ¹é…ç»“æœå¼€å§‹ä½ç½®ã€‚

é—®é¢˜ï¼šåŒ…å«ç»„åŒ¹é…ï¼Œæ— æ³•æ‹¿åˆ°æ¯ä¸ªç»„çš„å¼€å§‹ä½ç½®

```js
const text = 'zabbcdef';
const re = /ab+(cd(ef))/;
const result = re.exec(text);

result.index // 1
result.indices // [ [1, 8], [4, 8], [6, 8] ]
```

å…·ååŒ¹é…ï¼šindices ä¼šåŒ…å« groups å±æ€§

```js
const text = 'zabbcdef';
const re = /ab+(?<Z>cd)/;
const result = re.exec(text);

result.indices.groups // { Z: [ 4, 6 ] }
```

## æ•°å€¼æ‰©å±•

### äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶

äºŒè¿›åˆ¶æ•°ï¼ˆ`0bï¼Œ0B`ï¼‰ï¼Œå…«è¿›åˆ¶æ•°ï¼ˆ`0oï¼Œ0O`ï¼‰

```js
// éä¸¥æ ¼æ¨¡å¼
(function(){
  console.log(0o11 === 011);
})() // true

// ä¸¥æ ¼æ¨¡å¼
(function(){
  'use strict';
  console.log(0o11 === 011);
})() // Uncaught SyntaxError: Octal literals are not allowed in strict mode.
```

äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶è½¬åè¿›åˆ¶

```js
Number('0b111')  // 7
Number('0o10')  // 8
```

### æ•°å€¼åˆ†éš”ç¬¦

ES2021 - å…è®¸ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†å‰²å­—ç¬¦

```js
let budget = 1_000_000_000_000;
budget === 10 ** 12 // true
```

åˆ†å‰²æ•°é‡å¯ä»¥éšæ„ï¼Œå°æ•°ç§‘å­¦è®¡æ•°æ³•ä¹Ÿé€‚ç”¨

```js
12345_00 === 1_234_500 // true
// å°æ•°
0.000_001
// ç§‘å­¦è®¡æ•°æ³•
1e10_000
```

ä¸‹åˆ’çº¿ä½ç½®éœ€æ»¡è¶³ä»¥ä¸‹æ¡ä»¶

- ä¸èƒ½åœ¨æœ€å‰æˆ–æœ€å
- ä¸èƒ½è¿ç»­æ”¾ç½®
- å°æ•°ç‚¹çš„å‰åä¸èƒ½æœ‰åˆ†éš”ç¬¦
- ç§‘å­¦è®¡æ•°æ³•ï¼Œè¡¨ç¤ºæŒ‡æ•°çš„`e`æˆ–`E`å‰åä¸èƒ½æœ‰åˆ†éš”ç¬¦
- è¿›åˆ¶å‰ç¼€å‰åä¸èƒ½æœ‰åˆ†éš”ç¬¦

```js
// å…¨éƒ¨æŠ¥é”™
_1464301
1464301_
123__456
3_.141
3._141
1_e12
1e_12
0_b111111000
0b_111111000
```

åªæ˜¯**ä¹¦å†™ä¾¿åˆ©**ï¼Œæ²¡æœ‰å®è´¨æ„ä¹‰ã€‚ä¹Ÿä¸èƒ½è¿›è¡Œç”¨äºè§£æã€‚

```js
let num = 12_345;

num // 12345
num.toString() // 12345

Number(123_456) // 123456
Number('123_456') // NaN
parseInt('123_456') // 123
```

### Numberå¯¹è±¡

ç›®çš„ï¼šå‡å°‘å…¨å±€æ–¹æ³•ï¼Œè¯­è¨€é€æ¸æ¨¡å—åŒ–

#### Number.isFinite()

`Number.isFinite()`ï¼šæ•°å€¼**æ˜¯å¦ä¸ºæœ‰é™çš„**(finite)ï¼Œå³ä¸æ˜¯Infinitã€NaNã€‚å‚æ•°ä¸ä¸ºNumberï¼Œè¿”å›false

å…¨å±€æ–¹æ³•ä¸­çš„isFiniteï¼Œä¼šå°†å‚æ•°å‘Numberè¿›è¡Œéšå¼è½¬åŒ–

```js
Number.isFinite(15); // true
Number.isFinite(0.8); // true
Number.isFinite(NaN); // false
Number.isFinite(Infinity); // false
Number.isFinite(-Infinity); // false
Number.isFinite('foo'); // false
Number.isFinite('15'); // false
Number.isFinite(true); // false

isFinite('15'); // true
```

#### Number.isNaN()

`Number.isNaN()`ï¼šæ£€æµ‹å€¼**æ˜¯å¦ä¸ºNaN**ï¼Œå‚æ•°ç±»å‹ä¸æ˜¯NaNï¼Œè¿”å›false

å…¨å±€æ–¹æ³•ä¸­isNaNä¹Ÿä¼šå‘Numberéšå¼è½¬æ¢

```js
Number.isNaN(NaN) // true
Number.isNaN("NaN") // false
Number.isNaN(1) // false

isNaN(NaN) // true
isNaN("NaN") // true
```



#### Number.parseInt()ã€Number.parseFloat()

`Number.parseInt()`ï¼Œ`Number.parseFloat()`ä¸å…¨å±€æ–¹æ³•è¡Œä¸ºä¸€è‡´ã€‚

```js
// ES5çš„å†™æ³•
parseInt('12.34') // 12
parseFloat('123.45#') // 123.45

// ES6çš„å†™æ³•
Number.parseInt('12.34') // 12
Number.parseFloat('123.45#') // 123.45
```



#### Number.isInteger()

`Number.isInteger()`ï¼šç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°å€¼**æ˜¯å¦ä¸ºæ•´æ•°**ï¼Œå‚æ•°ç±»å‹ä¸æ˜¯Numberç›´æ¥è¿”å›false

**æ•´æ•°å’Œæµ®ç‚¹æ•°**é‡‡ç”¨**åŒæ ·å­˜å‚¨**æ–¹æ³•ï¼Œ25å’Œ25.0è§†ä¸ºåŒå€¼

```js
Number.isInteger(25) // true
Number.isInteger(25.0) // true
```

JavaScript é‡‡ç”¨ IEEE 754 æ ‡å‡†ï¼Œæ•°å€¼å­˜å‚¨ä¸º**64ä½åŒç²¾åº¦æ ¼å¼ï¼Œè¶…è¿‡ç²¾åº¦å­˜åœ¨è¯¯åˆ¤**

- æ•°å€¼ç²¾åº¦æœ€é«˜ï¼šå¯ä»¥è¾¾åˆ° **53ä¸ªäºŒè¿›åˆ¶ä½**ï¼ˆ1 ä¸ªéšè—ä½ä¸ 52 ä¸ªæœ‰æ•ˆä½ï¼‰ - ä¹Ÿå°±æ˜¯**å°æ•°ç‚¹å16ä¸ªåè¿›åˆ¶ä½**ã€‚16ä½å°†ä¼šèˆå»
- æ•°å€¼ç²¾åº¦æœ€ä½ï¼š`Number.MIN_VALUE`ï¼ˆ5E-324ï¼‰

```js
Number.isInteger(25) // true
Number.isInteger(25.0) // true
Number.isInteger(3.0000000000000002) // true
Number.isInteger(5E-325) // true
```

> å¯¹äºé«˜ç²¾åº¦ï¼ŒisInteger ä¼šå­˜åœ¨è¯¯åˆ¤

#### Number.EPSILON

`Number.EPSILON`ï¼šæå°å¸¸é‡ï¼ˆæœ€å°è¯¯å·®å€¼ï¼‰ï¼Œè¡¨ç¤º 1 ä¸å¤§äº 1 çš„æœ€å°æµ®ç‚¹æ•°ä¹‹é—´çš„å·®ã€‚è¯¯å·®å°äºæ­¤å€¼ï¼Œå¯ä»¥è®¤ä¸ºæ²¡æœ‰è¯¯å·®

å¯¹äº 64 ä½æµ®ç‚¹æ•°æ¥è¯´ï¼Œå¤§äº 1 çš„æœ€å°æµ®ç‚¹æ•°ç›¸å½“äºäºŒè¿›åˆ¶çš„`1.00..001`ï¼Œå°æ•°ç‚¹åé¢æœ‰è¿ç»­ 51 ä¸ªé›¶ã€‚è¿™ä¸ªå€¼å‡å» 1 ä¹‹åï¼Œå°±ç­‰äº 2 çš„ -52 æ¬¡æ–¹ï¼ˆ`0.00..001`ï¼‰ã€‚

```js
Number.EPSILON === Math.pow(2, -52)
// true
Number.EPSILON
// 2.220446049250313e-16
Number.EPSILON.toFixed(20)
// "0.00000000000000022204"
```

é—®é¢˜ï¼šæµ®ç‚¹æ•°è®¡ç®—ä¸ç²¾ç¡®

```js
0.1 + 0.2
// 0.30000000000000004

0.1 + 0.2 - 0.3
// 5.551115123125783e-17

5.551115123125783e-17.toFixed(20)
// '0.00000000000000005551'
```

ä¾‹å­ï¼šè®¾ç½®è¯¯å·®èŒƒå›´ä¸º 2^-50

```js
function withinErrorMargin (left, right) {
  return Math.abs(left - right) < Number.EPSILON * Math.pow(2, 2);
}

0.1 + 0.2 === 0.3 // false
withinErrorMargin(0.1 + 0.2, 0.3) // true

1.1 + 1.3 === 2.4 // false
withinErrorMargin(1.1 + 1.3, 2.4) // true
```

#### Number.isSafeInteger()

æ•´æ•°èŒƒå›´åœ¨`-2^53`åˆ°`2^53`ä¹‹é—´ï¼ˆä¸å«ä¸¤ä¸ªç«¯ç‚¹ï¼‰ï¼Œè¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œæ— æ³•ç²¾ç¡®è¡¨ç¤ºè¿™ä¸ªå€¼

`Number.isSafeInteger()`ï¼šåˆ¤æ–­æ•´æ•°æ˜¯å¦åœ¨`-2^53`åˆ°`2^53`ä¹‹é—´

```js
Math.pow(2, 53) === Math.pow(2, 53) + 1 // true
Number.MAX_SAFE_INTEGER === Math.pow(2, 53) - 1 // 9007199254740991
Number.MIN_SAFE_INTEGER === -Number.MAX_SAFE_INTEGER // -9007199254740991
```

éªŒè¯è¿ç®—ç»“æœæ˜¯å¦è½åœ¨å®‰å…¨æ•´æ•°çš„èŒƒå›´å†…ï¼Œä¸è¦åªéªŒè¯è¿ç®—ç»“æœï¼Œè€Œè¦**åŒæ—¶éªŒè¯å‚ä¸è¿ç®—çš„æ¯ä¸ªå€¼**ã€‚

```js
Number.isSafeInteger(9007199254740993)
// false
Number.isSafeInteger(990)
// true
Number.isSafeInteger(9007199254740993 - 990) // è¶…å‡ºäº†ç²¾åº¦èŒƒå›´ï¼Œä»¥9007199254740992çš„å½¢å¼å‚¨å­˜
// true
9007199254740993 - 990
// è¿”å›ç»“æœ 9007199254740002
// æ­£ç¡®ç»“æœ 9007199254740003
```

### Mathå¯¹è±¡

#### Math.trunc()

`Math.trunc()`ï¼š**å»é™¤ä¸€ä¸ªæ•°çš„å°æ•°éƒ¨åˆ†**ï¼Œè¿”å›æ•´æ•°éƒ¨åˆ†ã€‚

è§„åˆ™

1. éæ•°å€¼ï¼Œå…ˆè½¬æ¢ä¸ºæ•°å€¼

2. ç©ºå€¼å’Œæ— æ³•æˆªå–æ•´æ•°ï¼Œè¿”å›NaN

```js
Math.trunc(4.1) // 4
Math.trunc(4.9) // 4
Math.trunc(-4.1) // -4
Math.trunc(-4.9) // -4
Math.trunc(-0.1234) // -0

Math.trunc(true) //1
Math.trunc(false) // 0
Math.trunc(null) // 0
```

polyfill

```js
Math.trunc = Math.trunc || function(x) {
  return x < 0 ? Math.ceil(x) : Math.floor(x);
};
```

#### Math.sign()

`Math.sign()`ï¼šåˆ¤æ–­ä¸€ä¸ªæ•°åˆ°åº•æ˜¯**æ­£æ•°ã€è´Ÿæ•°ã€è¿˜æ˜¯é›¶**ã€‚

è§„åˆ™

1. éæ•°å€¼ï¼Œå…ˆè½¬æ¢ä¸ºæ•°å€¼

```js
Math.sign(-5) // è´Ÿæ•° -1
Math.sign(5) // æ­£æ•° +1
Math.sign(0) // é›¶ +0
Math.sign(-0) // è´Ÿé›¶  -0
Math.sign(NaN) // å…¶ä»–å€¼ NaN
```

poyfill 

```js
Math.sign = Math.sign || function(x) {
  x = +x; // convert to a number
  if (x === 0 || isNaN(x)) {
    return x;
  }
  return x > 0 ? 1 : -1;
};
```

#### å…¶ä»–

| æ–¹æ³•        |                                       |
| ----------- | ------------------------------------- |
| Math.cbrt   | è®¡ç®—ä¸€ä¸ªæ•°çš„ç«‹æ–¹æ ¹                    |
| Math.clz32  | å°†å‚æ•°è½¬ä¸º 32 ä½æ— ç¬¦å·æ•´æ•°çš„å½¢å¼      |
| Math.imul   | ä¸¤ä¸ªæ•°ä»¥ 32ä½å¸¦ç¬¦å·æ•´æ•°å½¢å¼ç›¸ä¹˜çš„ç»“æœ |
| Math.fround | ä¸€ä¸ªæ•°çš„ 32ä½å•ç²¾åº¦æµ®ç‚¹æ•°å½¢å¼         |
| Math.hypot  | è¿”å›æ‰€æœ‰å‚æ•°çš„å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹          |
| å¯¹æ•°æ–¹æ³•    |                                       |
| Math.expm1  | è¿”å› e^x - 1                          |
| Math.log1p  | `1 + x`çš„è‡ªç„¶å¯¹æ•°                     |
| Math.log10  | ä»¥ 10 ä¸ºåº•çš„`x`çš„å¯¹æ•°                 |
| Math.log2   | ä»¥ 2 ä¸ºåº•çš„`x`çš„å¯¹æ•°                  |
| åŒæ›²çº¿å‡½æ•°  |                                       |
| Math.sinh   | åŒæ›²æ­£å¼¦                              |
| Math.cosh   | åŒæ›²ä½™å¼¦                              |
| Math.tanh   | åŒæ›²æ­£åˆ‡                              |
| Math.asinh  | ååŒæ›²æ­£å¼¦                            |
| Math.acosh  | ååŒæ›²ä½™å¼¦                            |
| Math.atanh  | ååŒæ›²æ­£åˆ‡                            |

### æŒ‡æ•°è¿ç®—ç¬¦

ES2016  - æŒ‡æ•°è¿ç®—ç¬¦ï¼ˆ`**`ï¼‰ï¼Œ**ä»å³å‘å·¦ç»“åˆ**

```js
// ç›¸å½“äº 2 ** (3 ** 2)
2 ** 3 ** 2
```

### BigInt æ•°æ®ç±»å‹

é—®é¢˜ï¼šJavaScript æ‰€æœ‰æ•°å­—éƒ½ä¿å­˜æˆ 64 ä½æµ®ç‚¹æ•°ï¼Œä¼šäº§ç”Ÿä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜

1. æ•°å€¼çš„ç²¾åº¦åªèƒ½åˆ° 53 ä¸ªäºŒè¿›åˆ¶ä½ï¼ˆ16ä¸ªåè¿›åˆ¶ï¼‰
2. å¤§äºæˆ–ç­‰äº 2çš„1024 æ¬¡æ–¹çš„å€¼ï¼Œæ— æ³•è¡¨ç¤ºï¼ˆè¿”å› Infinityï¼‰

`BigInt` ï¼šå¯ä»¥ç²¾ç¡®è¡¨ç¤º**ä»»ä½•ä½æ•°çš„æ•´æ•°**ï¼ˆåç¼€ä¸º`n`ï¼‰

1. BigInt ï¼Œæ™®é€šæ•´æ•°æ˜¯**ä¸¤ç§å€¼**

```js
42n === 42 // false
```

2. `typeof`è¿ç®—ç¬¦ï¼šBigInt ç±»å‹æ•°æ®è¿”å›`bigint`

```js
typeof 123n // 'bigint'
```

3. å¯ä»¥ç”¨ `-` ä¸èƒ½ç”¨ `+`

```js
-42n // æ­£ç¡®
+42n // æŠ¥é”™
```

#### BigIntå‡½æ•°

`BigInt()`æ„é€ å‡½æ•°

- å¿…é¡»æœ‰å‚æ•°
- å‚æ•°å¿…é¡»å¯ä»¥æ­£å¸¸è½¬ä¸ºæ•°å€¼ï¼ˆæ•´æ•°ï¼‰

```js
new BigInt() // TypeError
BigInt(undefined) //TypeError
BigInt(null) // TypeError
BigInt('123n') // SyntaxError
BigInt('abc') // SyntaxError
BigInt(1.5) // RangeError
BigInt('1.5') // SyntaxError
```

> å­—ç¬¦ä¸²`123n`æ— æ³•è§£ææˆ Number ç±»å‹ï¼Œæ‰€ä»¥æŠ¥é”™

`BigInt.asUintN(width, BigInt)`ï¼š ç»™å®šçš„ BigInt è½¬ä¸º *0* åˆ° *2^width-1^* ä¹‹é—´å¯¹åº”çš„å€¼ã€‚

`BigInt.asIntN(width, BigInt)`ï¼šç»™å®šçš„ BigInt è½¬ä¸º -2^width-1^ åˆ° *2^width-1^-1* ä¹‹é—´å¯¹åº”çš„å€¼ã€‚

```js
const max = 2n ** (64n - 1n) - 1n;

BigInt.asIntN(64, max)
// 9223372036854775807n
BigInt.asIntN(64, max + 1n)
// -9223372036854775808n
BigInt.asUintN(64, max + 1n)
// 9223372036854775808n
```

> max ä¸º 64ä½ BigInt èƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼ã€‚+1åï¼Œæ–°å¢ä¸€ä½ä¸ºç¬¦å·ä½

`BigInt.parseInt(string[, radix])`ï¼šå°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆæŒ‡å®šè¿›åˆ¶çš„ BigInt

```js
// Number.parseInt() ä¸ BigInt.parseInt() çš„å¯¹æ¯”
Number.parseInt('9007199254740993', 10)
// 9007199254740992
BigInt.parseInt('9007199254740993', 10)
// 9007199254740993n
```

#### è½¬æ¢è§„åˆ™

```js
Boolean(0n) // false
Boolean(1n) // true
Number(1n)  // 1
String(1n)  // "1"
!0n // true
!1n // false
```

#### æ•°å­¦è¿ç®—

`+`ã€`-`ã€`*`ã€`**`ï¼šä¸ Number ç±»å‹çš„è¡Œä¸ºä¸€è‡´

`/`ï¼š**èˆå»å°æ•°éƒ¨åˆ†**ï¼Œè¿”å›ä¸€ä¸ªæ•´æ•°

```js
9n / 5n // 1n
```

#### æ³¨æ„äº‹é¡¹

1. BigIntä¸èƒ½ç”¨äºä¸å¸¦ç¬¦å·çš„å³ç§»ä½è¿ç®—ç¬¦`>>>`ï¼ˆBigIntæ€»æ˜¯å¸¦ç¬¦å·ï¼Œå¯¼è‡´æ— ç¬¦å·è¿ç®—æ— æ„ä¹‰ï¼‰
2. BigIntä¸èƒ½ä¸æ™®é€šæ•°å€¼æ··åˆè¿ç®—ï¼ˆæ— è®ºæ˜¯è¿”å› `BigInt` æˆ– `Number`éƒ½ä¼šä¸¢å¤±ç²¾åº¦ï¼‰

```js
(2n**53n + 1n) + 0.5
```

> 1n | 0 ä¹Ÿä¼šæŠ¥é”™

#### å…¶ä»–è¿ç®—

BigInt å¯¹åº”çš„å¸ƒå°”å€¼ï¼Œä¸ Number ç±»å‹ä¸€è‡´ï¼Œå³`0n`ä¼šè½¬ä¸º`false`ï¼Œå…¶ä»–å€¼è½¬ä¸º`true`

æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆæ¯”å¦‚`>`ï¼‰å’Œç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ`==`ï¼‰å…è®¸ BigInt ä¸å…¶ä»–ç±»å‹çš„å€¼æ··åˆè®¡ç®—ï¼Œå› ä¸ºè¿™æ ·åšä¸ä¼šæŸå¤±ç²¾åº¦ã€‚

```js
0n < 1 // true
0n < true // true
0n == 0 // true
0n == false // true
0n === 0 // false
```

BigInt ä¸**å­—ç¬¦ä¸²**æ··åˆè¿ç®—æ—¶ï¼Œä¼šå…ˆè½¬ä¸ºå­—ç¬¦ä¸²ï¼Œå†è¿›è¡Œè¿ç®—ã€‚

```js
'' + 123n // "123"
```

## ç›¸å…³é“¾æ¥

[^1]: [Unicodeã€UTF-8ã€UTF-16](https://mp.weixin.qq.com/s/FMzDMjCidalMcfYBi47gmQ)

