---
title: ã€ŒReact è¿›é˜¶ã€ React å…¨éƒ¨ Hooks ä½¿ç”¨å¤§å…¨ ï¼ˆåŒ…å« React v18 ç‰ˆæœ¬ ï¼‰
order: 5
---

::: warning æ–‡ç« éåŸåˆ›

ä½œè€…ï¼šæˆ‘ä¸æ˜¯å¤–æ˜Ÿäºº

æ¥æºï¼šhttps://juejin.cn/post/7118937685653192735

æ³¨æ„ï¼šä¸ªäººå­¦ä¹ ä½¿ç”¨ï¼Œä¼šå¯¹åŸæ–‡è¿›è¡Œä¿®æ”¹æ‰¹æ³¨
:::

# ã€ŒReact è¿›é˜¶ã€ React å…¨éƒ¨ Hooks ä½¿ç”¨å¤§å…¨ ï¼ˆåŒ…å« React v18 ç‰ˆæœ¬ ï¼‰âœ¨

## ä¸€ å‰è¨€

React hooks æ˜¯ react16.8 ä»¥åï¼Œreact æ–°å¢çš„é’©å­ APIï¼Œç›®çš„æ˜¯å¢åŠ ä»£ç çš„å¯å¤ç”¨æ€§ï¼Œé€»è¾‘æ€§ï¼Œå¼¥è¡¥æ— çŠ¶æ€ç»„ä»¶æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œæ²¡æœ‰æ•°æ®ç®¡ç†çŠ¶æ€ state çš„ç¼ºé™·ã€‚æœ¬ç« èŠ‚ç¬”è€…å°†ä»‹ç»ç›®å‰ React æä¾›çš„æ‰€æœ‰ hooks ï¼Œä»‹ç»å…¶åŠŸèƒ½ç±»å‹å’ŒåŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚

åˆ›ä½œä¸æ˜“ï¼Œå¸Œæœ›å±å¹•å‰çš„ä½ èƒ½ç»™ç¬”è€…èµä¸ª**èµ**ï¼Œä»¥æ­¤é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œå‰ç«¯ç¡¬æ–‡ã€‚ğŸŒ¹ğŸŒ¹ğŸŒ¹

### 1.1 æŠ€æœ¯èƒŒæ™¯

**react hooks è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ**

å…ˆè®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰ Hooksï¼Œå‡½æ•°ç»„ä»¶èƒ½å¤Ÿåšçš„åªæ˜¯æ¥å— Propsã€æ¸²æŸ“ UI ï¼Œä»¥åŠè§¦å‘çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„äº‹ä»¶ã€‚æ‰€æœ‰çš„å¤„ç†é€»è¾‘éƒ½è¦åœ¨ç±»ç»„ä»¶ä¸­å†™ï¼Œè¿™æ ·ä¼šä½¿ class ç±»ç»„ä»¶å†…éƒ¨é”™ç»¼å¤æ‚ï¼Œæ¯ä¸€ä¸ªç±»ç»„ä»¶éƒ½æœ‰ä¸€å¥—ç‹¬ç‰¹çš„çŠ¶æ€ï¼Œç›¸äº’ä¹‹é—´ä¸èƒ½å¤ç”¨ï¼Œå³ä¾¿æ˜¯ React ä¹‹å‰å‡ºç°è¿‡ mixin ç­‰å¤ç”¨æ–¹å¼ï¼Œä½†æ˜¯ä¼´éšå‡º mixin æ¨¡å¼ä¸‹éšå¼ä¾èµ–ï¼Œä»£ç å†²çªè¦†ç›–ç­‰é—®é¢˜ï¼Œä¹Ÿä¸èƒ½æˆä¸º React çš„ä¸­æµç ¥æŸ±çš„é€»è¾‘å¤ç”¨æ–¹æ¡ˆã€‚æ‰€ä»¥ React æ”¾å¼ƒ mixin è¿™ç§æ–¹å¼ã€‚

ç±»ç»„ä»¶æ˜¯ä¸€ç§é¢å‘å¯¹è±¡æ€æƒ³çš„ä½“ç°ï¼Œç±»ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€ä¼šéšç€åŠŸèƒ½å¢å¼ºè€Œå˜å¾—è¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œä»£ç ç»´æŠ¤æˆæœ¬ä¹Ÿæ¯”è¾ƒé«˜ï¼Œè€Œä¸”ä¸åˆ©äºåæœŸ tree shakingã€‚æ‰€ä»¥æœ‰å¿…è¦åšå‡ºä¸€å¥—å‡½æ•°ç»„ä»¶ä»£æ›¿ç±»ç»„ä»¶çš„æ–¹æ¡ˆï¼Œäºæ˜¯ Hooks ä¹Ÿå°±ç†æ‰€å½“ç„¶çš„è¯ç”Ÿäº†ã€‚

æ‰€ä»¥ Hooks å‡ºç°æœ¬è´¨ä¸ŠåŸå› æ˜¯ï¼š

- **è®©å‡½æ•°ç»„ä»¶ä¹Ÿèƒ½åšç±»ç»„ä»¶çš„äº‹ï¼Œæœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œå¯ä»¥å¤„ç†ä¸€äº›å‰¯ä½œç”¨ï¼Œèƒ½è·å– ref ï¼Œä¹Ÿèƒ½åšæ•°æ®ç¼“å­˜ã€‚**
- **è§£å†³é€»è¾‘å¤ç”¨éš¾çš„é—®é¢˜ã€‚**
- **æ”¾å¼ƒé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæ‹¥æŠ±å‡½æ•°å¼ç¼–ç¨‹ã€‚**

**ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è‡ªå®šä¹‰ Hooks ï¼Ÿ**

è‡ªå®šä¹‰ hooks æ˜¯åœ¨ React Hooks åŸºç¡€ä¸Šçš„ä¸€ä¸ªæ‹“å±•ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆ¶å®šæ»¡è¶³ä¸šåŠ¡éœ€è¦çš„ç»„åˆ hooks ï¼Œæ›´æ³¨é‡çš„æ˜¯é€»è¾‘å•å…ƒã€‚é€šè¿‡ä¸šåŠ¡åœºæ™¯ä¸åŒï¼Œåˆ°åº•éœ€è¦ React Hooks åšä»€ä¹ˆï¼Œæ€ä¹ˆæ ·æŠŠä¸€æ®µé€»è¾‘å°è£…èµ·æ¥ï¼Œåšåˆ°å¤ç”¨ï¼Œè¿™æ˜¯è‡ªå®šä¹‰ hooks äº§ç”Ÿçš„åˆè¡·ã€‚

è‡ªå®šä¹‰ hooks ä¹Ÿå¯ä»¥è¯´æ˜¯ React Hooks èšåˆäº§ç‰©ï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª React Hooks ç»„æˆï¼Œç”¨äºè§£å†³ä¸€äº›å¤æ‚é€»è¾‘ã€‚

### 1.2 æŠ€æœ¯æ„¿æ™¯

ç›®å‰ hooks å·²ç»æˆä¸º React ä¸»æµçš„å¼€å‘æ‰‹æ®µï¼ŒReact ç”Ÿæ€ä¹Ÿæ—¥ç›Šæœç€ hooks æ–¹å‘å‘å±•ï¼Œæ¯”å¦‚ React Router, React Redux ç­‰ï¼Œ hooks ä¹Ÿæ›´å¥‘åˆ React ç”Ÿæ€åº“çš„åº”ç”¨ã€‚

éšç€é¡¹ç›®åŠŸèƒ½æ¨¡å—è¶Šæ¥è¶Šå¤æ‚ï¼Œä¸€äº›å…¬å…±é€»è¾‘ä¸èƒ½æœ‰æ•ˆçš„å¤ç”¨ï¼Œè¿™äº›é€»è¾‘éœ€è¦å’Œä¸šåŠ¡ä»£ç å¼ºå…³è”åˆ°ä¸€èµ·ï¼Œè¿™æ ·ä¼šè®©æ•´ä½“å·¥ç¨‹è‡ƒè‚¿ï¼ŒåŠŸèƒ½ä¸èƒ½å¤ç”¨ï¼Œå¦‚æœæ¶‰åŠåˆ°ä¿®æ”¹é€»è¾‘ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ç‰µä¸€å‘åŠ¨å…¨èº«ã€‚

æ‰€ä»¥æœ‰å¿…è¦ä½¿ç”¨è‡ªå®šä¹‰ hooks çš„æ–¹å¼ï¼Œhooks å¯ä»¥æŠŠé‡å¤çš„é€»è¾‘æŠ½ç¦»å‡ºå»ï¼Œæ ¹æ®éœ€è¦åˆ›å»ºå’Œä¸šåŠ¡åŠŸèƒ½ç»‘å®šçš„ä¸šåŠ¡å‹ hooks ï¼Œæˆ–è€…æ˜¯æ ¹æ®å…·ä½“åŠŸèƒ½åˆ›å»ºçš„åŠŸèƒ½å‹ hooks ã€‚

### 1.3 åŠŸèƒ½æ¦‚è§ˆ

åœ¨ React çš„ä¸–ç•Œä¸­ï¼Œä¸åŒçš„ hooks ä½¿å‘½ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œæˆ‘è¿™é‡Œå¯¹ React hooks æŒ‰ç…§åŠŸèƒ½åˆ†ç±»ï¼Œåˆ†æˆäº† **æ•°æ®æ›´æ–°é©±åŠ¨**ï¼Œ**çŠ¶æ€è·å–ä¸ä¼ é€’ï¼Œæ‰§è¡Œå‰¯ä½œç”¨ï¼ŒçŠ¶æ€æ´¾ç”Ÿä¸ä¿å­˜ï¼Œå’Œå·¥å…·ç±»å‹ï¼Œ** å…·ä½“åŠŸèƒ½åˆ’åˆ†å’Œä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š

![WechatIMG32.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/69822a1b61e64ee29b8125592e1ee035~tplv-k3u1fbpfcp-watermark.image?)

## äºŒ hooks ä¹‹æ•°æ®æ›´æ–°é©±åŠ¨

### 2.1 useState

useState å¯ä»¥ä½¿å‡½æ•°ç»„ä»¶åƒç±»ç»„ä»¶ä¸€æ ·æ‹¥æœ‰ stateï¼Œå‡½æ•°ç»„ä»¶é€šè¿‡ useState å¯ä»¥è®©ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œæ›´æ–°è§†å›¾ã€‚

**useState åŸºç¡€ä»‹ç»ï¼š**

```jsx
const [ â‘ state , â‘¡dispatch ] = useState(â‘¢initData)
```

â‘  stateï¼Œç›®çš„æä¾›ç»™ UI ï¼Œä½œä¸ºæ¸²æŸ“è§†å›¾çš„æ•°æ®æºã€‚

â‘¡ dispatchAction æ”¹å˜ state çš„å‡½æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºæ¨åŠ¨å‡½æ•°ç»„ä»¶æ¸²æŸ“çš„æ¸²æŸ“å‡½æ•°ã€‚

â‘¢ initData æœ‰ä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§æƒ…å†µæ˜¯éå‡½æ•°ï¼Œå°†ä½œä¸º state åˆå§‹åŒ–çš„å€¼ã€‚ ç¬¬äºŒç§æƒ…å†µæ˜¯å‡½æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼ä½œä¸º useState åˆå§‹åŒ–çš„å€¼ã€‚

**useState åŸºç¡€ç”¨æ³•ï¼š**

```jsx
const DemoState = (props) => {
  /* numberä¸ºæ­¤æ—¶stateè¯»å–å€¼ ï¼ŒsetNumberä¸ºæ´¾å‘æ›´æ–°çš„å‡½æ•° */
  let [number, setNumber] = useState(0); /* 0ä¸ºåˆå§‹å€¼ */
  return (
    <div>
      <span>{number}</span>
      <button
        onClick={() => {
          setNumber(number + 1);
          console.log(number); /* è¿™é‡Œçš„numberæ˜¯ä¸èƒ½å¤Ÿå³ä½¿æ”¹å˜çš„  */
        }}
      ></button>
    </div>
  );
};
```

**useState æ³¨æ„äº‹é¡¹ï¼š**

â‘  åœ¨å‡½æ•°ç»„ä»¶ä¸€æ¬¡æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œstate çš„å€¼æ˜¯å›ºå®šä¸å˜çš„ã€‚

```jsx
function Index() {
  const [number, setNumber] = React.useState(0);
  const handleClick = () =>
    setInterval(() => {
      // æ­¤æ—¶ number ä¸€ç›´éƒ½æ˜¯ 0
      setNumber(number + 1);
    }, 1000);
  return <button onClick={handleClick}> ç‚¹å‡» {number}</button>;
}
```

â‘¡ å¦‚æœä¸¤æ¬¡ dispatchAction ä¼ å…¥ç›¸åŒçš„ state å€¼ï¼Œé‚£ä¹ˆç»„ä»¶å°±ä¸ä¼šæ›´æ–°ã€‚

```jsx
export default function Index() {
  const [state, dispatchState] = useState({ name: "alien" });
  const handleClick = () => {
    // ç‚¹å‡»æŒ‰é’®ï¼Œè§†å›¾æ²¡æœ‰æ›´æ–°ã€‚
    state.name = "Alien";
    dispatchState(state); // ç›´æ¥æ”¹å˜ `state`ï¼Œåœ¨å†…å­˜ä¸­æŒ‡å‘çš„åœ°å€ç›¸åŒã€‚
  };
  return (
    <div>
      <span> {state.name}</span>
      <button onClick={handleClick}>changeName++</button>
    </div>
  );
}
```

â‘¢ å½“è§¦å‘ dispatchAction åœ¨å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è·å–ä¸åˆ°æœ€æ–°çš„ state, åªæœ‰å†ä¸‹ä¸€æ¬¡ç»„ä»¶ rerender ä¸­æ‰èƒ½è·å–åˆ°ã€‚

### 2.2 useReducer

useReducer æ˜¯ react-hooks æä¾›çš„èƒ½å¤Ÿåœ¨æ— çŠ¶æ€ç»„ä»¶ä¸­è¿è¡Œçš„ç±»ä¼¼ redux çš„åŠŸèƒ½ api ã€‚

**useReducer åŸºç¡€ä»‹ç»ï¼š**

```jsx
const [ â‘ state , â‘¡dispatch ] = useReducer(â‘¢reducer)
```

â‘  æ›´æ–°ä¹‹åçš„ state å€¼ã€‚

â‘¡ æ´¾å‘æ›´æ–°çš„ dispatchAction å‡½æ•°, æœ¬è´¨ä¸Šå’Œ useState çš„ dispatchAction æ˜¯ä¸€æ ·çš„ã€‚

â‘¢ ä¸€ä¸ªå‡½æ•° reducer ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ª redux ä¸­çš„ reducer , reducer çš„å‚æ•°å°±æ˜¯å¸¸è§„ reducer é‡Œé¢çš„ state å’Œ action, è¿”å›æ”¹å˜åçš„ state, è¿™é‡Œæœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯ï¼š**å¦‚æœè¿”å›çš„ state å’Œä¹‹å‰çš„ state ï¼Œå†…å­˜æŒ‡å‘ç›¸åŒï¼Œé‚£ä¹ˆç»„ä»¶å°†ä¸ä¼šæ›´æ–°ã€‚**

**useReducer åŸºç¡€ç”¨æ³•ï¼š**

```jsx
const DemoUseReducer = () => {
  /* numberä¸ºæ›´æ–°åçš„stateå€¼,  dispatchNumbner ä¸ºå½“å‰çš„æ´¾å‘å‡½æ•° */
  const [number, dispatchNumbner] = useReducer((state, action) => {
    const { payload, name } = action;
    /* returnçš„å€¼ä¸ºæ–°çš„state */
    switch (name) {
      case "add":
        return state + 1;
      case "sub":
        return state - 1;
      case "reset":
        return payload;
    }
    return state;
  }, 0);
  return (
    <div>
      å½“å‰å€¼ï¼š{number}
      {/* æ´¾å‘æ›´æ–° */}
      <button onClick={() => dispatchNumbner({ name: "add" })}>å¢åŠ </button>
      <button onClick={() => dispatchNumbner({ name: "sub" })}>å‡å°‘</button>
      <button onClick={() => dispatchNumbner({ name: "reset", payload: 666 })}>
        èµ‹å€¼
      </button>
      {/* æŠŠdispatch å’Œ state ä¼ é€’ç»™å­ç»„ä»¶  */}
      <MyChildren dispatch={dispatchNumbner} State={{ number }} />
    </div>
  );
};
```

### 2.3 useSyncExternalStore

useSyncExternalStore çš„è¯ç”Ÿå¹¶éå¶ç„¶ï¼Œå’Œ v18 çš„æ›´æ–°æ¨¡å¼ä¸‹å¤–éƒ¨æ•°æ®çš„ tearing æœ‰ç€ååˆ†ç´§å¯†çš„å…³è”ã€‚useSyncExternalStore èƒ½å¤Ÿè®© React ç»„ä»¶åœ¨ concurrent æ¨¡å¼ä¸‹å®‰å…¨åœ°æœ‰æ•ˆåœ°è¯»å–å¤–æ¥æ•°æ®æºï¼Œåœ¨ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ä¸­èƒ½å¤Ÿæ£€æµ‹åˆ°å˜åŒ–ï¼Œå¹¶ä¸”åœ¨æ•°æ®æºå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œèƒ½å¤Ÿè°ƒåº¦æ›´æ–°ã€‚å½“è¯»å–åˆ°å¤–éƒ¨çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œä¼šè§¦å‘ä¸€ä¸ªå¼ºåˆ¶æ›´æ–°ï¼Œæ¥ä¿è¯ç»“æœçš„ä¸€è‡´æ€§ã€‚

**useSyncExternalStore åŸºç¡€ä»‹ç»ï¼š**

```jsx
useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot);
```

â‘  subscribe ä¸ºè®¢é˜…å‡½æ•°ï¼Œå½“æ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œä¼šè§¦å‘ subscribeï¼Œåœ¨ useSyncExternalStore ä¼šé€šè¿‡å¸¦æœ‰è®°å¿†æ€§çš„ getSnapshot æ¥åˆ¤åˆ«æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆä¼šå¼ºåˆ¶æ›´æ–°æ•°æ®ã€‚

â‘¡ getSnapshot å¯ä»¥ç†è§£æˆä¸€ä¸ªå¸¦æœ‰è®°å¿†åŠŸèƒ½çš„é€‰æ‹©å™¨ã€‚å½“ store å˜åŒ–çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ getSnapshot ç”Ÿæˆæ–°çš„çŠ¶æ€å€¼ï¼Œè¿™ä¸ªçŠ¶æ€å€¼å¯æä¾›ç»™ç»„ä»¶ä½œä¸ºæ•°æ®æºä½¿ç”¨ï¼ŒgetSnapshot å¯ä»¥æ£€æŸ¥è®¢é˜…çš„å€¼æ˜¯å¦æ”¹å˜ï¼Œæ”¹å˜çš„è¯é‚£ä¹ˆä¼šè§¦å‘æ›´æ–°ã€‚

â‘¢ getServerSnapshot ç”¨äº hydration æ¨¡å¼ä¸‹çš„ getSnapshotã€‚

**useSyncExternalStore åŸºç¡€ç”¨æ³•ï¼š**

```jsx
import { combineReducers, createStore } from "redux";

/* number Reducer */
function numberReducer(state = 1, action) {
  switch (action.type) {
    case "ADD":
      return state + 1;
    case "DEL":
      return state - 1;
    default:
      return state;
  }
}

/* æ³¨å†Œreducer */
const rootReducer = combineReducers({ number: numberReducer });
/* åˆ›å»º store */
const store = createStore(rootReducer, { number: 1 });

function Index() {
  /* è®¢é˜…å¤–éƒ¨æ•°æ®æº */
  const state = useSyncExternalStore(
    store.subscribe,
    () => store.getState().number
  );
  console.log(state);
  return (
    <div>
      {state}
      <button onClick={() => store.dispatch({ type: "ADD" })}>ç‚¹å‡»</button>
    </div>
  );
}
```

ç‚¹å‡»æŒ‰é’®ï¼Œä¼šè§¦å‘ reducer ï¼Œç„¶åä¼šè§¦å‘ store.subscribe è®¢é˜…å‡½æ•°ï¼Œæ‰§è¡Œ getSnapshot å¾—åˆ°æ–°çš„ number ï¼Œåˆ¤æ–­ number æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœå˜åŒ–ï¼Œè§¦å‘æ›´æ–°ã€‚

### 2.4 useTransition

åœ¨ React v18 ä¸­ï¼Œæœ‰ä¸€ç§æ–°æ¦‚å¿µå«åšè¿‡æ¸¡ä»»åŠ¡ï¼Œè¿™ç§ä»»åŠ¡æ˜¯å¯¹æ¯”ç«‹å³æ›´æ–°ä»»åŠ¡è€Œäº§ç”Ÿçš„ï¼Œé€šå¸¸ä¸€äº›å½±å“ç”¨æˆ·äº¤äº’ç›´è§‚å“åº”çš„ä»»åŠ¡ï¼Œä¾‹å¦‚æŒ‰é”®ï¼Œç‚¹å‡»ï¼Œè¾“å…¥ç­‰ï¼Œè¿™äº›ä»»åŠ¡éœ€è¦è§†å›¾ä¸Šç«‹å³å“åº”ï¼Œæ‰€ä»¥å¯ä»¥ç§°ä¹‹ä¸ºç«‹å³æ›´æ–°çš„ä»»åŠ¡ï¼Œä½†æ˜¯æœ‰ä¸€äº›æ›´æ–°ä¸æ˜¯é‚£ä¹ˆæ€¥è¿«ï¼Œæ¯”å¦‚é¡µé¢ä»ä¸€ä¸ªçŠ¶æ€è¿‡æ¸¡åˆ°å¦å¤–ä¸€ä¸ªçŠ¶æ€ï¼Œè¿™äº›ä»»åŠ¡å°±å«åšè¿‡æ¸¡ä»»åŠ¡ã€‚ æ‰“ä¸ªæ¯”æ–¹å¦‚ä¸‹å›¾å½“ç‚¹å‡» tab ä» tab1 åˆ‡æ¢åˆ° tab2 çš„æ—¶å€™ï¼Œæœ¬è´¨ä¸Šäº§ç”Ÿäº†ä¸¤ä¸ªæ›´æ–°ä»»åŠ¡ã€‚

- ç¬¬ä¸€ä¸ªå°±æ˜¯ hover çŠ¶æ€ç”± tab1 å˜æˆ tab2ã€‚

- ç¬¬äºŒä¸ªå°±æ˜¯å†…å®¹åŒºåŸŸç”± tab1 å†…å®¹å˜æ¢åˆ° tab2 å†…å®¹ã€‚

è¿™ä¸¤ä¸ªä»»åŠ¡ï¼Œç”¨æˆ·è‚¯å®šå¸Œæœ› hover çŠ¶æ€çš„å“åº”æ›´è¿…é€Ÿï¼Œè€Œå†…å®¹çš„å“åº”æœ‰å¯èƒ½è¿˜éœ€è¦è¯·æ±‚æ•°æ®ç­‰æ“ä½œï¼Œæ‰€ä»¥æ›´æ–°çŠ¶æ€å¹¶ä¸æ˜¯ç«‹é©¬ç”Ÿæ•ˆï¼Œé€šå¸¸è¿˜ä¼šæœ‰ä¸€äº› loading æ•ˆæœã€‚æ‰€ä»¥ç¬¬ä¸€ä¸ªä»»åŠ¡ä½œä¸º**ç«‹å³æ‰§è¡Œä»»åŠ¡**ï¼Œè€Œç¬¬äºŒä¸ªä»»åŠ¡å°±å¯ä»¥è§†ä¸º**è¿‡æ¸¡ä»»åŠ¡**ã€‚

![WechatIMG6496.jpeg](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07c521e445a5419f8ebc57cf9e5e5e61~tplv-k3u1fbpfcp-watermark.image?)

**useTransition åŸºç¡€ä»‹ç»ï¼š**

useTransition æ‰§è¡Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚æ•°ç»„æœ‰ä¸¤ä¸ªçŠ¶æ€å€¼ï¼š

- ç¬¬ä¸€ä¸ªæ˜¯ï¼Œå½“å¤„äºè¿‡æ¸¡çŠ¶æ€çš„æ ‡å¿—â€”â€”isPendingã€‚
- ç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç†è§£ä¸ºä¸Šè¿°çš„ startTransitionã€‚å¯ä»¥æŠŠé‡Œé¢çš„æ›´æ–°ä»»åŠ¡å˜æˆè¿‡æ¸¡ä»»åŠ¡ã€‚

```jsx
import { useTransition } from "react";
/* ä½¿ç”¨ */
const [isPending, startTransition] = useTransition();
```

**useTransition åŸºç¡€ç”¨æ³•ï¼š**

é™¤äº†ä¸Šè¿°åˆ‡æ¢ tab åœºæ™¯å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šåœºæ™¯éå¸¸é€‚åˆ useTransition äº§ç”Ÿçš„è¿‡æ¸¡ä»»åŠ¡ï¼Œæ¯”å¦‚è¾“å…¥å†…å®¹ï¼Œå®æ—¶æœç´¢å¹¶å±•ç¤ºæ•°æ®ï¼Œè¿™æœ¬è´¨ä¸Šä¹Ÿæ˜¯æœ‰ä¸¤ä¸ªä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œç¬¬ä¸€ä¸ªä»»åŠ¡å°±æ˜¯å—æ§è¡¨å•çš„å®æ—¶å“åº”ï¼›ç¬¬äºŒä¸ªå°±æ˜¯è¾“å…¥å†…å®¹æ”¹å˜,æ•°æ®å±•ç¤ºçš„å˜åŒ–ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å†™ä¸€ä¸ª demo æ¥çœ‹ä¸€ä¸‹ useTransition çš„åŸºæœ¬ä½¿ç”¨ã€‚

```jsx
/* æ¨¡æ‹Ÿæ•°æ® */
const mockList1 = new Array(10000)
  .fill("tab1")
  .map((item, index) => item + "--" + index);
const mockList2 = new Array(10000)
  .fill("tab2")
  .map((item, index) => item + "--" + index);
const mockList3 = new Array(10000)
  .fill("tab3")
  .map((item, index) => item + "--" + index);

const tab = {
  tab1: mockList1,
  tab2: mockList2,
  tab3: mockList3,
};

export default function Index() {
  const [active, setActive] = React.useState("tab1"); //éœ€è¦ç«‹å³å“åº”çš„ä»»åŠ¡ï¼Œç«‹å³æ›´æ–°ä»»åŠ¡
  const [renderData, setRenderData] = React.useState(tab[active]); //ä¸éœ€è¦ç«‹å³å“åº”çš„ä»»åŠ¡ï¼Œè¿‡æ¸¡ä»»åŠ¡
  const [isPending, startTransition] = React.useTransition();
  const handleChangeTab = (activeItem) => {
    setActive(activeItem); // ç«‹å³æ›´æ–°
    startTransition(() => {
      // startTransition é‡Œé¢çš„ä»»åŠ¡ä¼˜å…ˆçº§ä½
      setRenderData(tab[activeItem]);
    });
  };
  return (
    <div>
      <div className="tab">
        {Object.keys(tab).map((item) => (
          <span
            className={active === item && "active"}
            onClick={() => handleChangeTab(item)}
          >
            {item}
          </span>
        ))}
      </div>
      <ul className="content">
        {isPending && <div> loading... </div>}
        {renderData.map((item) => (
          <li key={item}>{item}</li>
        ))}
      </ul>
    </div>
  );
}
```

å¦‚ä¸Šå½“åˆ‡æ¢ tab çš„æ—¶å€™ï¼Œäº§ç”Ÿäº†ä¸¤ä¸ªä¼˜å…ˆçº§ä»»åŠ¡ï¼Œç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯ setActive æ§åˆ¶ tab active çŠ¶æ€çš„æ”¹å˜ï¼Œç¬¬äºŒä¸ªä»»åŠ¡ä¸º setRenderData æ§åˆ¶æ¸²æŸ“çš„é•¿åˆ—è¡¨æ•°æ® ï¼ˆåœ¨ç°å®åœºæ™¯ä¸‹é•¿åˆ—è¡¨å¯èƒ½æ˜¯ä¸€äº›æ•°æ®é‡å¤§çš„å¯è§†åŒ–å›¾è¡¨ï¼‰ã€‚

### 2.5 useDeferredValue

React 18 æä¾›äº† useDeferredValue å¯ä»¥è®©çŠ¶æ€æ»åæ´¾ç”Ÿã€‚useDeferredValue çš„å®ç°æ•ˆæœä¹Ÿç±»ä¼¼äº transtionï¼Œå½“è¿«åˆ‡çš„ä»»åŠ¡æ‰§è¡Œåï¼Œå†å¾—åˆ°æ–°çš„çŠ¶æ€ï¼Œè€Œè¿™ä¸ªæ–°çš„çŠ¶æ€å°±ç§°ä¹‹ä¸º DeferredValueã€‚

**useDeferredValue åŸºç¡€ä»‹ç»ï¼š**

useDeferredValue å’Œä¸Šè¿° useTransition æœ¬è´¨ä¸Šæœ‰ä»€ä¹ˆå¼‚åŒå‘¢ï¼Ÿ

\
**ç›¸åŒç‚¹ï¼š** useDeferredValue æœ¬è´¨ä¸Šå’Œå†…éƒ¨å®ç°ä¸ useTransition ä¸€æ ·éƒ½æ˜¯æ ‡è®°æˆäº†è¿‡æ¸¡æ›´æ–°ä»»åŠ¡ã€‚

**ä¸åŒç‚¹ï¼š** useTransition æ˜¯æŠŠ startTransition å†…éƒ¨çš„æ›´æ–°ä»»åŠ¡å˜æˆäº†è¿‡æ¸¡ä»»åŠ¡ transtion,è€Œ useDeferredValue æ˜¯æŠŠåŸå€¼é€šè¿‡è¿‡æ¸¡ä»»åŠ¡å¾—åˆ°æ–°çš„å€¼ï¼Œè¿™ä¸ªå€¼ä½œä¸ºå»¶æ—¶çŠ¶æ€ã€‚ ä¸€ä¸ªæ˜¯å¤„ç†ä¸€æ®µé€»è¾‘ï¼Œå¦ä¸€ä¸ªæ˜¯ç”Ÿäº§ä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚

useDeferredValue æ¥å—ä¸€ä¸ªå‚æ•° value ï¼Œä¸€èˆ¬ä¸ºå¯å˜çš„ state , è¿”å›ä¸€ä¸ªå»¶æ—¶çŠ¶æ€ deferrredValueã€‚

```jsx
const deferrredValue = React.useDeferredValue(value);
```

**useDeferredValue åŸºç¡€ç”¨æ³•ï¼š**

æ¥ä¸‹æ¥æŠŠä¸Šè¾¹é‚£ä¸ªä¾‹å­ç”¨ useDeferredValue æ¥å®ç°ã€‚

```jsx
export default function Index() {
  const [active, setActive] = React.useState("tab1"); //éœ€è¦ç«‹å³å“åº”çš„ä»»åŠ¡ï¼Œç«‹å³æ›´æ–°ä»»åŠ¡
  const deferActive = React.useDeferredValue(active); // æŠŠçŠ¶æ€å»¶æ—¶æ›´æ–°ï¼Œç±»ä¼¼äºè¿‡æ¸¡ä»»åŠ¡
  const handleChangeTab = (activeItem) => {
    setActive(activeItem); // ç«‹å³æ›´æ–°
  };
  const renderData = tab[deferActive]; // ä½¿ç”¨æ»åçŠ¶æ€
  return (
    <div>
      <div className="tab">
        {Object.keys(tab).map((item) => (
          <span
            className={active === item && "active"}
            onClick={() => handleChangeTab(item)}
          >
            {item}
          </span>
        ))}
      </div>
      <ul className="content">
        {renderData.map((item) => (
          <li key={item}>{item}</li>
        ))}
      </ul>
    </div>
  );
}
```

å¦‚ä¸Š active ä¸ºæ­£å¸¸æ”¹å˜çš„çŠ¶æ€ï¼ŒdeferActive ä¸ºæ»åçš„ active çŠ¶æ€ï¼Œæˆ‘ä»¬ä½¿ç”¨æ­£å¸¸çŠ¶æ€å»æ”¹å˜ tab çš„ active çŠ¶æ€ï¼Œä½¿ç”¨æ»åçš„çŠ¶æ€å»æ›´æ–°è§†å›¾ï¼ŒåŒæ ·è¾¾åˆ°äº†æå‡ç”¨æˆ·ä½“éªŒçš„ä½œç”¨ã€‚

## ä¸‰ hooks ä¹‹æ‰§è¡Œå‰¯ä½œç”¨

### 3.1 useEffect

React hooks ä¹Ÿæä¾›äº† api ï¼Œç”¨äºå¼¥è¡¥å‡½æ•°ç»„ä»¶æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçš„ç¼ºé™·ã€‚å…¶æœ¬è´¨ä¸»è¦æ˜¯è¿ç”¨äº† hooks é‡Œé¢çš„ useEffect ï¼Œ useLayoutEffectï¼Œè¿˜æœ‰ useInsertionEffectã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯ useEffect ã€‚æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ useEffect çš„ä½¿ç”¨ã€‚

**useEffect åŸºç¡€ä»‹ç»ï¼š**

```jsx
useEffect(() => {
  return destory;
}, dep);
```

useEffect ç¬¬ä¸€ä¸ªå‚æ•° callback, è¿”å›çš„ destory ï¼Œ destory ä½œä¸ºä¸‹ä¸€æ¬¡ callback æ‰§è¡Œä¹‹å‰è°ƒç”¨ï¼Œç”¨äºæ¸…é™¤ä¸Šä¸€æ¬¡ callback äº§ç”Ÿçš„å‰¯ä½œç”¨ã€‚

ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºä¾èµ–é¡¹ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥æœ‰å¤šä¸ªä¾èµ–é¡¹ï¼Œä¾èµ–é¡¹æ”¹å˜ï¼Œæ‰§è¡Œä¸Šä¸€æ¬¡ callback è¿”å›çš„ destory ï¼Œå’Œæ‰§è¡Œæ–°çš„ effect ç¬¬ä¸€ä¸ªå‚æ•° callback ã€‚

å¯¹äº useEffect æ‰§è¡Œï¼Œ React å¤„ç†é€»è¾‘æ˜¯é‡‡ç”¨å¼‚æ­¥è°ƒç”¨ ï¼Œå¯¹äºæ¯ä¸€ä¸ª effect çš„ callbackï¼Œ React ä¼šå‘ setTimeout å›è°ƒå‡½æ•°ä¸€æ ·ï¼Œæ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œç­‰åˆ°ä¸»çº¿ç¨‹ä»»åŠ¡å®Œæˆï¼ŒDOM æ›´æ–°ï¼Œjs æ‰§è¡Œå®Œæˆï¼Œè§†å›¾ç»˜åˆ¶å®Œæ¯•ï¼Œæ‰æ‰§è¡Œã€‚æ‰€ä»¥ effect å›è°ƒå‡½æ•°ä¸ä¼šé˜»å¡æµè§ˆå™¨ç»˜åˆ¶è§†å›¾ã€‚

**useEffect åŸºç¡€ç”¨æ³•ï¼š**

```jsx
/* æ¨¡æ‹Ÿæ•°æ®äº¤äº’ */
function getUserInfo(a) {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve({
        name: a,
        age: 16,
      });
    }, 500);
  });
}

const Demo = ({ a }) => {
  const [userMessage, setUserMessage]: any = useState({});
  const div = useRef();
  const [number, setNumber] = useState(0);
  /* æ¨¡æ‹Ÿäº‹ä»¶ç›‘å¬å¤„ç†å‡½æ•° */
  const handleResize = () => {};
  /* useEffectä½¿ç”¨ ï¼Œè¿™é‡Œå¦‚æœä¸åŠ é™åˆ¶ ï¼Œä¼šæ˜¯å‡½æ•°é‡å¤æ‰§è¡Œï¼Œé™·å…¥æ­»å¾ªç¯*/
  useEffect(() => {
    /* è¯·æ±‚æ•°æ® */
    getUserInfo(a).then((res) => {
      setUserMessage(res);
    });
    /* å®šæ—¶å™¨ å»¶æ—¶å™¨ç­‰ */
    const timer = setInterval(() => console.log(666), 1000);
    /* æ“ä½œdom  */
    console.log(div.current); /* div */
    /* äº‹ä»¶ç›‘å¬ç­‰ */
    window.addEventListener("resize", handleResize);
    /* æ­¤å‡½æ•°ç”¨äºæ¸…é™¤å‰¯ä½œç”¨ */
    return function () {
      clearInterval(timer);
      window.removeEventListener("resize", handleResize);
    };
    /* åªæœ‰å½“props->aå’Œstate->numberæ”¹å˜çš„æ—¶å€™ ,useEffectå‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œ ï¼Œå¦‚æœæ­¤æ—¶æ•°ç»„ä¸ºç©º[]ï¼Œè¯æ˜å‡½æ•°åªæœ‰åœ¨åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ç›¸å½“äºcomponentDidMount */
  }, [a, number]);
  return (
    <div ref={div}>
      <span>{userMessage.name}</span>
      <span>{userMessage.age}</span>
      <div onClick={() => setNumber(1)}>{number}</div>
    </div>
  );
};
```

å¦‚ä¸Šåœ¨ useEffect ä¸­åšçš„åŠŸèƒ½å¦‚ä¸‹ï¼š

- â‘  è¯·æ±‚æ•°æ®ã€‚
- â‘¡ è®¾ç½®å®šæ—¶å™¨,å»¶æ—¶å™¨ç­‰ã€‚
- â‘¢ æ“ä½œ dom , åœ¨ React Native ä¸­å¯ä»¥é€šè¿‡ ref è·å–å…ƒç´ ä½ç½®ä¿¡æ¯ç­‰å†…å®¹ã€‚
- â‘£ æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨, äº‹ä»¶ç»‘å®šï¼Œåœ¨ React Native ä¸­å¯ä»¥æ³¨å†Œ NativeEventEmitter ã€‚
- â‘¤ è¿˜å¯ä»¥æ¸…é™¤å®šæ—¶å™¨ï¼Œå»¶æ—¶å™¨ï¼Œè§£ç»‘äº‹ä»¶ç›‘å¬å™¨ç­‰ã€‚

### 3.2 useLayoutEffect

**useLayoutEffect åŸºç¡€ä»‹ç»ï¼š**

useLayoutEffect å’Œ useEffect ä¸åŒçš„åœ°æ–¹æ˜¯é‡‡ç”¨äº†åŒæ­¥æ‰§è¡Œï¼Œé‚£ä¹ˆå’Œ useEffect æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ

â‘  é¦–å…ˆ useLayoutEffect æ˜¯åœ¨ DOM æ›´æ–°ä¹‹åï¼Œæµè§ˆå™¨ç»˜åˆ¶ä¹‹å‰ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿ä¿®æ”¹ DOMï¼Œè·å– DOM ä¿¡æ¯ï¼Œè¿™æ ·æµè§ˆå™¨åªä¼šç»˜åˆ¶ä¸€æ¬¡ï¼Œå¦‚æœä¿®æ”¹ DOM å¸ƒå±€æ”¾åœ¨ useEffect ï¼Œé‚£ useEffect æ‰§è¡Œæ˜¯åœ¨æµè§ˆå™¨ç»˜åˆ¶è§†å›¾ä¹‹åï¼Œæ¥ä¸‹æ¥åˆæ”¹ DOM ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´æµè§ˆå™¨å†æ¬¡å›æµå’Œé‡ç»˜ã€‚è€Œä¸”ç”±äºä¸¤æ¬¡ç»˜åˆ¶ï¼Œè§†å›¾ä¸Šå¯èƒ½ä¼šé€ æˆé—ªç°çªå…€çš„æ•ˆæœã€‚

â‘¡ useLayoutEffect callback ä¸­ä»£ç æ‰§è¡Œä¼šé˜»å¡æµè§ˆå™¨ç»˜åˆ¶ã€‚

**useEffect åŸºç¡€ç”¨æ³•ï¼š**

```jsx
const DemoUseLayoutEffect = () => {
  const target = useRef();
  useLayoutEffect(() => {
    /*æˆ‘ä»¬éœ€è¦åœ¨domç»˜åˆ¶ä¹‹å‰ï¼Œç§»åŠ¨domåˆ°åˆ¶å®šä½ç½®*/
    const { x, y } = getPositon(); /* è·å–è¦ç§»åŠ¨çš„ x,yåæ ‡ */
    animate(target.current, { x, y });
  }, []);
  return (
    <div>
      <span ref={target} className="animate"></span>
    </div>
  );
};
```

### 3.3 useInsertionEffect

**useInsertionEffect åŸºç¡€ä»‹ç»ï¼š**

useInsertionEffect æ˜¯åœ¨ React v18 æ–°æ·»åŠ çš„ hooks ï¼Œå®ƒçš„ç”¨æ³•å’Œ useEffect å’Œ useLayoutEffect ä¸€æ ·ã€‚é‚£ä¹ˆè¿™ä¸ª hooks ç”¨äºä»€ä¹ˆå‘¢?

åœ¨ä»‹ç» useInsertionEffect ç”¨é€”ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹ useInsertionEffect çš„æ‰§è¡Œæ—¶æœºã€‚

```jsx
React.useEffect(() => {
  console.log("useEffect æ‰§è¡Œ");
}, []);

React.useLayoutEffect(() => {
  console.log("useLayoutEffect æ‰§è¡Œ");
}, []);

React.useInsertionEffect(() => {
  console.log("useInsertionEffect æ‰§è¡Œ");
}, []);
```

æ‰“å°ï¼š useInsertionEffect æ‰§è¡Œ -> useLayoutEffect æ‰§è¡Œ -> useEffect æ‰§è¡Œ

å¯ä»¥çœ‹åˆ° useInsertionEffect çš„æ‰§è¡Œæ—¶æœºè¦æ¯” useLayoutEffect æå‰ï¼ŒuseLayoutEffect æ‰§è¡Œçš„æ—¶å€™ DOM å·²ç»æ›´æ–°äº†ï¼Œä½†æ˜¯åœ¨ useInsertionEffect çš„æ‰§è¡Œçš„æ—¶å€™ï¼ŒDOM è¿˜æ²¡æœ‰æ›´æ–°ã€‚æœ¬è´¨ä¸Š useInsertionEffect ä¸»è¦æ˜¯è§£å†³ CSS-in-JS åœ¨æ¸²æŸ“ä¸­æ³¨å…¥æ ·å¼çš„æ€§èƒ½é—®é¢˜ã€‚è¿™ä¸ª hooks ä¸»è¦æ˜¯åº”ç”¨äºè¿™ä¸ªåœºæ™¯ï¼Œåœ¨å…¶ä»–åœºæ™¯ä¸‹ React ä¸æœŸæœ›ç”¨è¿™ä¸ª hooks ã€‚

**useInsertionEffect æ¨¡æ‹Ÿä½¿ç”¨ï¼š**

```jsx
export default function Index() {
  React.useInsertionEffect(() => {
    /* åŠ¨æ€åˆ›å»º style æ ‡ç­¾æ’å…¥åˆ° head ä¸­ */
    const style = document.createElement("style");
    style.innerHTML = `
       .css-in-js{
         color: red;
         font-size: 20px;
       }
     `;
    document.head.appendChild(style);
  }, []);

  return <div className="css-in-js"> hello , useInsertionEffect </div>;
}
```

å¦‚ä¸Šæ¨¡æ‹Ÿäº† useInsertionEffect çš„ä½¿ç”¨ã€‚

## å›› hooks ä¹‹çŠ¶æ€è·å–ä¸ä¼ é€’

### 4.1 useContext

**useContext åŸºç¡€ä»‹ç»**

å¯ä»¥ä½¿ç”¨ useContext ï¼Œæ¥è·å–çˆ¶çº§ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ context å€¼ï¼Œè¿™ä¸ªå½“å‰å€¼å°±æ˜¯æœ€è¿‘çš„çˆ¶çº§ç»„ä»¶ Provider è®¾ç½®çš„ value å€¼ï¼ŒuseContext å‚æ•°ä¸€èˆ¬æ˜¯ç”± createContext æ–¹å¼åˆ›å»ºçš„ ,ä¹Ÿå¯ä»¥çˆ¶çº§ä¸Šä¸‹æ–‡ context ä¼ é€’çš„ ( å‚æ•°ä¸º context )ã€‚useContext å¯ä»¥ä»£æ›¿ context.Consumer æ¥è·å– Provider ä¸­ä¿å­˜çš„ value å€¼ã€‚

```jsx
const contextValue = useContext(context);
```

useContext æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä¸€èˆ¬éƒ½æ˜¯ context å¯¹è±¡ï¼Œè¿”å›å€¼ä¸º context å¯¹è±¡å†…éƒ¨ä¿å­˜çš„ value å€¼ã€‚

**useContext åŸºç¡€ç”¨æ³•ï¼š**

```jsx
/* ç”¨useContextæ–¹å¼ */
const DemoContext = () => {
  const value: any = useContext(Context);
  /* my name is alien */
  return <div> my name is {value.name}</div>;
};

/* ç”¨Context.Consumer æ–¹å¼ */
const DemoContext1 = () => {
  return (
    <Context.Consumer>
      {/*  my name is alien  */}
      {(value) => <div> my name is {value.name}</div>}
    </Context.Consumer>
  );
};

export default () => {
  return (
    <div>
      <Context.Provider value={{ name: "alien", age: 18 }}>
        <DemoContext />
        <DemoContext1 />
      </Context.Provider>
    </div>
  );
};
```

### 4.2 useRef

**useRef åŸºç¡€ä»‹ç»ï¼š**

useRef å¯ä»¥ç”¨æ¥è·å–å…ƒç´ ï¼Œç¼“å­˜çŠ¶æ€ï¼Œæ¥å—ä¸€ä¸ªçŠ¶æ€ initState ä½œä¸ºåˆå§‹å€¼ï¼Œè¿”å›ä¸€ä¸ª ref å¯¹è±¡ cur, cur ä¸Šæœ‰ä¸€ä¸ª current å±æ€§å°±æ˜¯ ref å¯¹è±¡éœ€è¦è·å–çš„å†…å®¹ã€‚

```jsx
const cur = React.useRef(initState);
console.log(cur.current);
```

**useRef åŸºç¡€ç”¨æ³•ï¼š**

**useRef è·å– DOM å…ƒ**ç´ ï¼Œåœ¨ React Native ä¸­è™½ç„¶æ²¡æœ‰ DOM å…ƒç´ ï¼Œä½†æ˜¯ä¹Ÿèƒ½å¤Ÿè·å–ç»„ä»¶çš„èŠ‚ç‚¹ä¿¡æ¯ï¼ˆ fiber ä¿¡æ¯ ï¼‰ã€‚

```jsx
const DemoUseRef = () => {
  const dom = useRef(null);
  const handerSubmit = () => {
    /*  <div >è¡¨å•ç»„ä»¶</div>  dom èŠ‚ç‚¹ */
    console.log(dom.current);
  };
  return (
    <div>
      {/* ref æ ‡è®°å½“å‰domèŠ‚ç‚¹ */}
      <div ref={dom}>è¡¨å•ç»„ä»¶</div>
      <button onClick={() => handerSubmit()}>æäº¤</button>
    </div>
  );
};
```

å¦‚ä¸Šé€šè¿‡ useRef æ¥è·å– DOM èŠ‚ç‚¹ã€‚

**useRef ä¿å­˜çŠ¶æ€ï¼Œ** å¯ä»¥åˆ©ç”¨ useRef è¿”å›çš„ ref å¯¹è±¡æ¥ä¿å­˜çŠ¶æ€ï¼Œåªè¦å½“å‰ç»„ä»¶ä¸è¢«é”€æ¯ï¼Œé‚£ä¹ˆçŠ¶æ€å°±ä¼šä¸€ç›´å­˜åœ¨ã€‚

```jsx
const status = useRef(false);
/* æ”¹å˜çŠ¶æ€ */
const handleChangeStatus = () => {
  status.current = true;
};
```

### 4.3 useImperativeHandle

**useImperativeHandle åŸºç¡€ä»‹ç»ï¼š**

useImperativeHandle å¯ä»¥é…åˆ forwardRef è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚è¿™ä¸ªå¾ˆæœ‰ç”¨ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºå­ç»„ä»¶ï¼Œå¦‚æœæ˜¯ class ç±»ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ref è·å–ç±»ç»„ä»¶çš„å®ä¾‹ï¼Œä½†æ˜¯åœ¨å­ç»„ä»¶æ˜¯å‡½æ•°ç»„ä»¶çš„æƒ…å†µï¼Œå¦‚æœæˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡ ref çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶ useImperativeHandle å’Œ forwardRef é…åˆå°±èƒ½è¾¾åˆ°æ•ˆæœã€‚

useImperativeHandle æ¥å—ä¸‰ä¸ªå‚æ•°ï¼š

- â‘  ç¬¬ä¸€ä¸ªå‚æ•° ref: æ¥å— forWardRef ä¼ é€’è¿‡æ¥çš„ refã€‚
- â‘¡ ç¬¬äºŒä¸ªå‚æ•° createHandle ï¼šå¤„ç†å‡½æ•°ï¼Œè¿”å›å€¼ä½œä¸ºæš´éœ²ç»™çˆ¶ç»„ä»¶çš„ ref å¯¹è±¡ã€‚
- â‘¢ ç¬¬ä¸‰ä¸ªå‚æ•° deps : ä¾èµ–é¡¹ deps ï¼Œä¾èµ–é¡¹æ›´æ”¹å½¢æˆæ–°çš„ ref å¯¹è±¡ã€‚

**useImperativeHandle åŸºç¡€ç”¨æ³•ï¼š**

æˆ‘ä»¬æ¥æ¨¡æ‹Ÿç»™åœºæ™¯ï¼Œç”¨ useImperativeHandleï¼Œä½¿å¾—çˆ¶ç»„ä»¶èƒ½è®©å­ç»„ä»¶ä¸­çš„ input è‡ªåŠ¨èµ‹å€¼å¹¶èšç„¦ã€‚

```jsx
function Son(props, ref) {
  console.log(props);
  const inputRef = useRef(null);
  const [inputValue, setInputValue] = useState("");
  useImperativeHandle(
    ref,
    () => {
      const handleRefs = {
        /* å£°æ˜æ–¹æ³•ç”¨äºèšç„¦inputæ¡† */
        onFocus() {
          inputRef.current.focus();
        },
        /* å£°æ˜æ–¹æ³•ç”¨äºæ”¹å˜inputçš„å€¼ */
        onChangeValue(value) {
          setInputValue(value);
        },
      };
      return handleRefs;
    },
    []
  );
  return (
    <div>
      <input placeholder="è¯·è¾“å…¥å†…å®¹" ref={inputRef} value={inputValue} />
    </div>
  );
}

const ForwarSon = forwardRef(Son);

class Index extends React.Component {
  inputRef = null;
  handerClick() {
    const { onFocus, onChangeValue } = this.cur;
    onFocus();
    onChangeValue("let us learn React!");
  }
  render() {
    return (
      <div style={{ marginTop: "50px" }}>
        <ForwarSon ref={(node) => (this.inputRef = node)} />
        <button onClick={this.handerClick.bind(this)}>æ“æ§å­ç»„ä»¶</button>
      </div>
    );
  }
}

```

æ•ˆæœï¼š

![8e8c05f0c82c43719079d4db9536abc0_tplv-k3u1fbpfcp-watermark.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7d3ac8bbce64b539b18ebf58a7789f0~tplv-k3u1fbpfcp-watermark.image?)

## äº” hooks ä¹‹çŠ¶æ€æ´¾ç”Ÿä¸ä¿å­˜

### 5.1 useMemo

useMemo å¯ä»¥åœ¨å‡½æ•°ç»„ä»¶ render ä¸Šä¸‹æ–‡ä¸­åŒæ­¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°é€»è¾‘ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼å¯ä»¥ä½œä¸ºä¸€ä¸ªæ–°çš„çŠ¶æ€ç¼“å­˜èµ·æ¥ã€‚é‚£ä¹ˆè¿™ä¸ª hooks çš„ä½œç”¨å°±æ˜¾è€Œæ˜“è§äº†ï¼š

åœºæ™¯ä¸€ï¼šåœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œéœ€è¦åœ¨å‡½æ•°ç»„ä»¶ä¸­è¿›è¡Œå¤§é‡çš„é€»è¾‘è®¡ç®—ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸æœŸæœ›æ¯ä¸€æ¬¡å‡½æ•°ç»„ä»¶æ¸²æŸ“éƒ½æ‰§è¡Œè¿™äº›å¤æ‚çš„è®¡ç®—é€»è¾‘ï¼Œæ‰€ä»¥å°±éœ€è¦åœ¨ useMemo çš„å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œè¿™äº›é€»è¾‘ï¼Œç„¶åæŠŠå¾—åˆ°çš„äº§ç‰©ï¼ˆè®¡ç®—ç»“æœï¼‰ç¼“å­˜èµ·æ¥å°±å¯ä»¥äº†ã€‚

åœºæ™¯äºŒï¼šReact åœ¨æ•´ä¸ªæ›´æ–°æµç¨‹ä¸­ï¼Œdiff èµ·åˆ°äº†å†³å®šæ€§çš„ä½œç”¨ï¼Œæ¯”å¦‚ Context ä¸­çš„ provider é€šè¿‡ diff value æ¥åˆ¤æ–­æ˜¯å¦æ›´æ–°

**useMemo åŸºç¡€ä»‹ç»ï¼š**

```jsx
const cacheSomething = useMemo(create, deps);
```

- â‘  createï¼šç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼ä½œä¸ºç¼“å­˜å€¼ï¼Œå¦‚ä¸Š demo ä¸­æŠŠ Children å¯¹åº”çš„ element å¯¹è±¡ï¼Œç¼“å­˜èµ·æ¥ã€‚
- â‘¡ depsï¼š ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾å½“å‰ useMemo çš„ä¾èµ–é¡¹ï¼Œåœ¨å‡½æ•°ç»„ä»¶ä¸‹ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šå¯¹æ¯” deps ä¾èµ–é¡¹é‡Œé¢çš„çŠ¶æ€ï¼Œæ˜¯å¦æœ‰æ”¹å˜ï¼Œå¦‚æœæœ‰æ”¹å˜é‡æ–°æ‰§è¡Œ create ï¼Œå¾—åˆ°æ–°çš„ç¼“å­˜å€¼ã€‚
- â‘¢ cacheSomethingï¼šè¿”å›å€¼ï¼Œæ‰§è¡Œ create çš„è¿”å›å€¼ã€‚å¦‚æœ deps ä¸­æœ‰ä¾èµ–é¡¹æ”¹å˜ï¼Œè¿”å›çš„é‡æ–°æ‰§è¡Œ create äº§ç”Ÿçš„å€¼ï¼Œå¦åˆ™å–ä¸Šä¸€æ¬¡ç¼“å­˜å€¼ã€‚

**useMemo åŸºç¡€ç”¨æ³•ï¼š**

æ´¾ç”Ÿæ–°çŠ¶æ€ï¼š

```jsx
function Scope() {
  const keeper = useKeep();
  const { cacheDispatch, cacheList, hasAliveStatus } = keeper;

  /* é€šè¿‡ useMemo å¾—åˆ°æ´¾ç”Ÿå‡ºæ¥çš„æ–°çŠ¶æ€ contextValue  */
  const contextValue = useMemo(() => {
    return {
      cacheDispatch: cacheDispatch.bind(keeper),
      hasAliveStatus: hasAliveStatus.bind(keeper),
      cacheDestory: (payload) =>
        cacheDispatch.call(keeper, { type: ACTION_DESTORY, payload }),
    };
  }, [keeper]);
  return (
    <KeepaliveContext.Provider value={contextValue}></KeepaliveContext.Provider>
  );
}
```

å¦‚ä¸Šé€šè¿‡ useMemo å¾—åˆ°æ´¾ç”Ÿå‡ºæ¥çš„æ–°çŠ¶æ€ contextValue ï¼Œåªæœ‰ keeper å˜åŒ–çš„æ—¶å€™ï¼Œæ‰æ”¹å˜ Provider çš„ value ã€‚

ç¼“å­˜è®¡ç®—ç»“æœï¼š

```jsx
function Scope() {
  const style = useMemo(() => {
    let computedStyle = {};
    // ç»è¿‡å¤§é‡çš„è®¡ç®—
    return computedStyle;
  }, []);
  return <div style={style}></div>;
}
```

ç¼“å­˜ç»„ä»¶,å‡å°‘å­ç»„ä»¶ rerender æ¬¡æ•°ï¼š

```jsx
function Scope({ children }) {
  const renderChild = useMemo(() => {
    children();
  }, [children]);
  return <div>{renderChild} </div>;
}
```

### 5.2 useCallback

**useCallback åŸºç¡€ä»‹ç»ï¼š**

useMemo å’Œ useCallback æ¥æ”¶çš„å‚æ•°éƒ½æ˜¯ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨å…¶ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–åæ‰æ‰§è¡Œï¼Œéƒ½æ˜¯è¿”å›ç¼“å­˜çš„å€¼ï¼ŒåŒºåˆ«åœ¨äº useMemo è¿”å›çš„æ˜¯å‡½æ•°è¿è¡Œçš„ç»“æœï¼ŒuseCallback è¿”å›çš„æ˜¯å‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°æ˜¯ç»è¿‡å¤„ç†åçš„ä¹Ÿå°±æ˜¯è¯´çˆ¶ç»„ä»¶ä¼ é€’ä¸€ä¸ªå‡½æ•°ç»™å­ç»„ä»¶çš„æ—¶å€™ï¼Œç”±äºæ˜¯æ— çŠ¶æ€ç»„ä»¶æ¯ä¸€æ¬¡éƒ½ä¼šé‡æ–°ç”Ÿæˆæ–°çš„ props å‡½æ•°ï¼Œè¿™æ ·å°±ä½¿å¾—æ¯ä¸€æ¬¡ä¼ é€’ç»™å­ç»„ä»¶çš„å‡½æ•°éƒ½å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™æ—¶å€™å°±ä¼šè§¦å‘å­ç»„ä»¶çš„æ›´æ–°ï¼Œè¿™äº›æ›´æ–°æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ usecallback æ¥å¤„ç†æ­¤å‡½æ•°ï¼Œç„¶åä½œä¸º props ä¼ é€’ç»™å­ç»„ä»¶ã€‚

**useCallback åŸºç¡€ç”¨æ³•ï¼š**

```jsx
/* ç”¨react.memo */
const DemoChildren = React.memo((props) => {
  /* åªæœ‰åˆå§‹åŒ–çš„æ—¶å€™æ‰“å°äº† å­ç»„ä»¶æ›´æ–° */
  console.log("å­ç»„ä»¶æ›´æ–°");
  useEffect(() => {
    props.getInfo("å­ç»„ä»¶");
  }, []);
  return <div>å­ç»„ä»¶</div>;
});

const DemoUseCallback = ({ id }) => {
  const [number, setNumber] = useState(1);
  /* æ­¤æ—¶usecallbackçš„ç¬¬ä¸€å‚æ•° (sonName)=>{ console.log(sonName) }
     ç»è¿‡å¤„ç†èµ‹å€¼ç»™ getInfo */
  const getInfo = useCallback(
    (sonName) => {
      console.log(sonName);
    },
    [id]
  );
  return (
    <div>
      {/* ç‚¹å‡»æŒ‰é’®è§¦å‘çˆ¶ç»„ä»¶æ›´æ–° ï¼Œä½†æ˜¯å­ç»„ä»¶æ²¡æœ‰æ›´æ–° */}
      <button onClick={() => setNumber(number + 1)}>å¢åŠ </button>
      <DemoChildren getInfo={getInfo} />
    </div>
  );
};
```

## å…­ hooks ä¹‹å·¥å…· hooks

### 6.1 useDebugValue

> æˆ‘ä»¬ä¸æ¨èä½ å‘æ¯ä¸ªè‡ªå®šä¹‰ Hook æ·»åŠ  debug å€¼ã€‚å½“å®ƒä½œä¸ºå…±äº«åº“çš„ä¸€éƒ¨åˆ†æ—¶æ‰æœ€æœ‰ä»·å€¼ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ ¼å¼åŒ–å€¼çš„æ˜¾ç¤ºå¯èƒ½æ˜¯ä¸€é¡¹å¼€é”€å¾ˆå¤§çš„æ“ä½œã€‚é™¤ééœ€è¦æ£€æŸ¥ Hookï¼Œå¦åˆ™æ²¡æœ‰å¿…è¦è¿™ä¹ˆåšã€‚å› æ­¤ï¼ŒuseDebugValue æ¥å—ä¸€ä¸ªæ ¼å¼åŒ–å‡½æ•°ä½œä¸ºå¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚è¯¥å‡½æ•°åªæœ‰åœ¨ Hook è¢«æ£€æŸ¥æ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚å®ƒæ¥å— debug å€¼ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”ä¼šè¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ˜¾ç¤ºå€¼ã€‚

**useDebugValue åŸºç¡€ä»‹ç»ï¼š**

useDebugValue å¯ç”¨äºåœ¨ React å¼€å‘è€…å·¥å…·ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰ hook çš„æ ‡ç­¾ã€‚è¿™ä¸ª hooks ç›®çš„å°±æ˜¯æ£€æŸ¥è‡ªå®šä¹‰ hooksã€‚

**useDebugValue åŸºæœ¬ä½¿ç”¨ï¼š**

```jsx
function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);
  // ...
  // åœ¨å¼€å‘è€…å·¥å…·ä¸­çš„è¿™ä¸ª Hook æ—è¾¹æ˜¾ç¤ºæ ‡ç­¾
  // e.g. "FriendStatus: Online"
  useDebugValue(isOnline ? "Online" : "Offline");

  return isOnline;
}
```

### 6.2 useId

**useID åŸºç¡€ä»‹ç»:**

useId ä¹Ÿæ˜¯ React v18 äº§ç”Ÿçš„æ–°çš„ hooks , å®ƒå¯ä»¥åœ¨ client å’Œ server ç”Ÿæˆå”¯ä¸€çš„ id , è§£å†³äº†åœ¨æœåŠ¡å™¨æ¸²æŸ“ä¸­ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯äº§ç”Ÿ id ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæ›´é‡è¦çš„æ˜¯ä¿éšœäº† React v18 ä¸­ **streaming renderer ï¼ˆæµå¼æ¸²æŸ“ï¼‰** ä¸­ id çš„ç¨³å®šæ€§ã€‚

**ä½ç‰ˆæœ¬ React ssr å­˜åœ¨çš„é—®é¢˜ï¼š**

æ¯”å¦‚åœ¨ä¸€äº›é¡¹ç›®æˆ–è€…æ˜¯å¼€æºåº“ä¸­ç”¨ Math.random() ä½œä¸º ID çš„æ—¶å€™ï¼Œå¯ä»¥ä¼šæœ‰ä¸€äº›éšæœºç”Ÿæˆ id çš„åœºæ™¯ï¼š

```jsx
const rid = Math.random() + "_id_"; /* ç”Ÿæˆä¸€ä¸ªéšæœºid  */
function Demo() {
  // ä½¿ç”¨ rid
  return <div id={rid}></div>;
}
```

è¿™åœ¨çº¯å®¢æˆ·ç«¯æ¸²æŸ“ä¸­æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™ï¼Œä¼ ç»Ÿæ¨¡å¼ä¸‹éœ€è¦èµ°å¦‚ä¸‹æµç¨‹ï¼š

![e54da686-6d8e-4431-a378-c05ac49cb6fb.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6194d676b37f41ba9f2b134a513d65c4~tplv-k3u1fbpfcp-watermark.image?)

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå½“æœåŠ¡ç«¯æ¸²æŸ“åˆ° html å’Œ hydrate è¿‡ç¨‹åˆ†åˆ«åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œï¼Œä½†æ˜¯ä¼šèµ°ä¸¤é id çš„ç”Ÿæˆæµç¨‹ï¼Œè¿™æ ·å°±ä¼šé€ æˆ id ä¸ä¸€è‡´çš„æƒ…å†µå‘ç”Ÿã€‚useId çš„å‡ºç°èƒ½æœ‰æ•ˆçš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

**useId åŸºæœ¬ç”¨æ³•:**

```jsx
function Demo() {
  const rid = useId(); // ç”Ÿæˆç¨³å®šçš„ id
  return <div id={rid}></div>;
}
```

**v18 ssr**

åœ¨ React v18 ä¸­ å¯¹ ssr å¢åŠ äº†æµå¼æ¸²æŸ“çš„ç‰¹æ€§ [New Suspense SSR Architecture in React 18 ](https://github.com/reactwg/react-18/discussions/37)ï¼Œ é‚£ä¹ˆè¿™ä¸ªç‰¹æ€§æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼š

åœ¨ä¼ ç»Ÿ React ssr ä¸­ï¼Œå¦‚æœæ­£å¸¸æƒ…å†µä¸‹ï¼Œ hydrate è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š

![WechatIMG6936.jpeg](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a96d5fa7247a4d8ab79bfe9f909c5f3f~tplv-k3u1fbpfcp-watermark.image?)

åˆšå¼€å§‹çš„æ—¶å€™ï¼Œå› ä¸ºæœåŠ¡ç«¯æ¸²æŸ“ï¼Œåªä¼šæ¸²æŸ“ html ç»“æ„ï¼Œæ­¤æ—¶è¿˜æ²¡æ³¨å…¥ js é€»è¾‘ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒç”¨ç°è‰²ä¸èƒ½äº¤äº’çš„æ¨¡å—è¡¨ç¤ºã€‚ï¼ˆå¦‚ä¸Šç°è‰²çš„æ¨¡å—ä¸èƒ½åšç”¨æˆ·äº¤äº’ï¼Œæ¯”å¦‚ç‚¹å‡»äº‹ä»¶ä¹‹ç±»çš„ã€‚ï¼‰

hydrate js åŠ è½½ä¹‹åï¼Œæ­¤æ—¶çš„æ¨¡å—å¯ä»¥æ­£å¸¸äº¤äº’ï¼Œæ‰€ä»¥ç”¨ç»¿è‰²çš„æ¨¡å—å±•ç¤ºã€‚

ä½†æ˜¯å¦‚æœå…¶ä¸­ä¸€ä¸ªæ¨¡å—ï¼ŒæœåŠ¡ç«¯è¯·æ±‚æ•°æ®ï¼Œæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œè€—è´¹æ—¶é—´é•¿ï¼Œæˆ‘ä»¬ä¸æœŸæœ›åœ¨æœåŠ¡ç«¯å®Œå…¨å½¢æˆ html ä¹‹ååœ¨æ¸²æŸ“ï¼Œé‚£ä¹ˆ React 18 ç»™äº†ä¸€ä¸ªæ–°çš„å¯èƒ½æ€§ã€‚å¯ä»¥ä½¿ç”¨ `<Suspense>` åŒ…è£…é¡µé¢çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åè®©è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹å…ˆæŒ‚èµ·ã€‚

æ¥ä¸‹æ¥ä¼šé€šè¿‡ script åŠ è½½ js çš„æ–¹å¼ æµå¼æ³¨å…¥ html ä»£ç çš„ç‰‡æ®µï¼Œæ¥è¡¥å……æ•´ä¸ªé¡µé¢ã€‚æ¥ä¸‹æ¥çš„æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š

![d94d8ddb-bdcd-4be8-a851-4927c7966b99.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c3bc06ab86554f92940e82d8f9d1a64c~tplv-k3u1fbpfcp-watermark.image?)

åœ¨è¿™ä¸ªåŸç†åŸºç¡€ä¹‹ä¸Šï¼Œ React ä¸ªç‰¹æ€§å« Selective Hydrationï¼Œå¯ä»¥**æ ¹æ®ç”¨æˆ·äº¤äº’æ”¹å˜ hydrate çš„é¡ºåº**ã€‚

æ¯”å¦‚æœ‰ä¸¤ä¸ªæ¨¡å—éƒ½æ˜¯é€šè¿‡ Suspense æŒ‚èµ·çš„ï¼Œå½“ä¸¤ä¸ªæ¨¡å—å‘ç”Ÿäº¤äº’é€»è¾‘æ—¶ï¼Œä¼šæ ¹æ®äº¤äº’æ¥é€‰æ‹©æ€§åœ°æ”¹å˜ hydrate çš„é¡ºåºã€‚

![ede45613-9994-4e77-9f50-5b7c1faf1160.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b6ce39daec1347c9bb023fe1d0f13ada~tplv-k3u1fbpfcp-watermark.image?)

å¦‚ä¸Š C D é€‰æ‹©æ€§çš„ hydrate å°±æ˜¯ Selective Hydration çš„ç»“æœã€‚é‚£ä¹ˆå›åˆ°ä¸»è§’ useId ä¸Šï¼Œå¦‚æœåœ¨ hydrate è¿‡ç¨‹ä¸­ï¼ŒC D æ¨¡å— id æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ¯”å¦‚å¦‚ä¸‹ï¼š

```jsx
let id = 0;
function makeId() {
  return id++;
}
function Demo() {
  const id = useRef(makeId());
  return <div id={id}>...</div>;
}
```

é‚£ä¹ˆå¦‚æœç»„ä»¶æ˜¯ Selective Hydration , é‚£ä¹ˆæ³¨å†Œç»„ä»¶çš„é¡ºåºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æœ‰å¯èƒ½ä¸ç»Ÿä¸€ï¼Œè¿™æ ·è¡¨ç°å°±ä¼šä¸ä¸€è‡´äº†ã€‚é‚£ä¹ˆç”¨ useId åŠ¨æ€ç”Ÿæˆ id å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜äº§ç”Ÿäº†ï¼Œæ‰€ä»¥è¯´ useId ä¿éšœäº† React v18 ä¸­ **streaming renderer ï¼ˆæµå¼æ¸²æŸ“ï¼‰** ä¸­ id çš„ç¨³å®šæ€§ã€‚

## ä¸ƒ æ€»ç»“

æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† React Hooks äº§ç”Ÿåˆè¡·ä»¥åŠ React Hooksï¼Œå¸Œæœ›çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„åŒå­¦ï¼Œå¯ä»¥è®°ä½æ¯ä¸€ä¸ª hooks çš„ä½¿ç”¨åœºæ™¯ï¼Œåœ¨é¡¹ç›®ä¸­ç†Ÿç»ƒä½¿ç”¨èµ·æ¥ã€‚

### å‚è€ƒæ–‡æ¡£

- [streamingÂ renderer](https://github.com/reactwg/react-18/discussions/37)
- [react-hooks å¦‚ä½•ä½¿ç”¨ï¼Ÿ](https://juejin.cn/post/6864438643727433741)
- [React è¿›é˜¶å®è·µæŒ‡å—](https://juejin.cn/book/6945998773818490884)
