---
title: React æ·±å…¥ã€ä¸€æ–‡åƒé€React v18å…¨éƒ¨Apiï¼ˆ1.3w+ï¼‰
order: 4
---

::: warning æ–‡ç« éåŸåˆ›

ä½œè€…ï¼šå°æœæœ

æ¥æºï¼šhttps://juejin.cn/post/7124486630483689485

æ³¨æ„ï¼šä¸ªäººå­¦ä¹ ä½¿ç”¨ï¼Œä¼šå¯¹åŸæ–‡è¿›è¡Œä¿®æ”¹æ‰¹æ³¨
:::

# React æ·±å…¥ã€ä¸€æ–‡åƒé€React v18å…¨éƒ¨Apiï¼ˆ1.3w+ï¼‰âœ¨

æˆ‘æŠ½å–äº†ä¸€äº›é—®é¢˜ï¼Œä¸€èµ·æ¥çœ‹çœ‹ï¼š

- 1.`React v18`ä¸­å¯¹`react-dom`åšäº†é‚£äº›æ”¹åŠ¨ï¼Œå¢åŠ äº†é‚£äº›æ–°çš„`hooks`?
- 2.`useRef`é™¤äº†è·å–å…ƒç´ çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¿˜èƒ½åšä»€ä¹ˆï¼Ÿ
- 3.ä¸ºä»€ä¹ˆä¼šæœ‰`Children.map`?å®ƒä¸ä¸åŒçš„éå†æœ‰å’Œä¸åŒ
- 4.ç±»ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåœ¨ä¸åŒçš„ç‰ˆæœ¬æ˜¯æ€æ ·å˜åŒ–çš„ï¼Ÿ
- 5.å­å…ƒç´ å¦‚ä½•æ¸²æŸ“åˆ°çˆ¶å…ƒç´ ä¸Šé¢çš„ï¼Ÿ
- ...

å…¶å®é—®é¢˜å¾ˆå¤šï¼Œçœ‹å®Œè¿™ç¯‡æ–‡ç« åï¼Œç›¸ä¿¡ä¸€å®šèƒ½å¸®ä½ è§£ç­”çš„éå¸¸æ¸…æ¥šï¼Œè¿˜è¯·å„ä½å°ä¼™ä¼´å¤šå¤šæ”¯æŒä¸€ä¸‹

## å‰è¨€

> åœ¨ä¹‹å‰çš„å‡ ç¯‡æ–‡ç« ä¸­ï¼Œæœ‰è‡ªå®šä¹‰`hooks`ã€`HOC`ã€`è™šæ‹ŸDOM`å’Œ`diffç®—æ³•`ï¼Œå¤šå¤šå°‘å°‘éƒ½æœ‰ React å®˜æ–¹ Api åšä¸ºåŸºç¡€æ¡ä»¶ï¼Œæˆ‘çš„è¿™ä¸ªä¸“æ çš„ç›®çš„å°±æ˜¯å¯¹`React`çš„æ·±å…¥ï¼Œå°±æ˜¯å¸Œæœ›å¯¹`React`æœ‰ä¸€ä¸ªå…¨é¢çš„æå‡
>
> å†™è¿™ç¯‡æ–‡ç« çš„ä¸»è¦ç›®çš„æœ‰ï¼š
>
> - æå‡çŸ¥è¯†å¹¿åº¦ï¼Œè¦æƒ³æ·±å…¥`React`å°±å¿…é¡»å…¨é¢äº†è§£`React`ï¼Œé¦–å…ˆè¦å­¦ä¼šç”¨ï¼Œè¦çŸ¥é“ï¼Œå¦‚æœè¿çŸ¥é“éƒ½ä¸çŸ¥é“ï¼Œè°ˆä½•æ·±å…¥ï¼Ÿ
> - `React v18` å¯¹ `react-dom`çš„æ”¹åŠ¨è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå¹¶ä¸”æ–°å¢äº†äº”ä¸ª`hooks`,é€ä¸€ç›˜ç‚¹ä¸€ä¸‹ï¼Œçœ‹çœ‹åšäº†é‚£äº›æ”¹åŠ¨
> - è¿™ä¸ªä¸“æ å®é™…ä¸Šæ˜¯å¾ªåºæ¸è¿›çš„ï¼Œç›¸äº’ä¹‹é—´éƒ½æœ‰ä¸€å®šçš„å…³è”ï¼ŒåŒæ—¶è¦æƒ³çœ‹æ‡‚ï¼Œä¹Ÿéœ€è¦æœ‰ä¸€å®šçš„`React`åŸºç¡€ï¼Œå¯¹åˆšå¼€å§‹å­¦ä¹ `React`çš„å°ä¼™ä¼´å¯èƒ½å¹¶ä¸æ˜¯å¤ªå‹å¥½ï¼Œæ‰€ä»¥ç‰¹åœ°æ€»ç»“ä¸€ç•ªï¼Œç”¨æœ€ç®€å•çš„ç¤ºä¾‹ï¼Œå¸®ä½ æŒæ¡è¿™äº› Api
> - å¯¹ä¹‹åçš„æºç æœ‰å¸®åŠ©ï¼Œæ‰€ä»¥æœ¬ç¯‡æ–‡ç« å°†ä¼šå…¨é¢è§£è¯»`React Api`çš„ä½¿ç”¨æ–¹æ³•ï¼Œå’Œåœºæ™¯ï¼Œå¦‚æœ‰ä¸è¶³ï¼Œè¿˜å¸Œæœ›åœ¨è¯„è®ºåŒºæŒ‡å‡ºï½

é™„ä¸Šä¸€å¼ ä»Šå¤©çš„å­¦ä¹ å›¾è°±ï½

![å…¨é¢è§£è¯»ReactApi.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/562c26a1f2394bd1a27c38cba266b848~tplv-k3u1fbpfcp-watermark.image?)

## ç»„ä»¶ç±»

### Component

åœ¨ React ä¸­æä¾›ä¸¤ç§å½¢å¼ï¼Œä¸€ç§æ˜¯`ç±»ç»„ä»¶`ï¼Œå¦ä¸€ç§æ˜¯`å‡½æ•°å¼ç»„ä»¶`ï¼Œè€Œåœ¨`ç±»ç»„ä»¶`ç»„ä»¶ä¸­éœ€è¦ä½¿ç”¨`Component`ç»§æ‰¿ï¼Œè¿™ä¸ªç»„ä»¶æ²¡æœ‰ä»€ä¹ˆå¥½è®²çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹æºç ï¼š

æ–‡ä»¶ä½ç½®`packages/react/src/ReactBaseClasses.js`

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/11cdee40208f4dacb18b982fbc492c18~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥çœ‹å‡º`Component`è¿›è¡Œä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œï¼Œ`updater`ä¿å­˜ç€æ›´æ–°ç»„ä»¶çš„æ–¹æ³•

### PureComponent

**PureComponent**ï¼šä¼šå¯¹`props`å’Œ`state`è¿›è¡Œæµ…æ¯”è¾ƒï¼Œè·³è¿‡ä¸å¿…è¦çš„æ›´æ–°ï¼Œæé«˜ç»„ä»¶æ€§èƒ½ã€‚

å¯ä»¥è¯´`PureComponent`å’Œ`Component`åŸºæœ¬å®Œå…¨ä¸€è‡´ï¼Œä½†`PureComponent`ä¼šæµ…æ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯è¾ƒå°‘`render`æ¸²æŸ“çš„æ¬¡æ•°ï¼Œæ‰€ä»¥`PureComponent`ä¸€èˆ¬ç”¨äºæ€§èƒ½ä¼˜åŒ–

é‚£ä¹ˆä»€ä¹ˆæ˜¯æµ…æ¯”è¾ƒï¼Œä¸¾ä¸ª ğŸŒ°ï¼š

```jsx
import { PureComponent } from "react";
import { Button } from "antd-mobile";

class Index extends PureComponent {
  constructor(props) {
    super(props);
    this.state = {
      data: {
        number: 0,
      },
    };
  }

  render() {
    const { data } = this.state;
    return (
      <div style={{ padding: 20 }}>
        <div> æ•°å­—ï¼š {data.number}</div>
        <Button
          color="primary"
          onClick={() => {
            const { data } = this.state;
            data.number++;
            this.setState({ data });
          }}
        >
          æ•°å­—åŠ 1
        </Button>
      </div>
    );
  }
}

export default Index;
```

æ•ˆæœï¼š

![img1.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9fed4f0cbef7459c8c50069b907e11ab~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥å‘ç°ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ï¼Œæ•°å­—å¹¶æ²¡æœ‰åˆ·æ–°ï¼Œè¿™æ˜¯å› ä¸º`PureComponent`ä¼šæ¯”è¾ƒä¸¤æ¬¡çš„`data`å¯¹è±¡ï¼Œå®ƒä¼šè®¤ä¸ºè¿™ç§å†™æ³•å¹¶æ²¡æœ‰æ”¹å˜åŸå…ˆçš„`data`,æ‰€ä»¥ä¸ä¼šæ”¹å˜

æˆ‘ä»¬åªéœ€è¦ï¼š

```js
this.setState({ data: { ...data } });
```

è¿™æ ·å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜äº†

#### ä¸ shouldComponentUpdate çš„å…³ç³»å¦‚ä½•

åœ¨ç”Ÿå‘½å‘¨æœŸä¸­æœ‰ä¸€ä¸ª`shouldComponentUpdate()`å‡½æ•°ï¼Œé‚£ä¹ˆå®ƒèƒ½æ”¹å˜`PureComponent`å—ï¼Ÿ

å…¶å®æ˜¯å¯ä»¥çš„ï¼Œ`shouldComponentUpdate()`å¦‚æœè¢«å®šä¹‰ï¼Œå°±ä¼šå¯¹æ–°æ—§ `props`ã€`state` è¿›è¡Œ `shallowEqual` æ¯”è¾ƒï¼Œæ–°æ—§ä¸€æ—¦ä¸ä¸€è‡´ï¼Œä¾¿ä¼šè§¦å‘ `update`ã€‚

ä¹Ÿå¯ä»¥è¿™ä¹ˆç†è§£ï¼š`PureComponent`é€šè¿‡è‡ªå¸¦çš„`props`å’Œ`state`çš„æµ…æ¯”è¾ƒå®ç°äº†`shouldComponentUpdate()`ï¼Œè¿™ç‚¹`Component`å¹¶ä¸å…·å¤‡

`PureComponent`å¯èƒ½ä¼šå› æ·±å±‚çš„æ•°æ®ä¸ä¸€è‡´è€Œäº§ç”Ÿé”™è¯¯çš„å¦å®šåˆ¤æ–­ï¼Œä»è€Œå¯¼è‡´`shouldComponentUpdate`ç»“æœè¿”å› falseï¼Œç•Œé¢å¾—ä¸åˆ°æ›´æ–°ï¼Œè¦è°¨æ…ä½¿ç”¨

### memo

**memo**ï¼šç»“åˆäº†`pureComponentçº¯ç»„ä»¶`å’Œ `componentShouldUpdate`åŠŸèƒ½ï¼Œä¼šå¯¹ä¼ å…¥çš„ props è¿›è¡Œä¸€æ¬¡å¯¹æ¯”ï¼Œç„¶åæ ¹æ®ç¬¬äºŒä¸ªå‡½æ•°è¿”å›å€¼æ¥è¿›ä¸€æ­¥åˆ¤æ–­å“ªäº› props éœ€è¦æ›´æ–°

è¦æ³¨æ„`memo`æ˜¯ä¸€ä¸ª**é«˜é˜¶ç»„ä»¶**ï¼Œ`å‡½æ•°å¼ç»„ä»¶`å’Œ`ç±»ç»„ä»¶`éƒ½å¯ä»¥ä½¿ç”¨ã€‚

`memo`æ¥æ”¶ä¸¤ä¸ªå‚æ•°:

- ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç»„ä»¶æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯è¦ä¼˜åŒ–çš„ç»„ä»¶
- ç¬¬äºŒä¸ªå‚æ•°ï¼š(pre, next) => boolean, `pre`ï¼šä¹‹å‰çš„æ•°æ®ï¼Œ `next`ï¼šç°åœ¨çš„æ•°æ®ï¼Œè¿”å›ä¸€ä¸ª`å¸ƒå°”å€¼`ï¼Œè‹¥ä¸º `true`åˆ™ä¸æ›´æ–°ï¼Œä¸º`false`æ›´æ–°

#### æ€§èƒ½ä¼˜åŒ–

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆçœ‹è¿™æ ·ä¸€ä¸ª ğŸŒ°ï¼š

```js
import React, { Component } from "react";
import { Button } from "antd-mobile";

const Child = () => {
  return (
    <div>
      {console.log("å­ç»„ä»¶æ¸²æŸ“")}
      å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœï½
    </div>
  );
};

class Index extends Component {
  constructor(props) {
    super(props);
    this.state = {
      flag: true,
    };
  }

  render() {
    const { flag } = this.state;
    return (
      <div style={{ padding: 20 }}>
        <Child />
        <Button color="primary" onClick={() => this.setState({ flag: !flag })}>
          çŠ¶æ€åˆ‡æ¢{JSON.stringify(flag)}
        </Button>
      </div>
    );
  }
}

export default Index;
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªå­ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯`Child`å’Œä¸€ä¸ªæŒ‰é’®ï¼ŒæŒ‰é’®çš„æ•ˆæœæ˜¯åˆ‡æ¢ `flag` çš„çŠ¶æ€ï¼Œå¯ä»¥çœ‹å‡º`flag`å’Œ`Child`ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œé‚£ä¹ˆåœ¨åˆ‡æ¢çŠ¶æ€çš„æ—¶å€™ï¼Œ`Child`ä¼šåˆ·æ–°å—ï¼Ÿ

ç›´æ¥çœ‹çœ‹æ•ˆæœï¼š

![img2.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/42bb0a9e2a75477782f80d4b93cc4e50~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥çœ‹å‡ºï¼Œåœ¨æˆ‘ä»¬åˆ‡æ¢çŠ¶æ€çš„æ—¶å€™ï¼Œ`Child`å®é™…ä¸Šä¹Ÿä¼šåˆ·æ–°ï¼Œæˆ‘ä»¬è‚¯å®šä¸å¸Œæœ›ç»„ä»¶åšæ— å…³çš„åˆ·æ–°ï¼Œé‚£ä¹ˆæˆ‘ä»¬åŠ ä¸Š`memo`æ¥çœ‹çœ‹çš„æ•ˆæœï¼š

```jsx
const HOCChild = memo(Child, (pre, next) => {
  return true;
});
```

æ•ˆæœï¼š

![img3.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/429335cd0dd842028c19d65b8d147f46~tplv-k3u1fbpfcp-watermark.image?)
å¯ä»¥çœ‹å‡ºï¼ŒåŠ ä¸Š`memo`åï¼Œ`Child`ä¸ä¼šå†åšæ— å…³çš„æ¸²æŸ“ï¼Œä»è€Œè¾¾åˆ°`æ€§èƒ½ä¼˜åŒ–`çš„ä½œç”¨

#### ç¬¬äºŒä¸ªå‚æ•°çš„ä½œç”¨

æ —å­ ğŸŒ°ï¼š

```jsx
import React, { Component, memo } from "react";
import { Button } from "antd-mobile";

const Child = ({ number }) => {
  return (
    <div>
      {console.log("å­ç»„ä»¶æ¸²æŸ“")}
      å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœï½
      <p>ä¼ é€’çš„æ•°å­—ï¼š{number}</p>
    </div>
  );
};

const HOCChild = memo(Child, (pre, next) => {
  if (pre.number === next.number) return true;
  if (next.number < 7) return false;
  return true;
});

class Index extends Component {
  constructor(props) {
    super(props);
    this.state = {
      flag: true,
      number: 1,
    };
  }

  render() {
    const { flag, number } = this.state;
    return (
      <div style={{ padding: 20 }}>
        <HOCChild number={number} />
        <Button color="primary" onClick={() => this.setState({ flag: !flag })}>
          çŠ¶æ€åˆ‡æ¢{JSON.stringify(flag)}
        </Button>
        <Button
          color="primary"
          style={{ marginLeft: 8 }}
          onClick={() => this.setState({ number: number + 1 })}
        >
          æ•°å­—åŠ ä¸€ï¼š{number}
        </Button>
      </div>
    );
  }
}

export default Index;
```

æ•ˆæœï¼š

![img4.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/414605cc3658444d9a36938275ee7b00~tplv-k3u1fbpfcp-watermark.image?)

å½“æ•°å­—å°äº 7ï¼Œæ‰ä¼šå‡ºå‘`Child`çš„æ›´æ–°ï¼Œé€šè¿‡è¿”å›çš„å¸ƒå°”å€¼æ¥æ§åˆ¶

#### memo çš„æ³¨æ„äº‹é¡¹

`React.memo`ä¸`PureComponent`çš„åŒºåˆ«ï¼š

- æœåŠ¡å¯¹è±¡ä¸åŒï¼š`PureComponent` æœåŠ¡ä¸ç±»ç»„ä»¶ï¼Œ`React.memo`æ—¢å¯ä»¥æœåŠ¡äºç±»ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥æœåŠ¡ä¸å‡½æ•°å¼ç»„ä»¶ï¼Œ`useMemo`æœåŠ¡äºå‡½æ•°å¼ç»„ä»¶ï¼ˆåç»­è®²åˆ°ï¼‰
- é’ˆå¯¹çš„å¯¹è±¡ä¸åŒï¼š`PureComponent`é’ˆå¯¹çš„æ˜¯`props`å’Œ`state`ï¼Œ`React.memo`åªèƒ½é’ˆå¯¹`props`æ¥å†³å®šæ˜¯å¦æ¸²æŸ“

è¿™é‡Œè¿˜æœ‰ä¸ªå°çš„æ³¨æ„ç‚¹ï¼š`memo`çš„ç¬¬äºŒä¸ªå‚æ•°çš„è¿”å›å€¼ä¸`shouldComponentUpdate`çš„è¿”å›å€¼æ˜¯ç›¸åçš„ï¼Œç»å¸¸ä¼šå¼„æ··ï¼Œè¿˜è¦å¤šå¤šæ³¨æ„

- `memo`:è¿”å› Â `true`Â  ç»„ä»¶ä¸æ¸²æŸ“ ï¼Œ è¿”å› Â `false`Â  ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚
- `shouldComponentUpdate`: è¿”å› Â `true`Â  ç»„ä»¶æ¸²æŸ“ ï¼Œ è¿”å› Â `false`Â  ç»„ä»¶ä¸æ¸²æŸ“ã€‚

### forwardRef

`forwardRef`ï¼šå¼•ç”¨ä¼ é€’ï¼Œæ˜¯ä¸€ç§é€šè¿‡ç»„ä»¶å‘å­ç»„ä»¶è‡ªåŠ¨ä¼ é€’å¼•ç”¨`ref`çš„æŠ€æœ¯ã€‚å¯¹äºåº”ç”¨è€…çš„å¤§å¤šæ•°ç»„ä»¶æ¥è¯´æ²¡ä»€ä¹ˆä½œç”¨ï¼Œä½†å¯¹äºä¸€äº›é‡å¤ä½¿ç”¨çš„ç»„ä»¶ï¼Œå¯èƒ½æœ‰ç”¨ã€‚

å¬å®Œä»‹ç»æ˜¯ä¸æ˜¯æ„Ÿè§‰äº‘é‡Œé›¾é‡Œçš„ï¼Œå®˜æ–¹å¯¹`forwardRef`çš„ä»‹ç»ä¹Ÿå¾ˆå°‘ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è½¬å‘çš„é—®é¢˜

åœ¨`React`ä¸­ï¼Œ`React`ä¸å…è®¸`ref`é€šè¿‡`props`ä¼ é€’ï¼Œå› ä¸º`ref`æ˜¯ç»„ä»¶ä¸­å›ºå®šå­˜åœ¨çš„ï¼Œåœ¨ç»„ä»¶è°ƒå’Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šè¢«ç‰¹æ®Šå¤„ç†ï¼Œè€Œ`forwardRef`å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä»¶äº‹è€Œè¯ç”Ÿçš„ï¼Œè®©`ref`å¯ä»¥é€šè¿‡`props`ä¼ é€’

ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼šçˆ¶ç»„ä»¶æƒ³è¦è·å–å­™ç»„ä»¶ä¸Šçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨`ref`ä¼ é€’ä¼šæ€æ ·ï¼š

![ä¼ä¸šå¾®ä¿¡æˆªå›¾_0bc3e73d-e6b4-45a9-bd66-c43cd8bbea11.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1102af2c9a5a4d228fad4c8b645a9995~tplv-k3u1fbpfcp-watermark.image?)

æ¥ä¸‹æ¥çœ‹çœ‹åˆ©ç”¨`forwardRef`æ¥è½¬å‘ä¸‹`ref`ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜äº†ï¼š

```jsx
import React, { Component, forwardRef } from "react";

const Son = ({ sonRef }) => {
  return (
    <div>
      <p>å­™ç»„ä»¶</p>
      <p ref={sonRef}>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœï½</p>
    </div>
  );
};

const Child = ({ childRef }) => {
  return (
    <div>
      <div>å­ç»„ä»¶</div>
      <Son sonRef={childRef} />
    </div>
  );
};

const ForwardChild = forwardRef((props, ref) => (
  <Child childRef={ref} {...props} />
));

class Index extends Component {
  constructor(props) {
    super(props);
  }
  node = null;

  componentDidMount() {
    console.log(this.node);
  }

  render() {
    return (
      <div style={{ padding: 20 }}>
        <div>çˆ¶ç»„ä»¶</div>
        <ForwardChild ref={(node) => (this.node = node)} />
      </div>
    );
  }
}

export default Index;
```

æ•ˆæœï¼š

![ä¼ä¸šå¾®ä¿¡æˆªå›¾_c7a4aa75-362d-4bba-8c83-ded0b4dce01b.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6d986647ea24437a9596f70da0f415cb~tplv-k3u1fbpfcp-watermark.image?)

å¦‚æ­¤ä»¥æ¥å°±è§£å†³äº†ä¸èƒ½åœ¨`react`ç»„ä»¶ä¸­ä¼ é€’`ref`çš„é—®é¢˜ï¼Œè‡³äºå¤ç”¨çš„ç»„ä»¶å¯èƒ½ä¼šç”¨åˆ°ï¼Œç›®å‰ä¹Ÿæ²¡æ€è·¯ç”¨`forwardRef`å¹²å˜›ï¼Œå°±å½“ç†Ÿæ‚‰å§ï½

### Fragment

åœ¨`React`ä¸­ï¼Œç»„ä»¶æ˜¯ä¸å…è®¸è¿”å›å¤šä¸ªèŠ‚ç‚¹çš„ï¼Œå¦‚ï¼š

```js
    return <p>æˆ‘æ˜¯å°æœæœ</p>
           <p>React</p>
           <p>Vue</p>
```

æˆ‘ä»¬æƒ³è¦è§£å†³è¿™ç§æƒ…å†µéœ€è¦ç»™ä¸ºæ­¤å¥—ä¸€ä¸ªå®¹å™¨å…ƒç´ ï¼Œå¦‚`<div></div>`

```js
return (
  <div>
    <p>æˆ‘æ˜¯å°æœæœ</p>
    <p>React</p>
    <p>Vue</p>
  </div>
);
```

ä½†è¿™æ ·åšï¼Œæ— ç–‘ä¼šå¤šå¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥åœ¨`16.0`åï¼Œå®˜æ–¹æ¨å‡ºäº†`Fragment`ç¢ç‰‡æ¦‚å¿µï¼Œèƒ½å¤Ÿè®©ä¸€ä¸ªç»„ä»¶è¿”å›å¤šä¸ªå…ƒç´ ,**React.Fragment ç­‰ä»·äº`<></>`**

```js
return (
  <React.Fragment>
    <p>æˆ‘æ˜¯å°æœæœ</p>
    <p>React</p>
    <p>Vue</p>
  </React.Fragment>
);
```

å¯ä»¥çœ‹åˆ°`React.Fragment`å®é™…ä¸Šæ˜¯æ²¡æœ‰èŠ‚ç‚¹çš„ Â 
![ä¼ä¸šå¾®ä¿¡æˆªå›¾_34d1a03b-acdd-4ed0-9392-86fb764731c7.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a99ffdf9c8c849c0b1d112e8e59d14dd~tplv-k3u1fbpfcp-zoom-1.image)

å¦å¤–ï¼Œ`react`ä¸­æ”¯æŒæ•°ç»„çš„è¿”å›ï¼Œåƒè¿™æ ·ï¼š

```js
return [<p key="1">æˆ‘æ˜¯å°æœæœ</p>, <p key="2">React</p>, <p key="3">Vue</p>];
```

è¿˜æœ‰æˆ‘ä»¬åœ¨è¿›è¡Œæ•°ç»„éå†çš„æ—¶å€™ï¼Œ`React`éƒ½ä¼šåœ¨åº•å±‚å¤„ç†ï¼Œåœ¨å¤–éƒ¨åµŒå¥—ä¸€ä¸ª`<React.Fragment />`

#### Fragment ä¸` <></>`çš„ä¸åŒ

æˆ‘ä»¬éƒ½çŸ¥é“`<></>`æ˜¯`<Fragment></Fragment>`çš„ç®€å†™ï¼Œä»åŸåˆ™ä¸Šæ¥è¯´æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆä½ çŸ¥é“ä»–ä»¬åˆä»€ä¹ˆä¸åŒå—ï¼Ÿ

å®é™…ä¸Šï¼Œ`Fragment` è¿™ä¸ªç»„ä»¶å¯ä»¥èµ‹å€¼ `key`ï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•ï¼Œ`<></>`ä¸èƒ½èµ‹å€¼ï¼Œåº”ç”¨åœ¨éå†æ•°ç»„ä¸Šï¼Œæœ‰æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è¯•ä¸€è¯•ï½

### lazy

**lazy**ï¼šå…è®¸ä½ å®šä¹‰ä¸€ä¸ªåŠ¨æ€åŠ è½½ç»„ä»¶ï¼Œè¿™æ ·æœ‰åŠ©äºç¼©å‡ bundle çš„ä½“ç§¯ï¼Œå¹¶å»¶è¿ŸåŠ è½½åœ¨åˆæ¬¡æ¸²æŸ“æ—¶æœªç”¨åˆ°çš„ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯æ‡’åŠ è½½ç»„ä»¶ï¼ˆé«˜é˜¶ç»„ä»¶ï¼‰

`lazy`æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°éœ€è¦åŠ¨æ€è°ƒç”¨`import()`,å¦‚ï¼š

```js
const LazyChild = lazy(() => import("./child"));
```

é‚£ä¹ˆ`import('./child')`æ˜¯ä¸€ä¸ªæ€æ ·çš„ç±»å‹å‘¢ï¼Ÿ

å®é™…ä¸Š`lazy`å¿…é¡»æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”éœ€è¦è¿”å›ä¸€ä¸ª`Promise`, å¹¶ä¸”éœ€è¦`resolve`ä¸€ä¸ª`default`ä¸€ä¸ª`React`ç»„ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œ`lazy`å¿…é¡»è¦é…åˆ`Suspense`ä¸€èµ·ä½¿ç”¨

ä¸¾ä¸ªä¾‹å­ ğŸŒ°ï¼šæˆ‘åŠ å…¥äº†`setTimeout`æ–¹ä¾¿çœ‹åˆ°æ›´å¥½çš„æ•ˆæœï¼š

```js
import React, { Component, Suspense, lazy } from "react";
import Child from "./child";
import { Button, DotLoading } from "antd-mobile";

const LazyChild = lazy(
  () =>
    new Promise((res) => {
      setTimeout(() => {
        res({
          default: () => <Child />,
        });
      }, 1000);
    })
);

class Index extends Component {
  constructor(props) {
    super(props);
    this.state = {
      show: false,
    };
  }

  render() {
    const { show } = this.state;
    return (
      <div style={{ padding: 20 }}>
        <Button color="primary" onClick={() => this.setState({ show: true })}>
          æ¸²æŸ“
        </Button>
        {show && (
          <Suspense
            fallback={
              <div>
                <DotLoading color="primary" />
                åŠ è½½ä¸­
              </div>
            }
          >
            <LazyChild />
          </Suspense>
        )}
      </div>
    );
  }
}

export default Index;
```

Child æ–‡ä»¶ï¼š

```js
import React, { useEffect } from "react";
import img from "./img.jpeg";

const Index = () => {
  useEffect(() => {
    console.log("ç…§ç‰‡æ¸²æŸ“");
  }, []);

  return (
    <div>
      <img src={img} width={200} height={160} />
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š

![img5.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4c0e47787a5e4e02ba5472625d20ce86~tplv-k3u1fbpfcp-watermark.image?)

### Suspense

**Suspense**ï¼šè®©ç»„ä»¶"ç­‰å¾…"æŸä¸ªå¼‚æ­¥ç»„ä»¶æ“ä½œï¼Œç›´åˆ°è¯¥å¼‚æ­¥æ“ä½œç»“æŸå³å¯æ¸²æŸ“ã€‚

ä¸ä¸Šé¢`lazy`ä¸­çš„æ¡ˆä¾‹ä¸€æ ·ï¼Œä¸¤è€…éœ€è¦é…åˆä½¿ç”¨ï¼Œå…¶ä¸­`fallback`ä¸ºç­‰å¾…æ—¶æ¸²æŸ“çš„æ ·å¼

`Suspense`å’Œ`lazy`å¯ä»¥ç”¨äºç­‰å¾…ç…§ç‰‡ã€è„šæœ¬å’Œä¸€äº›å¼‚æ­¥çš„æƒ…å†µã€‚

### Profiler

**Profiler**ï¼šè¿™ä¸ªç»„ä»¶ç”¨äºæ€§èƒ½æ£€æµ‹ï¼Œå¯ä»¥æ£€æµ‹ä¸€æ¬¡`react`ç»„ä»¶æ¸²æŸ“æ—¶çš„æ€§èƒ½å¼€é”€

æ­¤ç»„ä»¶æœ‰ä¸¤ä¸ªå‚æ•°ï¼š

- `id`ï¼šæ ‡è¯†`Profiler`çš„å”¯ä¸€æ€§
- `onRender`ï¼šå›è°ƒå‡½æ•°ï¼Œç”¨äºæ¸²æŸ“å®Œæˆï¼Œå‚æ•°åœ¨ä¸‹é¢è®²è§£

ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š

```jsx
import React, { Component, Profiler } from "react";

export default Index;
```

è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ‰“å°çš„æ˜¯ä»€ä¹ˆï¼š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8bd6129306444e6281987f9ee05c7668~tplv-k3u1fbpfcp-watermark.image?)

ä¾æ­¤çš„å«ä¹‰ï¼š

- **id**ï¼š`Profiler`æ ‘çš„`id`
- **phase**ï¼š`mount`æŒ‚è½½ï¼Œ`update`æ¸²æŸ“
- **actualDuration**ï¼šæ›´æ–° Â `committed`Â  èŠ±è´¹çš„æ¸²æŸ“æ—¶é—´
- **baseDuration**ï¼šæ¸²æŸ“æ•´é¢—å­æ ‘éœ€è¦çš„æ—¶é—´
- **startTime**ï¼šæ›´æ–°å¼€å§‹æ¸²æŸ“çš„æ—¶é—´
- **commitTime**ï¼šæ›´æ–° `committed` çš„æ—¶é—´
- **interactions**ï¼šæœ¬æ¬¡æ›´æ–°çš„ Â `interactions`Â  çš„é›†åˆ

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªç»„ä»¶åº”è¯¥åœ¨éœ€è¦çš„æ—¶å€™å»ä½¿ç”¨ï¼Œè™½ç„¶`Profiler`æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥è´Ÿæ‹…

### StrictMode

**StrictMode**ï¼šä¸¥æ ¼æ¨¡å¼ï¼Œæ˜¯ä¸€ç§ç”¨äºçªå‡ºæ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸­æ½œåœ¨é—®é¢˜çš„å·¥å…·

ä¸`Fragment`ä¸€æ ·ï¼Œ`StrictMode`ä¹Ÿä¸ä¼šå‡ºç°åœ¨`UI`å±‚é¢ï¼Œåªæ˜¯ä¼šæ£€æŸ¥å’Œè­¦å‘Š

å¯ä»¥çœ‹ä¸€ä¸‹å®˜æ–¹çš„ç¤ºä¾‹ï¼š

```js
import React from "react";

function ExampleApplication() {
  return (
    <div>
      <Header />
      <React.StrictMode>
        {" "}
        <div>
          <ComponentOne />
          <ComponentTwo />
        </div>
      </React.StrictMode> <Footer />
    </div>
  );
}
```

ä¸Šè¿°ä»£ç ä¸­åªä¼šå¯¹`ComponentOne`å’Œ`ComponentTwo`è¿›è¡Œæ£€æŸ¥

ä¸»è¦æœ‰ä»¥ä¸‹å¸®åŠ©ï¼š

- [è¯†åˆ«å…·æœ‰ä¸å®‰å…¨ç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶](https://reactjs.org/docs/strict-mode.html#identifying-unsafe-lifecycles)
- [å…³äºæ—§ç‰ˆå­—ç¬¦ä¸²å¼•ç”¨ API ä½¿ç”¨çš„è­¦å‘Š](https://reactjs.org/docs/strict-mode.html#warning-about-legacy-string-ref-api-usage)
- [å…³äºä¸æ¨èä½¿ç”¨ findDOMNode çš„è­¦å‘Š](https://reactjs.org/docs/strict-mode.html#warning-about-deprecated-finddomnode-usage)
- [æ£€æµ‹æ„å¤–çš„å‰¯ä½œç”¨](https://reactjs.org/docs/strict-mode.html#detecting-unexpected-side-effects)
- [æ£€æµ‹é—ç•™ä¸Šä¸‹æ–‡ API](https://reactjs.org/docs/strict-mode.html#detecting-legacy-context-api)
- [ç¡®ä¿å¯é‡ç”¨çŠ¶æ€](https://reactjs.org/docs/strict-mode.html#ensuring-reusable-state)

## å·¥å…·ç±»

### crateElement

åœ¨ä¹‹å‰è®²çš„[è™šæ‹Ÿ DOM](https://juejin.cn/post/7116326409961734152)çš„æ—¶å€™å·²ç»è¯¦ç»†çš„è®²è§£è¿‡ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåœ¨åœ¨å¤ä¹ ä¸€é

`JSX`ä¼šè¢«ç¼–è¯‘ä¸º`React.createElement`çš„å½¢å¼ï¼Œç„¶åè¢«`babel`ç¼–è¯‘

ç»“æ„ï¼š

`React.createElement(element, [props], [...children])`å…±æœ‰ä¸‰ä¸ªå‚æ•°ï¼š

- `element`ï¼šåŸç”Ÿç»„ä»¶çš„è¯æ˜¯æ ‡ç­¾çš„å­—ç¬¦ä¸²ï¼Œå¦‚`â€œdivâ€`ï¼Œå¦‚æœæ˜¯`React`è‡ªå®šä¹‰ç»„ä»¶ï¼Œåˆ™ä¼šä¼ å…¥ç»„ä»¶
- `[props]`ï¼šå¯¹è±¡ï¼Œ`dom`ç±»ä¸­çš„`å±æ€§`ï¼Œ`ç»„ä»¶`ä¸­çš„`props`
- `[...children]`ï¼šå…¶ä»–çš„å‚æ•°ï¼Œä¼šä¾æ­¤æ’åº

ä¸¾ä¸ªä¾‹å­ ğŸŒ°ï¼š
ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š

```jsx
class Info extends React.Component {
  render() {
    return (
      <div>
        Hiï¼æˆ‘æ˜¯å°æœæœ
        <p>æ¬¢è¿</p>
        <Children>æˆ‘æ˜¯å­ç»„ä»¶</Children>
      </div>
    );
  }
}
```

ä¸Šè¿°ä»£ç ä¼šè¢«ç¿»è¯‘ä¸ºï¼š

```jsx
    class Info extends React.Component {
        render(){
            return React.createElement(
                'div',
                null,
                "Hiï¼æˆ‘æ˜¯å°æœæœ",
                React.createElement('p', null, 'æ¬¢è¿')ï¼Œ // åŸç”Ÿæ ‡ç­¾
                React.createElement(
                    Children, //è‡ªå®šä¹‰ç»„ä»¶
                    null, // å±æ€§
                    'æˆ‘æ˜¯å­ç»„ä»¶'  //childæ–‡æœ¬å†…å®¹
                )
            )
        }
    }
```

#### æ³¨æ„ç‚¹

- `JSX`çš„ç»“æ„å®é™…ä¸Šå’Œ`React.createElement`å†™æ³•ä¸€è‡´ï¼Œåªæ˜¯ç”¨`JSX`æ›´åŠ ç®€å•ã€æ–¹ä¾¿
- ç»è¿‡`React.createElement`çš„åŒ…è£¹ï¼Œæœ€ç»ˆä¼šå½¢æˆ Â `$$typeof = Symbol(react.element)`å¯¹è±¡ï¼Œå¯¹è±¡ä¿å­˜äº†`react.element`çš„ä¿¡æ¯ã€‚

### cloneElement

`cloneElement`ï¼šå…‹éš†å¹¶è¿”å›ä¸€ä¸ªæ–°çš„`React`å…ƒç´ ,

ç»“æ„ï¼š
`React.createElement(type, [props], [...children])`

`React.cloneElement()`å‡ ä¹ç­‰åŒäº:

```js
<element.type {...element.props} {...props}>
  {children}
</element.type>
```

ä¸¾ä¸ªä¾‹å­ ğŸŒ°ï¼š

```jsx
import React from "react";

const Child = () => {
  const children = React.cloneElement(<div>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</div>, {
    name: "å°æœæœ",
  });
  console.log(children);
  return <div>{children}</div>;
};

const Index = () => {
  return (
    <div style={{ padding: 20 }}>
      <Child />
    </div>
  );
};

export default Index;
```

æ‰“å°ä¸‹`children`æ¥çœ‹çœ‹ï¼š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1eac481267424eba9a0115b5b2d6522c~tplv-k3u1fbpfcp-watermark.image?)

å…¶å®æ˜¯å¯ä»¥çœ‹åˆ°ä¼ é€’çš„`name`çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡`React.cloneElement`æ–¹æ³•å»å¯¹ç»„ä»¶è¿›è¡Œä¸€äº›èµ‹èƒ½

### createContext

**createContext**ï¼šç›¸ä¿¡å¤§å®¶å¯¹è¿™ä¸ª Api å¾ˆç†Ÿæ‚‰ï¼Œç”¨äºä¼ é€’ä¸Šä¸‹æ–‡ã€‚`createContext`ä¼šåˆ›å»ºä¸€ä¸ª`Context`å¯¹è±¡ï¼Œç”¨`Provider`çš„`value`æ¥ä¼ é€’å€¼ï¼Œç”¨`Consumer`æ¥å—`value`

æˆ‘ä»¬å®ç°ä¸€ä¸ªçˆ¶ä¼ å­™çš„å°æ —å­ ğŸŒ°ï¼š

```jsx
import React, { useState } from "react";

const Content = React.createContext();

const Child = () => {
  return <Content.Consumer>{(value) => <Son {...value} />}</Content.Consumer>;
};

const Son = (props) => {
  return (
    <>
      <div>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯{props.name}</div>
      <div>å¹¸è¿æ•°å­—æ˜¯ï¼š{props.number}</div>
    </>
  );
};

const Index = () => {
  const [data, _] = useState({
    name: "å°æœæœ",
    number: 7,
  });

  return (
    <div style={{ padding: 20 }}>
      <Content.Provider value={data}>
        <Child />
      </Content.Provider>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1572ec2259fb4e49af43e9021ebf852d~tplv-k3u1fbpfcp-watermark.image?)

æ³¨æ„ï¼šå¦‚æœ`Consumer`ä¸Šä¸€çº§ä¸€ç›´æ²¡æœ‰`Provider`,åˆ™ä¼šåº”ç”¨`defaultValue`ä½œä¸º`value`ã€‚

åªæœ‰å½“ç»„ä»¶æ‰€å¤„çš„æ ‘ä¸­æ²¡æœ‰åŒ¹é…åˆ° Â `Provider`Â  æ—¶ï¼Œå…¶ Â `defaultValue`Â  å‚æ•°æ‰ä¼šç”Ÿæ•ˆã€‚

### Children

**Children**: æä¾›å¤„ç†`this.props.children`ä¸é€æ˜æ•°æ®ç»“æ„çš„å®ç”¨ç¨‹åº.

é‚£ä¹ˆä»€ä¹ˆæ˜¯`ä¸é€æ˜`çš„æ•°æ®å‘¢ï¼Ÿ

å…ˆæ¥çœ‹çœ‹ä¸‹é¢çš„æ —å­ ğŸŒ°ï¼š

```jsx
import React, { useEffect } from "react";

const Child = ({ children }) => {
  console.log(children);
  return children;
};

const Index = () => {
  return (
    <div style={{ padding: 20 }}>
      <Child>
        <p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</p>
        <p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</p>
        <p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</p>
        <p>Helloï½</p>
      </Child>
    </div>
  );
};

export default Index;
```

æ‰“å°ä¸‹`children`çœ‹åˆ°ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef75bab50b1a47e2b4cd5a1b75387eb3~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªèŠ‚ç‚¹éƒ½æ‰“å°å‡ºæ¥äº†ï¼Œè¿™ç§æƒ…å†µå±äº`é€æ˜çš„`ï¼Œä½†æˆ‘ä»¬è¦æ˜¯ä¾¿åˆ©çœ‹çœ‹ï¼š

```jsx
<Child>
  {[1, 2, 3].map((item) => (
    <p key={item}>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</p>
  ))}
  <p>Helloï½</p>
</Child>
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd56173a0c05431e8295c363b2e69d5a~tplv-k3u1fbpfcp-watermark.image?)

å´å‘ç°æˆ‘ä»¬ä¾¿åˆ©çš„ä¸‰ä¸ªå…ƒç´ è¢«åŒ…äº†ä¸€å±‚ï¼Œåƒè¿™ç§æ•°æ®è¢«ç§°ä¸º`ä¸é€æ˜`ï¼Œæˆ‘ä»¬æƒ³è¦å¤„ç†è¿™ç§æ•°æ®ï¼Œå°±è¦ä»¥æ¥`React.Chilren` æ¥è§£å†³

#### Children.map

`Children.map`ï¼šéå†ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œé’ˆå¯¹ä¸Šé¢çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•å°†æ•°æ®ä¾¿ä¼šåŸå…ˆçš„

```js
const Child = ({ children }) => {
  const res = React.Children.map(children, (item) => item);
  console.log(res);
  return res;
};
```

æ•ˆæœï¼š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/887f747c02d94a2e939cda97bb54489e~tplv-k3u1fbpfcp-watermark.image?)

#### Children.forEach

`Children.forEach`ï¼šä¸`Children.map`ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯`Children.forEach`å¹¶ä¸ä¼šè¿”å›å€¼ï¼Œè€Œæ˜¯åœç•™åœ¨éå†é˜¶æ®µ

```js
const Child = ({ children }) => {
  React.Children.forEach(children, (item) => console.log(item));
  return children;
};
```

æ•ˆæœï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd7219448191481d8c9c22c0b0008248~tplv-k3u1fbpfcp-watermark.image?)

#### Children.count

**Children.count**ï¼šè¿”å› Child å†…çš„æ€»ä¸ªæ•°ï¼Œç­‰äºå›è°ƒä¼ é€’ç»™`map`æˆ–`forEach`å°†è¢«è°ƒç”¨çš„æ¬¡æ•°ã€‚å¦‚ï¼š

```js
const Child = ({ children }) => {
  const res = React.Children.count(children);
  console.log(res); // 4
  return children;
};
```

#### Children.only

**Children.only**ï¼šéªŒè¯`Child`æ˜¯å¦åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ­£å¸¸è¿”å›ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚ğŸ¤·â€â™‚ ä¸çŸ¥é“è¿™ä¸ªæœ‰å•¥ç”¨ï½

```jsx
const Child = ({ children }) => {
  console.log(React.Children.only(children));
  return children;
};
```

æ•ˆæœï¼š
åªæœ‰ä¸€ä¸ªæ—¶ï¼š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f88f77f54f204b038d8ba7d57258d13f~tplv-k3u1fbpfcp-watermark.image?)

å¤šä¸ªæ—¶ï¼š
![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2af6da9b7dfc4dcc98d44f5b042feb5d~tplv-k3u1fbpfcp-watermark.image?)

#### Children.toArray

**Children.toArray**ï¼šä»¥å¹³é¢æ•°ç»„çš„å½¢å¼è¿”å›`children`ä¸é€æ˜æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªå­å…ƒç´ éƒ½åˆ†é…æœ‰é”®ã€‚

å¦‚æœä½ æƒ³åœ¨ä½ çš„æ¸²æŸ“æ–¹æ³•ä¸­æ“ä½œå­å…ƒç´ çš„é›†åˆï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ æƒ³`this.props.children`åœ¨ä¼ é€’å®ƒä¹‹å‰é‡æ–°æ’åºæˆ–åˆ‡ç‰‡ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚

æˆ‘ä»¬åœ¨åŸå…ˆçš„ä¾‹å­ä¸Šåœ¨åŠ ä¸€æ¬¡æ¥çœ‹çœ‹ï¼š

```jsx
import React from "react";

const Child = ({ children }) => {
  console.log(`åŸæ¥æ•°æ®:`, children);
  const res = React.Children.toArray(children);
  console.log(`æ‰å¹³åçš„æ•°æ®:`, res);
  return res;
};

const Index = () => {
  return (
    <div style={{ padding: 20 }}>
      <Child>
        {[1, 2, 3].map((item) =>
          [5, 6].map((ele) => <p key={`${item}-${ele}`}>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</p>)
        )}
        <p>Helloï½</p>
      </Child>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/916ea01d44af45f0b1aee498918b040b~tplv-k3u1fbpfcp-watermark.image?)

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯`key`,ç»è¿‡`Children.toArray`å¤„ç†åï¼Œä¼šç»™åŸæœ¬çš„`key`æ·»åŠ å‰ç¼€ï¼Œä»¥ä½¿å¾—æ¯ä¸ªå…ƒç´  Â `key`Â  çš„èŒƒå›´éƒ½é™å®šåœ¨æ­¤å‡½æ•°å…¥å‚æ•°ç»„çš„å¯¹è±¡å†…ã€‚

### createRef

**createRef**ï¼šåˆ›å»ºä¸€ä¸ª`ref`å¯¹è±¡ï¼Œè·å–èŠ‚ç‚¹ä¿¡æ¯ï¼Œç›´æ¥ä¸¾ä¸ªä¾‹å­ï¼š

```js
import React, { Component } from "react";

class Index extends Component {
  constructor(props) {
    super(props);
  }

  node = React.createRef();

  componentDidMount() {
    console.log(this.node);
  }
  render() {
    return <div ref={this.node}> èŠ‚ç‚¹ä¿¡æ¯ </div>;
  }
}

export default Index;
```

æ•ˆæœï¼š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f3d2ea557dfc4f41ababbc2bf855e797~tplv-k3u1fbpfcp-watermark.image?)

è¿™ä¸ªæœ‰ç‚¹é¸¡è‚‹ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»`ref`ä¸Šè·å–åˆ°å€¼ï¼Œæ²¡æœ‰å¿…è¦é€šè¿‡`createRef`å»è·å–ï¼Œåƒè¿™æ ·

    import React, { Component } from 'react';
    
    class Index extends Component{
      constructor(props){
          super(props)
      }
    
      node = null
    
      componentDidMount(){
        console.log(this.node)
      }
      render(){
        return <div ref={(node) => this.node = node} > èŠ‚ç‚¹ä¿¡æ¯ </div>
      }
    }
    
    export default Index;

### createFactory

**createFactory**ï¼šè¿”å›ä¸€ä¸ªç”Ÿæˆç»™å®šç±»å‹çš„ React å…ƒç´ çš„å‡½æ•°ã€‚

æ¥å—ä¸€ä¸ªå‚æ•°`type`ï¼Œè¿™ä¸ª`type`ä¸`createElement`çš„`type`ä¸€æ ·ï¼ŒåŸç”Ÿç»„ä»¶çš„è¯æ˜¯æ ‡ç­¾çš„å­—ç¬¦ä¸²ï¼Œå¦‚`â€œdivâ€`ï¼Œå¦‚æœæ˜¯`React`è‡ªå®šä¹‰ç»„ä»¶ï¼Œåˆ™ä¼šä¼ å…¥ç»„ä»¶

æ•ˆæœä¸`createElement`ä¸€æ ·ï¼Œä½†è¿™ä¸ªè¯´æ˜¯é—ç•™çš„ï¼Œå®˜æ–¹å»ºè®®ç›´æ¥ä½¿ç”¨`createElement`ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ä¸Šä¹Ÿä¼šç»™å‡ºè­¦å‘Š

æ —å­ ğŸŒ°ï¼š

```jsx
import React, { useEffect } from "react";

const Child = React.createFactory(() => <div>createFactory</div>);

const Index = () => {
  return (
    <div style={{ padding: 20 }}>
      å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ
      <Child />
    </div>
  );
};

export default Index;
```

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da152abddee94cfba0d3755e8ea4fa75~tplv-k3u1fbpfcp-watermark.image?)

### isValidElement

**isValidElement**ï¼šç”¨äºéªŒè¯æ˜¯å¦æ˜¯ React å…ƒç´ ï¼Œæ˜¯çš„è¯å°±è¿”å›`true`ï¼Œå¦åˆ™è¿”å›`false`ï¼Œæ„Ÿè§‰è¿™ä¸ª`Api`ä¹Ÿä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬è‚¯å®šçŸ¥é“æ˜¯å¦æ˜¯

æ —å­ ğŸŒ°ï¼š

```jsx
console.log(React.isValidElement(<div>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</div>)); // true
console.log(React.isValidElement("å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ")); //false
```

### version

æŸ¥çœ‹ React çš„ç‰ˆæœ¬å·ï¼šå¦‚ï¼š

```js
console.log(React.version);
```

ç‰ˆæœ¬ï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8f31bf4a9a624b31b247a96df1ca0193~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹åœ¨`React`ä¸­çš„æ–‡ä»¶ä½ç½®ï¼Œåœ¨`react`ä¸­æœ‰ä¸€ä¸ªå•ç‹¬å¤„ç†ç‰ˆæœ¬ä¿¡æ¯çš„ä½ç½®ï¼š

`packages/shared/ReactVersion.js`

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4ab9a692c09948e4a423310164a91932~tplv-k3u1fbpfcp-watermark.image?)

## ç”Ÿå‘½å‘¨æœŸ

`React` çš„ ç”Ÿå‘½å‘¨æœŸä¸»è¦æœ‰ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„ç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯`v16.0å‰`å’Œ`v16.4`ä¸¤ä¸ªç‰ˆæœ¬çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬åˆ†åˆ«è¯´ä¸‹æ—§çš„å’Œæ–°çš„ç”Ÿå‘½å‘¨æœŸï¼Œåšä¸‹å¯¹æ¯”ï½

### v16.0 å‰

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/99f1eddd84e94273a098640d0d148a21~tplv-k3u1fbpfcp-watermark.image?)

ä»å›¾ä¸­ï¼Œæ€»å…±åˆ†ä¸ºå››å¤§é˜¶æ®µï¼š`Intialization(åˆå§‹åŒ–)`ã€`Mounting(æŒ‚è½½)`ã€`Update(æ›´æ–°)`ã€`Unmounting(å¸è½½)`

#### Intialization(åˆå§‹åŒ–ï¼‰

åœ¨åˆå§‹åŒ–é˜¶æ®µ,æˆ‘ä»¬ä¼šç”¨åˆ° `constructor()` è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œå¦‚ï¼š

```js
constructor(props) {
  super(props);
}
```

- `superçš„ä½œç”¨`â€œ ç”¨æ¥è°ƒç”¨åŸºç±»çš„æ„é€ æ–¹æ³•( constructor() ), ä¹Ÿå°†çˆ¶ç»„ä»¶çš„ props æ³¨å…¥ç»™å­ç»„ä»¶ï¼Œä¾›å­ç»„ä»¶è¯»å– (ç»„ä»¶ä¸­` propsåªè¯»ä¸å¯å˜``ï¼Œstateå¯å˜ `)
- åˆå§‹åŒ–æ“ä½œï¼Œå®šä¹‰ this.state çš„åˆå§‹å†…å®¹
- åªä¼šæ‰§è¡Œä¸€æ¬¡

#### Mounting(æŒ‚è½½ï¼‰

**componentWillMount**ï¼šåœ¨ç»„ä»¶æŒ‚è½½åˆ° DOM å‰è°ƒç”¨

- è¿™é‡Œé¢çš„è°ƒç”¨çš„`this.setState`ä¸ä¼šå¼•èµ·ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œä¹Ÿå¯ä»¥æŠŠå†™åœ¨è¿™è¾¹çš„å†…å®¹æåˆ°`constructor()`ï¼Œæ‰€ä»¥åœ¨é¡¹ç›®ä¸­å¾ˆå°‘ã€‚
- åªä¼šè°ƒç”¨ä¸€æ¬¡

**render**: æ¸²æŸ“

- åªè¦`props`å’Œ`state`å‘ç”Ÿ`æ”¹å˜`ï¼ˆæ— ä¸¤è€…çš„é‡ä¼ é€’å’Œé‡èµ‹å€¼ï¼Œè®ºå€¼æ˜¯å¦æœ‰å˜åŒ–ï¼Œéƒ½å¯ä»¥å¼•èµ·ç»„ä»¶é‡æ–° renderï¼‰ï¼Œéƒ½ä¼šé‡æ–°æ¸²æŸ“ renderã€‚
- `return`ï¼šæ˜¯å¿…é¡»çš„ï¼Œæ˜¯ä¸€ä¸ª React å…ƒç´ ï¼ˆUIï¼Œæè¿°ç»„ä»¶ï¼‰ï¼Œä¸è´Ÿè´£ç»„ä»¶å®é™…æ¸²æŸ“å·¥ä½œï¼Œç”± React è‡ªèº«æ ¹æ®æ­¤å…ƒç´ å»æ¸²æŸ“å‡º DOMã€‚
- `render`æ˜¯**çº¯å‡½æ•°**ï¼ˆPure functionï¼šè¿”å›çš„ç»“æœåªä¾èµ–ä¸å‚æ•°ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­æ²¡æœ‰å‰¯ä½œç”¨ï¼‰ï¼Œä¸èƒ½æ‰§è¡Œ this.setStateã€‚

**componentDidMount**ï¼šç»„ä»¶æŒ‚è½½åˆ° DOM åè°ƒç”¨

- è°ƒç”¨ä¸€æ¬¡

#### Update(æ›´æ–°)

**componentWillReceiveProps(nextProps)**:è°ƒç”¨äº props å¼•èµ·çš„ç»„ä»¶æ›´æ–°è¿‡ç¨‹ä¸­

- `nextProps`ï¼šçˆ¶ç»„ä»¶ä¼ ç»™å½“å‰ç»„ä»¶æ–°çš„ props
- å¯ä»¥ç”¨`nextProps`å’Œ`this.props`æ¥æŸ¥æ˜é‡ä¼  props æ˜¯å¦å‘ç”Ÿæ”¹å˜ï¼ˆåŸå› ï¼šä¸èƒ½ä¿è¯çˆ¶ç»„ä»¶é‡ä¼ çš„ props æœ‰å˜åŒ–ï¼‰
- åªè¦ props å‘ç”Ÿå˜åŒ–å°±ä¼šï¼Œå¼•èµ·è°ƒç”¨

**shouldComponentUpdate(nextProps, nextState)**ï¼šæ€§èƒ½ä¼˜åŒ–ç»„ä»¶

- **nextProps**ï¼šå½“å‰ç»„ä»¶çš„ this.props
- **nextState**ï¼šå½“å‰ç»„ä»¶çš„ this.state
- é€šè¿‡æ¯”è¾ƒ`nextProps`å’Œ`nextState`,æ¥åˆ¤æ–­å½“å‰ç»„ä»¶æ˜¯å¦æœ‰å¿…è¦ç»§ç»­æ‰§è¡Œæ›´æ–°è¿‡ç¨‹ã€‚

  è¿”å› falseï¼šè¡¨ç¤ºåœæ­¢æ›´æ–°ï¼Œç”¨äºå‡å°‘ç»„ä»¶çš„ä¸å¿…è¦æ¸²æŸ“ï¼Œä¼˜åŒ–æ€§èƒ½

  è¿”å› trueï¼šç»§ç»­æ‰§è¡Œæ›´æ–°

- åƒ`componentWillReceivePropsï¼ˆï¼‰`ä¸­æ‰§è¡Œäº† this.setStateï¼Œæ›´æ–°äº† stateï¼Œä½†åœ¨`render`å‰(å¦‚ shouldComponentUpdateï¼ŒcomponentWillUpdate)ï¼Œthis.state ä¾ç„¶æŒ‡å‘æ›´æ–°å‰çš„ stateï¼Œä¸ç„¶ nextState åŠå½“å‰ç»„ä»¶çš„ this.state çš„å¯¹æ¯”å°±ä¸€ç›´æ˜¯ true äº†

**componentWillUpdate(nextProps, nextState)**ï¼šç»„ä»¶æ›´æ–°å‰è°ƒç”¨

- åœ¨ render æ–¹æ³•å‰æ‰§è¡Œ
- ç”±äºç»„ä»¶æ›´æ–°å°±ä¼šè°ƒç”¨ï¼Œæ‰€ä»¥ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨
- renderï¼šé‡æ–°æ¸²æŸ“

**componentDidUpdate(prevProps, prevState)**ï¼šç»„ä»¶æ›´æ–°åè¢«è°ƒç”¨

- prevPropsï¼šç»„ä»¶æ›´æ–°å‰çš„ props
- prevStateï¼šç»„ä»¶æ›´æ–°å‰çš„ state
- å¯ä»¥æ“ä½œç»„ä»¶æ›´æ–°çš„ DOM

#### Unmounting(å¸è½½)

**componentWillUnmount**ï¼šç»„ä»¶è¢«å¸è½½å‰è°ƒç”¨

- å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚æ¸…æ¥šç»„ä»¶ä¸­ä½¿ç”¨çš„å®šæ—¶å™¨ï¼Œæ¸…æ¥š componentDidMount ä¸­æ‰‹åŠ¨åˆ›å»ºçš„ DOM å…ƒç´ ç­‰ï¼Œä»¥é¿å…å¼•èµ·å†…å­˜æ³„æ¼

### React v16.4

![12b.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93f9eb88f8824ba2ab44897471225596~tplv-k3u1fbpfcp-watermark.image?)

ä¸ v16.0 çš„ç”Ÿå‘½å‘¨æœŸç›¸æ¯”

æ–°å¢äº† **getDerivedStateFromProps** å’Œ**getSnapshotBeforeUpdate**

å–æ¶ˆäº† **componentWillMount**ã€**componentWillReceiveProps**ã€**componentWillUpdate**

#### getDerivedStateFromProps

**getDerivedStateFromProps(prevProps, prevState)**ï¼šç»„ä»¶åˆ›å»ºå’Œæ›´æ–°æ—¶è°ƒç”¨çš„æ–¹æ³•

- `prevProps`ï¼šç»„ä»¶æ›´æ–°å‰çš„ props
- `prevState`ï¼šç»„ä»¶æ›´æ–°å‰çš„ state

æ³¨æ„ï¼šåœ¨ React v16.3 ä¸­ï¼Œåœ¨åˆ›å»ºå’Œæ›´æ–°æ—¶ï¼Œåªèƒ½æ˜¯ç”±çˆ¶ç»„ä»¶å¼•å‘æ‰ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œåœ¨ React v16.4 æ”¹ä¸ºæ— è®ºæ˜¯ Mounting è¿˜æ˜¯ Updatingï¼Œä¹Ÿæ— è®ºæ˜¯ä»€ä¹ˆå¼•èµ·çš„ Updatingï¼Œå…¨éƒ¨éƒ½ä¼šè°ƒç”¨ã€‚

æœ‰ç‚¹ç±»ä¼¼äº`componentWillReceiveProps`ï¼Œä¸åŒçš„æ˜¯`getDerivedStateFromProps`æ˜¯ä¸€ä¸ªé™æ€å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå‡½æ•°ä¸èƒ½é€šè¿‡ this è®¿é—®åˆ° class çš„å±æ€§ï¼Œå½“ç„¶ä¹Ÿä¸æ¨èä½¿ç”¨

å¦‚æœ props ä¼ å…¥çš„å†…å®¹ä¸éœ€è¦å½±å“åˆ°ä½ çš„ stateï¼Œé‚£ä¹ˆå°±éœ€è¦è¿”å›ä¸€ä¸ª nullï¼Œè¿™ä¸ªè¿”å›å€¼æ˜¯å¿…é¡»çš„ï¼Œæ‰€ä»¥å°½é‡å°†å…¶å†™åˆ°å‡½æ•°çš„æœ«å°¾ã€‚

åœ¨ç»„ä»¶åˆ›å»ºæ—¶å’Œæ›´æ–°æ—¶çš„ render æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå®ƒåº”è¯¥è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–°çŠ¶æ€ï¼Œæˆ–è€…è¿”å› null æ¥ä¸æ›´æ–°ä»»ä½•å†…å®¹ã€‚

#### getSnapshotBeforeUpdate

`getSnapshotBeforeUpdate(prevProps,prevState)`:Updating æ—¶çš„å‡½æ•°ï¼Œåœ¨ render ä¹‹åè°ƒç”¨

- `prevProps`ï¼šç»„ä»¶æ›´æ–°å‰çš„ props
- `prevState`ï¼šç»„ä»¶æ›´æ–°å‰çš„ state

å¯ä»¥è¯»å–ï¼Œä½†æ— æ³•ä½¿ç”¨ DOM çš„æ—¶å€™ï¼Œåœ¨ç»„ä»¶å¯ä»¥åœ¨å¯èƒ½æ›´æ”¹ä¹‹å‰ä» DOM æ•è·ä¸€äº›ä¿¡æ¯ï¼ˆä¾‹å¦‚æ»šåŠ¨ä½ç½®ï¼‰

è¿”å›çš„ä»»ä½•æŒ‡éƒ½å°†ä½œä¸ºå‚æ•°ä¼ é€’ç»™`componentDidUpdateï¼ˆ)`

### æ³¨æ„

åœ¨ 17.0 çš„ç‰ˆæœ¬ï¼Œå®˜æ–¹å½»åº•åºŸé™¤ `componentWillMount`ã€`componentWillReceiveProps`ã€`componentWillUpdate`

å¦‚æœè¿˜æƒ³ä½¿ç”¨çš„è¯å¯ä»¥ä½¿ç”¨ï¼š`UNSAFE_componentWillMount()`ã€`UNSAFE_componentWillReceiveProps()`ã€`UNSAFE_componentWillUpdate()`

å¯¹äº†ï¼Œå¦‚æœåœ¨é¢è¯•çš„æ—¶å€™å¯èƒ½ä¼šé—®é“æœ‰å…³ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ï¼Œå»ºè®®å„ä½å°ä¼™ä¼´ï¼Œå°†ä»¥ä¸Šçš„ç”Ÿå‘½å‘¨æœŸéƒ½å¯è¯´ä¸€è¯´ï¼Œç„¶ååšä¸ªå¯¹æ¯”ï¼Œè¿™æ ·çš„è¯ï¼Œæ•ˆæœè‚¯å®šä¸é”™ï½

## react-hooks

`react-hooks`æ˜¯`React 16.8`çš„äº§ç‰©ï¼Œç»™å‡½æ•°å¼ç»„ä»¶èµ‹ä¸Šäº†`ç”Ÿå‘½å‘¨æœŸ`ï¼Œå†ç»è¿‡ä¸‰å¹´å¤šçš„æ—¶é—´ï¼Œ`å‡½æ•°å¼ç»„ä»¶`å·²ç»é€æ¸å–ä»£äº†`ç±»ç»„ä»¶`ï¼Œå¯ä»¥è¯´æ˜¯`React`å¼€å‘è€…å¿…å¤‡çš„æŠ€æœ¯

åŒæ—¶åœ¨`React v18`ä¸­åˆå‡ºç°äº†ä¸€äº›`hooks`ï¼Œä»Šå¤©æˆ‘ä»¬å°†ä¸€èµ·è¯¦ç»†çš„çœ‹çœ‹ï¼Œç¡®ä¿ä½ èƒ½è¿…é€ŸæŒæ¡ï½

### React v16.8 ä¸­çš„ hooks

#### useState

**useState**ï¼šå®šä¹‰å˜é‡ï¼Œå¯ä»¥ç†è§£ä¸ºä»–æ˜¯ç±»ç»„ä»¶ä¸­çš„`this.state`

ä½¿ç”¨ï¼š

```js
const [state, setState] = useState(initialState);
```

- `state`ï¼šç›®çš„æ˜¯æä¾›ç»™ `UI`ï¼Œä½œä¸ºæ¸²æŸ“è§†å›¾çš„æ•°æ®æº
- `setState`ï¼šæ”¹å˜ state çš„å‡½æ•°ï¼Œå¯ä»¥ç†è§£ä¸º`this.setState`
- `initialState`ï¼šåˆå§‹é»˜è®¤å€¼

åœ¨è¿™é‡Œæˆ‘ä»‹ç»ä¸¤ç§å†™æ³•ï¼Œç›´æ¥çœ‹æ —å­ ğŸŒ°ï¼š

```js
import React, { useState } from "react";
import { Button } from "antd-mobile";

const Index = () => {
  const [number, setNumber] = useState(0);

  return (
    <div style={{ padding: 20 }}>
      <div>æ•°å­—ï¼š{number}</div>
      <Button
        color="primary"
        onClick={() => {
          setNumber(number + 1); //ç¬¬ä¸€ç§
        }}
      >
        ç‚¹å‡»åŠ 1
      </Button>

      <Button
        color="primary"
        style={{ marginLeft: 8 }}
        onClick={() => {
          setNumber((value) => value + 2); //ç¬¬äºŒç§
        }}
      >
        ç‚¹å‡»åŠ 2
      </Button>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š

![img5.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2fa71030e4a5453390a4931db7e15f87~tplv-k3u1fbpfcp-watermark.image?)

##### æ³¨æ„ç‚¹

`useState`æœ‰ç‚¹ç±»ä¼¼äº`PureComponent`,ä¼šè¿›è¡Œä¸€ä¸ªæ¯”è¾ƒæµ…çš„æ¯”è¾ƒï¼Œå¦‚æœæ˜¯å¯¹è±¡çš„æ—¶å€™ç›´æ¥ä¼ å…¥å¹¶ä¸ä¼šæ›´æ–°ï¼Œè¿™ç‚¹ä¸€å®šè¦åˆ‡è®°ï¼Œå¦‚ï¼š

```js
import React, { useState } from "react";
import { Button } from "antd-mobile";

const Index = () => {
  const [state, setState] = useState({ number: 0 });

  return (
    <div style={{ padding: 20 }}>
      <div>æ•°å­—ï¼š{state.number}</div>
      <Button
        color="primary"
        onClick={() => {
          state.number++;
          setState(state);
        }}
      >
        ç‚¹å‡»
      </Button>
    </div>
  );
};

export default Index;
```

![img1.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c84752c460f4104a2d571b73ef9c7ba~tplv-k3u1fbpfcp-watermark.image?)

#### useEffect

`useEffect`ï¼šå‰¯ä½œç”¨ï¼Œä½ å¯ä»¥ç†è§£ä¸ºæ˜¯ç±»ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„é’©å­

é‚£ä¹ˆä»€ä¹ˆæ˜¯å‰¯ä½œç”¨å‘¢ï¼Ÿ
**å‰¯ä½œç”¨ï¼ˆSide Effect**ï¼šæ˜¯æŒ‡ function åšäº†å’Œæœ¬èº«è¿ç®—è¿”å›å€¼æ— å…³çš„äº‹ï¼Œå¦‚è¯·æ±‚æ•°æ®ã€ä¿®æ”¹å…¨å±€å˜é‡ï¼Œæ‰“å°ã€æ•°æ®è·å–ã€è®¾ç½®è®¢é˜…ä»¥åŠæ‰‹åŠ¨æ›´æ”¹ `React` ç»„ä»¶ä¸­çš„ `DOM` éƒ½å±äºå‰¯ä½œç”¨æ“ä½œéƒ½ç®—æ˜¯å‰¯ä½œç”¨

æˆ‘ä»¬ç›´æ¥æ¼”ç¤ºä¸‹å®ƒçš„ç”¨æ³•æ —å­ ğŸŒ°ï¼š

##### ä¸æ–­æ‰§è¡Œ

å½“`useEffect`ä¸è®¾ç«‹ç¬¬äºŒä¸ªå‚æ•°æ—¶ï¼Œæ— è®ºä»€ä¹ˆæƒ…å†µï¼Œéƒ½ä¼šæ‰§è¡Œ

##### æ¨¡æ‹Ÿåˆå§‹åŒ–å’Œå¸è½½

æˆ‘ä»¬å¯ä»¥åˆ©ç”¨`useEffect`å¼„`æŒ‚è½½`å’Œ`å¸è½½`é˜¶æ®µï¼Œé€šå¸¸æˆ‘ä»¬ç”¨äºç›‘å¬`addEventListener`å’Œ`removeEventListener`çš„ä½¿ç”¨

```jsx
import React, { useState, useEffect } from "react";
import { Button } from "antd-mobile";

const Child = () => {
  useEffect(() => {
    console.log("æŒ‚è½½");

    return () => {
      console.log("å¸è½½");
    };
  }, []);

  return <div>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</div>;
};

const Index = () => {
  const [flag, setFlag] = useState(false);

  return (
    <div style={{ padding: 20 }}>
      <Button
        color="primary"
        onClick={() => {
          setFlag((v) => !v);
        }}
      >
        {flag ? "å¸è½½" : "æŒ‚è½½"}
      </Button>
      {flag && <Child />}
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š

![img1.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12a7e4b40008436daf0d7ebe45aa2c78~tplv-k3u1fbpfcp-watermark.image?)

##### æ ¹æ®ä¾èµ–å€¼æ”¹å˜

æˆ‘ä»¬å¯ä»¥è®¾ç½®`useEffect`çš„ç¬¬äºŒä¸ªå€¼æ¥æ”¹å˜

```jsx
import React, { useState, useEffect } from "react";
import { Button } from "antd-mobile";

const Index = () => {
  const [number, setNumber] = useState(0);
  const [count, setCount] = useState(0);

  useEffect(() => {
    console.log("countæ”¹å˜æ‰ä¼šæ‰§è¡Œ");
  }, [count]);

  return (
    <div style={{ padding: 20 }}>
      <div>
        number: {number} count: {count}
      </div>
      <Button color="primary" onClick={() => setNumber((v) => v + 1)}>
        numberç‚¹å‡»åŠ 1
      </Button>
      <Button
        color="primary"
        style={{ marginLeft: 8 }}
        onClick={() => setCount((v) => v + 1)}
      >
        countç‚¹å‡»åŠ 1
      </Button>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š
![img2.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ca2332ae29e4419978b2a778182f216~tplv-k3u1fbpfcp-watermark.image?)

#### useContext

**useContext**ï¼šä¸Šä¸‹æ–‡ï¼Œç±»ä¼¼äº`Context`ï¼šå…¶æœ¬æ„å°±æ˜¯è®¾ç½®å…¨å±€å…±äº«æ•°æ®ï¼Œä½¿æ‰€æœ‰ç»„ä»¶å¯è·¨å±‚çº§å®ç°å…±äº«

`useContext`çš„å‚æ•°ä¸€èˆ¬æ˜¯ç”±`createContext`çš„åˆ›å»ºï¼Œé€šè¿‡ `CountContext.Provider` åŒ…è£¹çš„ç»„ä»¶ï¼Œæ‰èƒ½é€šè¿‡ `useContext` è·å–å¯¹åº”çš„å€¼

ä¸¾ä¸ªä¾‹å­ ğŸŒ°ï¼š

```jsx
import React, { useState, createContext, useContext } from "react";
import { Button } from "antd-mobile";

const CountContext = createContext(-1);

const Child = () => {
  const count = useContext(CountContext);

  return (
    <div style={{ marginTop: 20 }}>
      å­ç»„ä»¶è·å–åˆ°çš„count: {count}
      <Son />
    </div>
  );
};

const Son = () => {
  const count = useContext(CountContext);

  return <div style={{ marginTop: 20 }}>å­™ç»„ä»¶è·å–åˆ°çš„count: {count}</div>;
};

const Index = () => {
  const [count, setCount] = useState(0);

  return (
    <div style={{ padding: 20 }}>
      <div>çˆ¶ç»„ä»¶ï¼š{count}</div>
      <Button color="primary" onClick={() => setCount((v) => v + 1)}>
        ç‚¹å‡»åŠ 1
      </Button>
      <CountContext.Provider value={count}>
        <Child />
      </CountContext.Provider>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š
![img3.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c40ffff952f743e1b391af4da39e376e~tplv-k3u1fbpfcp-watermark.image?)

#### useReducer

**useReducer**ï¼šå®ƒç±»ä¼¼äº`redux`åŠŸèƒ½çš„ api

ç»“æ„ï¼š

```jsx
const [state, dispatch] = useReducer(reducer, initialArg, init);
```

- `state`ï¼šæ›´æ–°åçš„`state`å€¼
- `dispatch`ï¼šå¯ä»¥ç†è§£ä¸ºå’Œ`useState`çš„`setState`ä¸€æ ·çš„æ•ˆæœ
- `reducer`ï¼šå¯ä»¥ç†è§£ä¸º`redux`çš„`reducer`
- `initialArg`ï¼šåˆå§‹å€¼
- `init`ï¼šæƒ°æ€§åˆå§‹åŒ–

ç›´æ¥æ¥çœ‹çœ‹æ —å­ ğŸŒ°ï¼š

```jsx
import React, { useReducer } from "react";
import { Button } from "antd-mobile";

const Index = () => {
  const [count, dispatch] = useReducer((state, action) => {
    switch (action?.type) {
      case "add":
        return state + action?.payload;
      case "sub":
        return state - action?.payload;
      default:
        return state;
    }
  }, 0);

  return (
    <div style={{ padding: 20 }}>
      <div>countï¼š{count}</div>
      <Button
        color="primary"
        onClick={() => dispatch({ type: "add", payload: 1 })}
      >
        åŠ 1
      </Button>
      <Button
        color="primary"
        style={{ marginLeft: 8 }}
        onClick={() => dispatch({ type: "sub", payload: 1 })}
      >
        å‡1
      </Button>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š

![img4.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/26fc08702a3446b28ae23143fd2696fb~tplv-k3u1fbpfcp-watermark.image?)

#### useMemo

**useMemo**:ä¸`memo`çš„ç†å¿µä¸Šå·®ä¸å¤šï¼Œéƒ½æ˜¯åˆ¤æ–­æ˜¯å¦æ»¡è¶³å½“å‰çš„é™å®šæ¡ä»¶æ¥å†³å®šæ˜¯å¦æ‰§è¡Œ`callback`å‡½æ•°ï¼Œè€Œ`useMemo`çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé€šè¿‡è¿™ä¸ªæ•°ç»„æ¥åˆ¤å®šæ˜¯å¦æ›´æ–°å›æ‰å‡½æ•°

å½“ä¸€ä¸ªçˆ¶ç»„ä»¶ä¸­è°ƒç”¨äº†ä¸€ä¸ªå­ç»„ä»¶çš„æ—¶å€™ï¼Œçˆ¶ç»„ä»¶çš„ state å‘ç”Ÿå˜åŒ–ï¼Œä¼šå¯¼è‡´çˆ¶ç»„ä»¶æ›´æ–°ï¼Œè€Œå­ç»„ä»¶è™½ç„¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œä½†ä¹Ÿä¼šè¿›è¡Œæ›´æ–°ã€‚

ç®€å•çš„ç†è§£ä¸‹ï¼Œå½“ä¸€ä¸ªé¡µé¢å†…å®¹éå¸¸å¤æ‚ï¼Œæ¨¡å—éå¸¸å¤šçš„æ—¶å€™ï¼Œå‡½æ•°å¼ç»„ä»¶ä¼š**ä»å¤´æ›´æ–°åˆ°å°¾**ï¼Œåªè¦ä¸€å¤„æ”¹å˜ï¼Œæ‰€æœ‰çš„æ¨¡å—éƒ½ä¼šè¿›è¡Œåˆ·æ–°ï¼Œè¿™ç§æƒ…å†µæ˜¾ç„¶æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚

æˆ‘ä»¬ç†æƒ³çš„çŠ¶æ€æ˜¯å„ä¸ªæ¨¡å—åªè¿›è¡Œè‡ªå·±çš„æ›´æ–°ï¼Œä¸è¦ç›¸äº’å»å½±å“ï¼Œé‚£ä¹ˆæ­¤æ—¶ç”¨`useMemo`æ˜¯æœ€ä½³çš„è§£å†³æ–¹æ¡ˆã€‚

è¿™é‡Œè¦å°¤å…¶æ³¨æ„ä¸€ç‚¹ï¼Œ**åªè¦çˆ¶ç»„ä»¶çš„çŠ¶æ€æ›´æ–°ï¼Œæ— è®ºæœ‰æ²¡æœ‰å¯¹è‡ªç»„ä»¶è¿›è¡Œæ“ä½œï¼Œå­ç»„ä»¶éƒ½ä¼šè¿›è¡Œæ›´æ–°**ï¼Œ`useMemo`å°±æ˜¯ä¸ºäº†é˜²æ­¢è¿™ç‚¹è€Œå‡ºç°çš„

ä¸ºäº†æ›´å¥½çš„ç†è§£`useMemo`ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢ä¸€ä¸ªå°æ —å­ ğŸŒ°ï¼š

```ts
// usePow.ts
const Index = (list: number[]) => {
  return list.map((item: number) => {
    console.log(1);
    return Math.pow(item, 2);
  });
};

export default Index;

// index.tsx
import { Button } from "antd-mobile";
import React, { useState } from "react";
import { usePow } from "@/components";

const Index: React.FC<any> = (props) => {
  const [flag, setFlag] = useState<boolean>(true);
  const data = usePow([1, 2, 3]);

  return (
    <div>
      <div>æ•°å­—ï¼š{JSON.stringify(data)}</div>
      <Button
        color="primary"
        onClick={() => {
          setFlag((v) => !v);
        }}
      >
        åˆ‡æ¢
      </Button>
      <div>åˆ‡æ¢çŠ¶æ€ï¼š{JSON.stringify(flag)}</div>
    </div>
  );
};

export default Index;
```

æˆ‘ä»¬ç®€å•çš„å†™äº†ä¸ª `usePow`ï¼Œæˆ‘ä»¬é€šè¿‡ `usePow` ç»™æ‰€ä¼ å…¥çš„æ•°å­—å¹³æ–¹, ç”¨åˆ‡æ¢çŠ¶æ€çš„æŒ‰é’®è¡¨ç¤ºå‡½æ•°å†…éƒ¨çš„çŠ¶æ€ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ­¤æ—¶çš„æ•ˆæœï¼š

![img2.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d21cc3b15e24a8fba7a7cf3f2a89d14~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆç‚¹å‡»åˆ‡æ¢æŒ‰é’®ä¹Ÿä¼šè§¦å‘`console.log(1)`å‘¢ï¼Ÿ

è¿™æ ·æ˜æ˜¾å¢åŠ äº†æ€§èƒ½å¼€é”€ï¼Œæˆ‘ä»¬çš„ç†æƒ³çŠ¶æ€è‚¯å®šä¸å¸Œæœ›åšæ— å…³çš„æ¸²æŸ“ï¼Œæ‰€ä»¥æˆ‘ä»¬åšè‡ªå®šä¹‰ `hooks`çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ï¼Œéœ€è¦**å‡å°‘æ€§èƒ½å¼€é”€**,æˆ‘ä»¬ä¸ºç»„ä»¶åŠ å…¥ `useMemo`è¯•è¯•ï¼š

```ts
import { useMemo } from "react";

const Index = (list: number[]) => {
  return useMemo(
    () =>
      list.map((item: number) => {
        console.log(1);
        return Math.pow(item, 2);
      }),
    []
  );
};
export default Index;
```

![img3.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3e583fe589a4dacbb0a5a72b2e99cef~tplv-k3u1fbpfcp-watermark.image?)

å‘ç°æ­¤æ—¶å°±å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä¸ä¼šåœ¨åšç›¸å…³çš„æ¸²æŸ“äº†

#### useCallback

`useCallback`ä¸`useMemo`æå…¶ç±»ä¼¼,å¯ä»¥è¯´æ˜¯ä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯`useMemo`è¿”å›çš„æ˜¯å‡½æ•°è¿è¡Œçš„**ç»“æœ**ï¼Œè€Œ`useCallback`è¿”å›çš„æ˜¯**å‡½æ•°**

æ³¨æ„ï¼šè¿™ä¸ªå‡½æ•°æ˜¯çˆ¶ç»„ä»¶ä¼ é€’å­ç»„ä»¶çš„ä¸€ä¸ªå‡½æ•°ï¼Œé˜²æ­¢åšæ— å…³çš„åˆ·æ–°ï¼Œå…¶æ¬¡ï¼Œè¿™ä¸ªç»„ä»¶å¿…é¡»é…åˆ`memo`,å¦åˆ™**ä¸ä½†ä¸ä¼šæå‡æ€§èƒ½ï¼Œè¿˜æœ‰å¯èƒ½é™ä½æ€§èƒ½**

```ts
import React, { useState, useCallback } from "react";
import { Button } from "antd-mobile";

const MockMemo: React.FC<any> = () => {
  const [count, setCount] = useState(0);
  const [show, setShow] = useState(true);

  const add = useCallback(() => {
    setCount(count + 1);
  }, [count]);

  return (
    <div>
      <div style={{ display: "flex", justifyContent: "flex-start" }}>
        <TestButton title="æ™®é€šç‚¹å‡»" onClick={() => setCount(count + 1)} />
        <TestButton title="useCallbackç‚¹å‡»" onClick={add} />
      </div>
      <div style={{ marginTop: 20 }}>count: {count}</div>
      <Button
        onClick={() => {
          setShow(!show);
        }}
      >
        {" "}
        åˆ‡æ¢
      </Button>
    </div>
  );
};

const TestButton = React.memo((props: any) => {
  console.log(props.title);
  return (
    <Button
      color="primary"
      onClick={props.onClick}
      style={
        props.title === "useCallbackç‚¹å‡»"
          ? {
              marginLeft: 20,
            }
          : undefined
      }
    >
      {props.title}
    </Button>
  );
});

export default MockMemo;
```

![img2.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5c00efe7071b40c583a3d167d073a979~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“ç‚¹å‡»åˆ‡æ¢æŒ‰é’®çš„æ—¶å€™ï¼Œæ²¡æœ‰ç»è¿‡ `useCallback`å°è£…çš„å‡½æ•°ä¼šå†æ¬¡åˆ·æ–°ï¼Œè€Œç»è¿‡ `useCallback`åŒ…è£¹çš„å‡½æ•°ä¸ä¼šè¢«å†æ¬¡åˆ·æ–°

æœ‰å¾ˆå¤šå°ä¼™ä¼´æœ‰ä¸ªè¯¯åŒºï¼Œå°±æ˜¯`useCallback`ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»è¦é…åˆ`memo`å—ï¼Ÿ

å…¶å®æ˜¯è¿™æ ·çš„ï¼Œä½ å¯ä»¥å•ç‹¬ä½¿ç”¨`useCallback`ï¼Œä½†åªç”¨`useCallback`èµ·ä¸åˆ°ä¼˜åŒ–çš„ä½œç”¨ï¼Œåè€Œä¼šå¢åŠ æ€§èƒ½æ¶ˆè€—

æƒ³ä¹‹å‰è®²çš„ï¼Œ`React.memo`ä¼šé€šè¿‡æµ…æ¯”è¾ƒé‡Œé¢çš„`props`ï¼Œå¦‚æœæ²¡æœ‰`memo`ï¼Œé‚£ä¹ˆä½¿ç”¨çš„`useCallback`ä¹Ÿå°±æ¯«æ— æ„ä¹‰

å› ä¸º`useCallback`æœ¬èº«æ˜¯éœ€è¦å¼€é”€çš„ï¼Œæ‰€ä»¥åè€Œä¼šå¢åŠ æ€§èƒ½çš„æ¶ˆè€—

#### useRef

**useRef**ï¼š å¯ä»¥è·å–å½“å‰å…ƒç´ çš„æ‰€æœ‰å±æ€§ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¯å˜çš„ ref å¯¹è±¡ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡**åªæœ‰ current å±æ€§**ï¼Œå¯è®¾ç½®`initialValue`

ç»“æ„ï¼š

    const refContainer = useRef(initialValue);

æœ‰è®¸å¤šå°ä¼™ä¼´åªçŸ¥é“`useRef`å¯ä»¥è·å–å¯¹åº”å…ƒç´ çš„å±æ€§ï¼Œä½†`useRef`è¿˜å…·å¤‡ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯`ç¼“å­˜æ•°æ®`ï¼Œæ¥ä¸‹æ¥ä¸€èµ·çœ‹çœ‹ï¼š

##### é€šè¿‡ useRef è·å–å¯¹åº”çš„å±æ€§å€¼

æ —å­ ğŸŒ°ï¼š

```ts
import React, { useState, useRef } from "react";

const Index: React.FC<any> = () => {
  const scrollRef = useRef<any>(null);
  const [clientHeight, setClientHeight] = useState<number>(0);
  const [scrollTop, setScrollTop] = useState<number>(0);
  const [scrollHeight, setScrollHeight] = useState<number>(0);

  const onScroll = () => {
    if (scrollRef?.current) {
      let clientHeight = scrollRef?.current.clientHeight; //å¯è§†åŒºåŸŸé«˜åº¦
      let scrollTop = scrollRef?.current.scrollTop; //æ»šåŠ¨æ¡æ»šåŠ¨é«˜åº¦
      let scrollHeight = scrollRef?.current.scrollHeight; //æ»šåŠ¨å†…å®¹é«˜åº¦
      setClientHeight(clientHeight);
      setScrollTop(scrollTop);
      setScrollHeight(scrollHeight);
    }
  };

  return (
    <div>
      <div>
        <p>å¯è§†åŒºåŸŸé«˜åº¦ï¼š{clientHeight}</p>
        <p>æ»šåŠ¨æ¡æ»šåŠ¨é«˜åº¦ï¼š{scrollTop}</p>
        <p>æ»šåŠ¨å†…å®¹é«˜åº¦ï¼š{scrollHeight}</p>
      </div>
      <div
        style={{ height: 200, overflowY: "auto" }}
        ref={scrollRef}
        onScroll={onScroll}
      >
        <div style={{ height: 2000 }}></div>
      </div>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š
![img1.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ce0221becc3940ec8610783afa66f5dc~tplv-k3u1fbpfcp-watermark.image?)

ä»ä¸Šè¿°å¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`useRef`æ¥è·å–å¯¹åº”å…ƒç´ çš„ç›¸å…³å±æ€§ï¼Œä»¥æ­¤æ¥åšä¸€äº›æ“ä½œ

##### ç¼“å­˜æ•°æ®

`react-redux`çš„æºç ä¸­ï¼Œåœ¨ hooks æ¨å‡ºåï¼Œ`react-redux`ç”¨å¤§é‡çš„**useMemo**é‡åšäº†**Provide**ç­‰æ ¸å¿ƒæ¨¡å—ï¼Œå…¶ä¸­å°±æ˜¯è¿ç”¨**useRef**æ¥ç¼“å­˜æ•°æ®ï¼Œå¹¶ä¸”æ‰€è¿ç”¨çš„ **useRef()** æ²¡æœ‰ä¸€ä¸ªæ˜¯ç»‘å®šåœ¨ dom å…ƒç´ ä¸Šçš„ï¼Œéƒ½æ˜¯åšæ•°æ®ç¼“å­˜ç”¨çš„

å¯ä»¥ç®€å•çš„æ¥çœ‹ä¸€ä¸‹ï¼š

```js
// ç¼“å­˜æ•°æ®
/* react-redux ç”¨userRef æ¥ç¼“å­˜ mergeä¹‹åçš„ props */
const lastChildProps = useRef();

// lastWrapperProps ç”¨ useRef æ¥å­˜æ”¾ç»„ä»¶çœŸæ­£çš„ propsä¿¡æ¯
const lastWrapperProps = useRef(wrapperProps);

//æ˜¯å¦å‚¨å­˜propsæ˜¯å¦å¤„äºæ­£åœ¨æ›´æ–°çŠ¶æ€
const renderIsScheduled = useRef(false);

//æ›´æ–°æ•°æ®
function captureWrapperProps(
  lastWrapperProps,
  lastChildProps,
  renderIsScheduled,
  wrapperProps,
  actualChildProps,
  childPropsFromStoreUpdate,
  notifyNestedSubs
) {
  lastWrapperProps.current = wrapperProps;
  lastChildProps.current = actualChildProps;
  renderIsScheduled.current = false;
}
```

æˆ‘ä»¬çœ‹åˆ° `react-redux` ç”¨é‡æ–°èµ‹å€¼çš„æ–¹æ³•ï¼Œæ”¹å˜äº†ç¼“å­˜çš„æ•°æ®æºï¼Œå‡å°‘äº†ä¸å¿…è¦çš„æ›´æ–°ï¼Œå¦‚è¿‡é‡‡å–`useState`åŠ¿å¿…ä¼šé‡æ–°æ¸²æŸ“ã€‚

æœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦ä½¿ç”¨**useMemo**ã€**useCallback**Apiï¼Œæˆ‘ä»¬æ§åˆ¶å˜é‡çš„å€¼ç”¨**useState** æœ‰å¯èƒ½ä¼šå¯¼è‡´æ‹¿åˆ°çš„æ˜¯æ—§å€¼ï¼Œå¹¶ä¸”å¦‚æœä»–ä»¬æ›´æ–°ä¼šå¸¦æ¥æ•´ä¸ªç»„ä»¶é‡æ–°æ‰§è¡Œï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨**useRef**å°†ä¼šæ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„é€‰æ‹©

#### useImperativeHandle

**useImperativeHandle**ï¼šå¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ `ref` æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼

è¿™ä¸ª Api æˆ‘è§‰å¾—æ˜¯ååˆ†æœ‰ç”¨çš„ï¼Œå»ºè®®æŒæ¡å“¦ï¼Œæ¥çœ‹çœ‹ä½¿ç”¨çš„åœºæ™¯ï¼š

åœ¨ä¸€ä¸ªé¡µé¢å¾ˆå¤æ‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå°†è¿™ä¸ªé¡µé¢è¿›è¡Œæ¨¡å—åŒ–ï¼Œè¿™æ ·ä¼šåˆ†æˆå¾ˆå¤šä¸ªæ¨¡å—ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨`æœ€å¤–å±‚çš„ç»„ä»¶ä¸Š`æ§åˆ¶å…¶ä»–ç»„ä»¶çš„æ–¹æ³•ï¼Œå¸Œæœ›æœ€å¤–å±‚çš„ç‚¹å‡»äº‹ä»¶ï¼ŒåŒæ—¶æ‰§è¡Œ`å­ç»„ä»¶çš„äº‹ä»¶`ï¼Œè¿™æ—¶å°±éœ€è¦ useImperativeHandle çš„å¸®åŠ©

ç»“æ„ï¼š

```jsx
useImperativeHandle(ref, createHandle, [deps]);
```

- `ref`ï¼š`useRef`æ‰€åˆ›å»ºçš„ ref
- `createHandle`ï¼šå¤„ç†çš„å‡½æ•°ï¼Œè¿”å›å€¼ä½œä¸ºæš´éœ²ç»™çˆ¶ç»„ä»¶çš„ ref å¯¹è±¡ã€‚
- `deps`ï¼šä¾èµ–é¡¹ï¼Œä¾èµ–é¡¹æ›´æ”¹å½¢æˆæ–°çš„ ref å¯¹è±¡ã€‚

ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š

```jsx
import React, { useState, useImperativeHandle, useRef } from "react";
import { Button } from "antd-mobile";

const Child = ({ cRef }) => {
  const [count, setCount] = useState(0);

  useImperativeHandle(cRef, () => ({
    add,
  }));

  const add = () => {
    setCount((v) => v + 1);
  };

  return (
    <div style={{ marginBottom: 20 }}>
      <p>ç‚¹å‡»æ¬¡æ•°ï¼š{count}</p>
      <Button color="primary" onClick={() => add()}>
        åŠ 1
      </Button>
    </div>
  );
};

const Index = () => {
  const ref = useRef(null);

  return (
    <div style={{ padding: 20 }}>
      <div>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</div>
      <div>æ³¨æ„:æ˜¯åœ¨çˆ¶ç»„ä»¶ä¸Šçš„æŒ‰é’®ï¼Œæ§åˆ¶å­ç»„ä»¶çš„åŠ 1å“¦ï½</div>
      <Button color="primary" onClick={() => ref.current.add()}>
        çˆ¶èŠ‚ç‚¹ä¸Šçš„åŠ 1
      </Button>
      <Child cRef={ref} />
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š

![img5.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76e810c5966a49c2bd9ce8f505f5b18c~tplv-k3u1fbpfcp-watermark.image?)

#### useLayoutEffect

**useLayoutEffect**ï¼š ä¸`useEffect`åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒçš„åœ°æ–¹æ—¶ï¼Œ`useLayoutEffect`æ˜¯`åŒæ­¥`

è¦æ³¨æ„çš„æ˜¯`useLayoutEffect`åœ¨ DOM æ›´æ–°ä¹‹åï¼Œæµè§ˆå™¨ç»˜åˆ¶ä¹‹å‰ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„ä¿®æ”¹ `DOM`ï¼Œè·å– `DOM` ä¿¡æ¯,è¿™æ ·æµè§ˆå™¨åªä¼šç»˜åˆ¶ä¸€æ¬¡ï¼Œæ‰€ä»¥`useLayoutEffect`åœ¨`useEffect`ä¹‹å‰æ‰§è¡Œ

å¦‚æœæ˜¯`useEffect`çš„è¯ ï¼Œ`useEffect` æ‰§è¡Œåœ¨æµè§ˆå™¨ç»˜åˆ¶è§†å›¾ä¹‹åï¼Œå¦‚æœåœ¨æ­¤æ—¶æ”¹å˜`DOM`ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´æµè§ˆå™¨å†æ¬¡`å›æµ`å’Œ`é‡ç»˜`ã€‚

é™¤æ­¤ä¹‹å¤–`useLayoutEffect`çš„ `callback` ä¸­ä»£ç æ‰§è¡Œä¼šé˜»å¡æµè§ˆå™¨ç»˜åˆ¶

ä¸¾ä¸ªä¾‹å­ ğŸŒ°ï¼š

```js
import React, { useState, useLayoutEffect, useEffect, useRef } from "react";
import { Button } from "antd-mobile";

const Index = () => {
  const [count, setCount] = useState(0);
  const time = useRef(null);

  useEffect(() => {
    if (time.current) {
      console.log("useEffect:", performance.now() - time.current);
    }
  });

  useLayoutEffect(() => {
    if (time.current) {
      console.log("useLayoutEffect:", performance.now() - time.current);
    }
  });

  return (
    <div style={{ padding: 20 }}>
      <div>count: {count}</div>
      <Button
        color="primary"
        onClick={() => {
          setCount((v) => v + 1);
          time.current = performance.now();
        }}
      >
        åŠ 1
      </Button>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š

![img6.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c5ed88f799b44b197e4d8d2dd1a0456~tplv-k3u1fbpfcp-watermark.image?)

#### useDebugValue

**useDebugValue**ï¼šå¯ç”¨äºåœ¨ `React` å¼€å‘è€…å·¥å…·ä¸­æ˜¾ç¤º`è‡ªå®šä¹‰ hook çš„æ ‡ç­¾`

å®˜æ–¹å¹¶ä¸æ¨èä½ å‘æ¯ä¸ªè‡ªå®šä¹‰ Hook æ·»åŠ  debug å€¼ã€‚å½“å®ƒä½œä¸ºå…±äº«åº“çš„ä¸€éƒ¨åˆ†æ—¶æ‰æœ€æœ‰ä»·å€¼ã€‚

```js
function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);

  // ...

  // åœ¨å¼€å‘è€…å·¥å…·ä¸­çš„è¿™ä¸ª Hook æ—è¾¹æ˜¾ç¤ºæ ‡ç­¾
  // e.g. "FriendStatus: Online"  useDebugValue(isOnline ? 'Online' : 'Offline');
  return isOnline;
}
```

### React v18 ä¸­çš„ hooks

#### useSyncExternalStore

**useSyncExternalStore**:æ˜¯ä¸€ä¸ªæ¨èç”¨äº`è¯»å–`å’Œ`è®¢é˜…å¤–éƒ¨æ•°æ®æº`çš„ `hook`ï¼Œå…¶æ–¹å¼ä¸é€‰æ‹©æ€§çš„ `hydration` å’Œæ—¶é—´åˆ‡ç‰‡ç­‰å¹¶å‘æ¸²æŸ“åŠŸèƒ½å…¼å®¹

ç»“æ„ï¼š

    const state = useSyncExternalStore(subscribe, getSnapshot[, getServerSnapshot])

- `subscribe`: è®¢é˜…å‡½æ•°ï¼Œç”¨äºæ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å­˜å‚¨å€¼å‘ç”Ÿæ›´æ”¹æ—¶è¢«è°ƒç”¨ã€‚æ­¤å¤–ï¼Œ `useSyncExternalStore` ä¼šé€šè¿‡å¸¦æœ‰è®°å¿†æ€§çš„ `getSnapshot` æ¥åˆ¤åˆ«æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆä¼š`å¼ºåˆ¶æ›´æ–°`æ•°æ®ã€‚
- `getSnapshot`: è¿”å›å½“å‰å­˜å‚¨å€¼çš„å‡½æ•°ã€‚å¿…é¡»è¿”å›ç¼“å­˜çš„å€¼ã€‚å¦‚æœ `getSnapshot` è¿ç»­å¤šæ¬¡è°ƒç”¨ï¼Œåˆ™å¿…é¡»è¿”å›ç›¸åŒçš„ç¡®åˆ‡å€¼ï¼Œé™¤éä¸­é—´æœ‰å­˜å‚¨å€¼æ›´æ–°ã€‚
- `getServerSnapshot`ï¼šè¿”å›æœåŠ¡ç«¯(`hydration`æ¨¡å¼ä¸‹)æ¸²æŸ“æœŸé—´ä½¿ç”¨çš„å­˜å‚¨å€¼çš„å‡½æ•°

ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š

```jsx
import React, { useSyncExternalStore } from "react";
import { combineReducers, createStore } from "redux";

const reducer = (state = 1, action) => {
  switch (action.type) {
    case "ADD":
      return state + 1;
    case "DEL":
      return state - 1;
    default:
      return state;
  }
};

/* æ³¨å†Œreducer,å¹¶åˆ›å»ºstore */
const rootReducer = combineReducers({ count: reducer });
const store = createStore(rootReducer, { count: 1 });

const Index = () => {
  // è®¢é˜…
  const state = useSyncExternalStore(
    store.subscribe,
    () => store.getState().count
  );
  return (
    <div>
      <div>{state}</div>
      <div>
        <button onClick={() => store.dispatch({ type: "ADD" })}>åŠ 1</button>
        <button
          style={{ marginLeft: 8 }}
          onClick={() => store.dispatch({ type: "DEL" })}
        >
          å‡1
        </button>
      </div>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š

![img1.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/870ec6a15d1d47ec90604475f9a9c5e0~tplv-k3u1fbpfcp-watermark.image?)

ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå½“ç‚¹å‡»æŒ‰é’®åï¼Œä¼šè§¦å‘ `store.subscribe`ï¼ˆè®¢é˜…å‡½æ•°ï¼‰ï¼Œæ‰§è¡Œ`getSnapshot`åå¾—åˆ°æ–°çš„`count`ï¼Œå¦‚æœ`count`å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¼šè§¦å‘æ›´æ–°

#### useTransition

**useTransition**ï¼šè¿”å›ä¸€ä¸ªçŠ¶æ€å€¼è¡¨ç¤ºè¿‡æ¸¡ä»»åŠ¡çš„ç­‰å¾…çŠ¶æ€ï¼Œä»¥åŠä¸€ä¸ªå¯åŠ¨è¯¥è¿‡æ¸¡ä»»åŠ¡çš„å‡½æ•°ã€‚

é‚£ä¹ˆä»€ä¹ˆæ˜¯è¿‡æ¸¡ä»»åŠ¡ï¼Ÿ

åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œå¦‚ï¼šè¾“å…¥æ¡†ã€tab åˆ‡æ¢ã€æŒ‰é’®ç­‰ï¼Œè¿™äº›ä»»åŠ¡éœ€è¦è§†å›¾ä¸Š`ç«‹åˆ»`åšå‡ºå“åº”ï¼Œè¿™äº›ä»»åŠ¡å¯ä»¥ç§°ä¹‹ä¸ºç«‹å³æ›´æ–°çš„ä»»åŠ¡

ä½†æœ‰çš„æ—¶å€™ï¼Œæ›´æ–°ä»»åŠ¡å¹¶ä¸æ˜¯é‚£ä¹ˆç´§æ€¥ï¼Œæˆ–è€…æ¥è¯´è¦å»è¯·æ±‚æ•°æ®ç­‰ï¼Œå¯¼è‡´æ–°çš„çŠ¶æ€ä¸èƒ½ç«‹æ›´æ–°ï¼Œéœ€è¦ç”¨ä¸€ä¸ª`loading...`çš„ç­‰å¾…çŠ¶æ€ï¼Œè¿™ç±»ä»»åŠ¡å°±æ˜¯è¿‡åº¦ä»»åŠ¡

ç»“æ„ï¼š

    const [isPending, startTransition] = useTransition();

- `isPending`ï¼šè¿‡æ¸¡çŠ¶æ€çš„æ ‡å¿—ï¼Œä¸º`true`æ—¶æ˜¯ç­‰å¾…çŠ¶æ€
- `startTransition`ï¼šå¯ä»¥å°†é‡Œé¢çš„ä»»åŠ¡å˜æˆè¿‡æ¸¡ä»»åŠ¡

å¤§å®¶å¯èƒ½å¯¹ä¸Šé¢çš„æè¿°å­˜åœ¨ç€ä¸€äº›ç–‘é—®ï¼Œæˆ‘ä»¬ç›´æ¥ä¸¾ä¸ªä¾‹å­ ğŸŒ° æ¥è¯´æ˜ï¼š

```jsx
import React, { useState, useTransition } from "react";

const Index = () => {
  const [isPending, startTransition] = useTransition();
  const [input, setInput] = useState("");
  const [list, setList] = useState([]);

  return (
    <div>
      <div>å¤§å®¶å¥½ï¼šæˆ‘æ˜¯å°æœæœ~</div>
      è¾“å…¥æ¡†ï¼š <input
        value={input}
        onChange={(e) => {
          setInput(e.target.value);
          startTransition(() => {
            const res = [];
            for (let i = 0; i < 2000; i++) {
              res.push(e.target.value);
            }
            setList(res);
          });
        }}
      />
      {isPending ? (
        <div>åŠ è½½ä¸­...</div>
      ) : (
        list.map((item, index) => <div key={index}>{item}</div>)
      )}
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š

![img3.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a1c6c97b8f742dab5d2e76f56e52223~tplv-k3u1fbpfcp-watermark.image?)

å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨`Input`è¾“å…¥å†…å®¹æ˜¯ï¼Œä¼šè¿›è¡Œå¢åŠ ï¼Œå‡è®¾æˆ‘ä»¬åœ¨`startTransition`ä¸­è¯·æ±‚ä¸€ä¸ªæ¥å£ï¼Œåœ¨æ¥å£è¯·æ±‚çš„æ—¶å€™ï¼Œ`isPending`ä¼šä¸º`true`ï¼Œå°±ä¼šæœ‰ä¸€ä¸ª`loading`çš„çŠ¶æ€ï¼Œè¯·æ±‚å®Œä¹‹åï¼Œ`isPending`å˜ä¸º`false`æ¸²æŸ“åˆ—è¡¨

#### useDeferredValue

**useDeferredValue**ï¼šæ¥å—ä¸€ä¸ªå€¼ï¼Œå¹¶è¿”å›è¯¥å€¼çš„æ–°å‰¯æœ¬ï¼Œè¯¥å‰¯æœ¬å°†æ¨è¿Ÿåˆ°æ›´ç´§æ€¥åœ°æ›´æ–°ä¹‹åã€‚

å¦‚æœå½“å‰æ¸²æŸ“æ˜¯ä¸€ä¸ªç´§æ€¥æ›´æ–°çš„ç»“æœï¼Œæ¯”å¦‚ç”¨æˆ·è¾“å…¥ï¼Œ`React` å°†è¿”å›ä¹‹å‰çš„å€¼ï¼Œç„¶ååœ¨ç´§æ€¥æ¸²æŸ“å®Œæˆåæ¸²æŸ“æ–°çš„å€¼ã€‚

ä¹Ÿå°±æ˜¯è¯´`useDeferredValue`å¯ä»¥è®©çŠ¶æ€`æ»åæ´¾ç”Ÿ`

ç»“æ„ï¼š

```jsx
const deferredValue = useDeferredValue(value);
```

- `value`ï¼šå¯å˜çš„å€¼ï¼Œå¦‚`useState`åˆ›å»ºçš„å€¼
- `deferredValue`: å»¶æ—¶çŠ¶æ€

è¿™ä¸ªæ„Ÿè§‰å’Œ`useTransition`æœ‰ç‚¹ç›¸ä¼¼ï¼Œè¿˜æ˜¯ä»¥è¾“å…¥æ¡†çš„æ¨¡å¼ï¼Œä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š

```jsx
import React, { useState, useDeferredValue } from "react";

const getList = (key) => {
  const arr = [];
  for (let i = 0; i < 10000; i++) {
    if (String(i).includes(key)) {
      arr.push(<li key={i}>{i}</li>);
    }
  }
  return arr;
};
const Index = () => {
  const [value, setValue] = useState("");
  const deferredValue = useDeferredValue(value);
  console.log("valueï¼š", value);
  console.log("deferredValueï¼š", deferredValue);

  return (
    <div>
      <div>
        <div>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</div>
        è¾“å…¥æ¡†ï¼š
        <input onChange={(e) => setValue(e.target.value)} />
      </div>
      <div>
        <ul>{deferredValue ? getList(deferredValue) : null}</ul>
      </div>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š

![img4.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7fba0464083c44bf985446b79c2dd55a~tplv-k3u1fbpfcp-watermark.image?)

##### å’Œ useTransition åšå¯¹æ¯”

æ ¹æ®ä¸Šé¢ä¸¤ä¸ªç¤ºä¾‹æˆ‘ä»¬çœ‹çœ‹`useTransition`å’Œ`useDeferredValue`åšä¸ªå¯¹æ¯”çœ‹çœ‹

- ç›¸åŒç‚¹ï¼š`useDeferredValue`å’Œ`useTransition`ä¸€æ ·ï¼Œéƒ½æ˜¯è¿‡æ¸¡æ›´æ–°ä»»åŠ¡
- ä¸åŒç‚¹ï¼š`useTransition`ç»™çš„æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼Œè€Œ`useDeferredValue`ç»™çš„æ˜¯ä¸€ä¸ªå€¼

#### useInsertionEffect

**useInsertionEffect**ï¼šä¸ `useEffect`ä¸€æ ·ï¼Œä½†å®ƒåœ¨æ‰€æœ‰ DOM çªå˜ Â  ä¹‹å‰åŒæ­¥è§¦å‘ã€‚

æˆ‘ä»¬æ¥çœ‹çœ‹`useInsertionEffect`å¯¹æ¯”äº`useEffect`å’Œ`useLayoutEffect`åœ¨æ‰§è¡Œé¡ºåºä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæ —å­ ğŸŒ°ï¼š

```jsx
useEffect(() => {
  console.log("useEffect");
}, []);

useLayoutEffect(() => {
  console.log("useLayoutEffect");
}, []);

useInsertionEffect(() => {
  console.log("useInsertionEffect");
}, []);
```

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9e3d0646cd34de89a5681f60ee94912~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥çœ‹åˆ°åœ¨æ‰§è¡Œé¡ºåºä¸Š `useInsertionEffect` > `useLayoutEffect` > `useEffect`

ç‰¹åˆ«æ³¨æ„ä¸€ç‚¹ï¼š`useInsertionEffect`Â  åº”ä»…é™äº **css-in-js** åº“ä½œè€…ä½¿ç”¨ã€‚ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ Â `useEffect`Â  æˆ– Â `useLayoutEffect`Â  æ¥æ›¿ä»£ã€‚

æ¨¡æ‹Ÿä¸€ä¸‹`seInsertionEffect`çš„ä½¿ç”¨ ğŸŒ°ï¼š

```jsx
import React, { useInsertionEffect } from "react";

const Index = () => {
  useInsertionEffect(() => {
    const style = document.createElement("style");
    style.innerHTML = `
      .css-in-js{
        color: blue;
      }
    `;
    document.head.appendChild(style);
  }, []);

  return (
    <div>
      <div className="css-in-js">å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</div>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/60517f354457436a8e24dccf0ed5a6a2~tplv-k3u1fbpfcp-watermark.image?)

#### useId

**useId** ï¼šÂ  æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆæ¨ªè·¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ç¨³å®šçš„`å”¯ä¸€ ID` çš„åŒæ—¶é¿å…`hydration` ä¸åŒ¹é…çš„ `hook`ã€‚

è¿™é‡Œç‰µæ‰¯åˆ°`SSR`çš„é—®é¢˜ï¼Œæˆ‘æ‰“ç®—ä¹‹ååœ¨å•ç‹¬å†™ä¸€ç« ï¼Œæ¥è¯¦ç»†è®²è®²ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå°±ä»‹ç»ä¸€ä¸‹ä½¿ç”¨å³å¯

        const id = useId();

ä¾‹å­ ğŸŒ°ï¼š

```jsx
import React, { useId } from "react";

const Index = () => {
  const id = useId();

  return (
    <div>
      <div id={id}>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</div>
    </div>
  );
};

export default Index;
```

æ•ˆæœï¼š
![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bff8dd2e73d447e4939f41072772ed85~tplv-k3u1fbpfcp-watermark.image?)

### è‡ªå®šä¹‰ hooks

`è‡ªå®šä¹‰hooks`æ˜¯åœ¨`react-hooks`åŸºç¡€ä¸Šçš„ä¸€ä¸ªæ‰©å±•ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡ã€éœ€æ±‚å»åˆ¶å®šç›¸åº”çš„`hooks`,å°†å¸¸ç”¨çš„é€»è¾‘è¿›è¡Œå°è£…ï¼Œä»è€Œå…·å¤‡å¤ç”¨æ€§

å…³äºè‡ªå®šä¹‰`hooks`çš„å†…å®¹å¯ä»¥çœ‹çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š[ææ‡‚è¿™ 12 ä¸ª Hooksï¼Œä¿è¯è®©ä½ ç©è½¬ React](https://juejin.cn/post/7101486767336849421)

é‡Œé¢é€šè¿‡åˆ†æ`ahooks`æºç ï¼Œè®²è§£äº†å¾ˆå¤šä¸é”™çš„è‡ªå®šä¹‰`hooks`ï¼Œå¦‚ï¼š`useCreation`ã€`useReactive`ã€`useEventListener`ç­‰çš„å®ç°ï¼Œç›¸ä¿¡ä¸€å®šèƒ½å¤Ÿå¸®åŠ©åˆ°å„ä½ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æ”¯æŒä¸‹ï½

## react-dom

**react-dom**ï¼šè¿™ä¸ªåŒ…æä¾›äº†ç”¨æˆ· DOM çš„ç‰¹å®šæ–¹æ³•ã€‚è¿™ä¸ªåŒ…åœ¨`React v18`ä¸­è¿˜æ˜¯åšäº†å¾ˆå¤§çš„æ”¹åŠ¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€ä¸ªçœ‹çœ‹

### createPortal

**createPortal**ï¼šåœ¨`Portal`ä¸­æä¾›äº†ä¸€ç§å°†å­èŠ‚ç‚¹æ¸²æŸ“åˆ°å·² DOM èŠ‚ç‚¹ä¸­çš„æ–¹å¼ï¼Œè¯¥èŠ‚ç‚¹å­˜åœ¨äº DOM ç»„ä»¶çš„å±‚æ¬¡ç»“æ„ä¹‹å¤–ã€‚

ä¹Ÿå°±æ˜¯è¯´`createPortal`å¯ä»¥æŠŠå½“å‰ç»„ä»¶æˆ–`element`å…ƒç´ çš„å­èŠ‚ç‚¹ï¼Œæ¸²æŸ“åˆ°ç»„ä»¶ä¹‹å¤–çš„å…¶ä»–åœ°æ–¹ã€‚

æ¥çœ‹çœ‹`createPortal(child, container)`çš„å…¥å‚ï¼š

- `child`ï¼šä»»ä½•å¯æ¸²æŸ“çš„å­å…ƒç´ 
- `container`ï¼šæ˜¯ä¸€ä¸ª`DOM`å…ƒç´ 

çœ‹ç€æ¦‚å¿µå¯èƒ½å¹¶ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š

```jsx
import React, { useState, useEffect, useRef } from "react";
import ReactDom from "react-dom";

const Child = ({ children }) => {
  const ref = useRef();
  const [newDom, setNewDom] = useState();

  useEffect(() => {
    setNewDom(ReactDom.createPortal(children, ref.current));
  }, []);

  return (
    <div>
      <div ref={ref}>åŒçº§çš„èŠ‚ç‚¹</div>
      <div>
        è¿™å±‚çš„èŠ‚ç‚¹
        {newDom}
      </div>
    </div>
  );
};

const Index = () => {
  return (
    <div style={{ padding: 20 }}>
      <Child>
        <div>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</div>
      </Child>
    </div>
  );
};

export default Index;
```

è¦æ³¨æ„ä¸‹`Child`:

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2f8d35a22bfb4d619294efba52923b91~tplv-k3u1fbpfcp-watermark.image?)
æˆ‘ä»¬ä¼ å…¥çš„`children`è¢«`createPortal`åŒ…è£¹åï¼Œ`children`çš„èŠ‚ç‚¹ä½ç½®ä¼šå¦‚ä½•ï¼Ÿ

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f3e92824e6d5438bbc1e9b438224fddf~tplv-k3u1fbpfcp-watermark.image?)
å‘ç°ï¼Œæˆ‘ä»¬å¤„ç†çš„æ•°`newDom`çš„æ•°æ®åˆ°äº†åŒçº§çš„èŠ‚ç‚¹å¤„ï¼Œé‚£ä¹ˆè¿™ä¸ª`Api`è¯¥å¦‚ä½•åº”ç”¨å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥å¤„ç†ä¸€äº›é¡¶å±‚å…ƒç´ ï¼Œå¦‚ï¼š`Modal`å¼¹æ¡†ç»„ä»¶ï¼Œ`Modal`ç»„ä»¶åœ¨å†…éƒ¨ä¸­ä¹¦å†™ï¼ŒæŒ‚è½½åˆ°å¤–å±‚çš„å®¹å™¨ï¼ˆå¦‚ bodyï¼‰ï¼Œæ­¤æ—¶è¿™ä¸ª`Api`å°±éå¸¸æœ‰ç”¨

### flushSync

**flushSync**ï¼šå¯ä»¥å°†å›è°ƒå‡½æ•°ä¸­çš„æ›´æ–°ä»»åŠ¡ï¼Œæ”¾åˆ°ä¸€ä¸ªè¾ƒé«˜çº§çš„ä¼˜å…ˆçº§ä¸­ï¼Œé€‚ç”¨äºå¼ºåˆ¶åˆ·æ–°ï¼ŒåŒæ—¶ç¡®ä¿äº†`DOM`ä¼šè¢«ç«‹å³æ›´æ–°

ä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œæˆ‘ä»¬ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š

```js
import { Button } from "antd-mobile";
import React, { Component } from "react";
import ReactDOM from "react-dom";

class Index extends Component {
  constructor(props) {
    super(props);
    this.state = {
      number: 0,
    };
  }

  render() {
    const { number } = this.state;
    console.log(number);
    return (
      <div style={{ padding: 20 }}>
        <div>æ•°å­—: {number}</div>
        <Button
          color="primary"
          onClick={() => {
            this.setState({ number: 1 });
            this.setState({ number: 2 });
            this.setState({ number: 3 });
          }}
        >
          ç‚¹å‡»
        </Button>
      </div>
    );
  }
}

export default Index;
```

æˆ‘ä»¬çœ‹çœ‹ç‚¹å‡»æŒ‰é’®ä¼šæ‰“å°å‡ºä»€ä¹ˆï¼Ÿ

![img6.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c3803007e4e425c8af37620a385d8db~tplv-k3u1fbpfcp-watermark.image?)

è¿™ä¸ªä¸éš¾ç†è§£ï¼Œå› ä¸º`this.setState`ä¼šè¿›è¡Œæ‰¹é‡æ›´æ–°ï¼Œæ‰€ä»¥æ‰“å°å‡ºçš„æ˜¯ 3
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨`flushSync`å¤„ç†ä¸‹`number: 2 `æ¥çœ‹çœ‹æ˜¯ä»€ä¹ˆæ•ˆæœï¼š

```js
    onClick={() => {
      this.setState({ number: 1  })
      ReactDOM.flushSync(()=>{
        this.setState({ number: 2  })
      })
      this.setState({ number: 3  })
    }}
```

![img1.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a67cde72ec864d888d01b6fe96277076~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥å‘ç°`flushSync`ä¼šä¼˜å…ˆæ‰§è¡Œï¼Œå¹¶ä¸”å¼ºåˆ¶åˆ·æ–°ï¼Œæ‰€ä»¥ä¼šæ”¹å˜`number`å€¼ä¸º 2ï¼Œç„¶å`1`å’Œ`3`åœ¨è¢«æ‰¹é‡åˆ·æ–°ï¼Œæ›´æ–°ä¸º 3

### render

**render**ï¼šè¿™ä¸ªæ˜¯æˆ‘ä»¬åœ¨`react-dom`ä¸­æœ€å¸¸ç”¨çš„ Apiï¼Œç”¨äºæ¸²æŸ“ä¸€ä¸ª`react`å…ƒç´ 

æˆ‘ä»¬é€šå¸¸ä½¿ç”¨åœ¨æ ¹éƒ¨ï¼Œå¦‚ï¼š

```js
ReactDOM.render(<App />, document.getElementById("app"));
```

#### createRoot

åœ¨`React v18`ä¸­ï¼Œ`render`å‡½æ•°å·²ç»è¢«`createRoot`æ‰€æ›¿ä»£

`createRoot`ä¼šæ§åˆ¶ä½ ä¼ å…¥çš„å®¹å™¨èŠ‚ç‚¹çš„å†…å®¹ã€‚å½“è°ƒç”¨ render æ—¶ï¼Œé‡Œé¢çš„ä»»ä½•ç°æœ‰ DOM å…ƒç´ éƒ½ä¼šè¢«æ›¿æ¢ã€‚åé¢çš„è°ƒç”¨ä½¿ç”¨ React çš„ DOM diffing ç®—æ³•è¿›è¡Œæœ‰æ•ˆæ›´æ–°ã€‚

å¹¶ä¸”`createRoot`ä¸ä¿®æ”¹å®¹å™¨èŠ‚ç‚¹ï¼ˆåªä¿®æ”¹å®¹å™¨çš„å­èŠ‚ç‚¹ï¼‰ã€‚å¯ä»¥åœ¨ä¸è¦†ç›–ç°æœ‰å­èŠ‚ç‚¹çš„æƒ…å†µä¸‹å°†ç»„ä»¶æ’å…¥ç°æœ‰ DOM èŠ‚ç‚¹ã€‚

å¦‚ï¼š

```js
import React, { StrictMode } from "react";
import { createRoot } from "react-dom/client";

const rootElement = document.getElementById("root");
const root = createRoot(rootElement);

root.render(
  <StrictMode>
    <Main />
  </StrictMode>
);
```

### hydrate

`hydrate`ï¼šæœåŠ¡ç«¯æ¸²æŸ“ç”¨`hydrate`ä¸ Â `render()`ç›¸åŒï¼Œä½†å®ƒç”¨äºåœ¨ Â `ReactDOMServer`Â  æ¸²æŸ“çš„å®¹å™¨ä¸­å¯¹ HTML çš„å†…å®¹è¿›è¡Œ hydrate æ“ä½œã€‚

```js
hydrate(element, container[, callback])
```

#### hydrateRoot()

`hydrate`åœ¨`React v18`ä¹Ÿè¢«æ›¿ä»£ä¸º`hydrateRoot()`

```js
hydrateRoot(container, element[, options])
```

### unmountComponentAtNode

**unmountComponentAtNode**ï¼šä» DOM ä¸­å¸è½½ç»„ä»¶ï¼Œä¼šå°†å…¶äº‹ä»¶å¤„ç†å™¨ï¼ˆevent handlersï¼‰å’Œ state ä¸€å¹¶æ¸…é™¤ã€‚å¦‚æœæŒ‡å®šå®¹å™¨ä¸Šæ²¡æœ‰å¯¹åº”å·²æŒ‚è½½çš„ç»„ä»¶ï¼Œè¿™ä¸ªå‡½æ•°ä»€ä¹ˆä¹Ÿä¸ä¼šåšã€‚å¦‚æœç»„ä»¶è¢«ç§»é™¤å°†ä¼šè¿”å› Â `true`ï¼Œå¦‚æœæ²¡æœ‰ç»„ä»¶å¯è¢«ç§»é™¤å°†ä¼šè¿”å› Â `false`ã€‚

ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š

```js
import { Button } from "antd-mobile";
import React, { Component } from "react";
import ReactDOM from "react-dom";

const Child = () => {
  return <div>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</div>;
};

class Index extends Component {
  constructor(props) {
    super(props);
    this.state = {
      number: 0,
    };
  }

  node = null;

  componentDidMount() {
    ReactDOM.render(<Child />, this.node); // åˆ›å»ºä¸€ä¸ªå®¹å™¨
  }

  render() {
    const { number } = this.state;
    console.log(number);
    return (
      <div style={{ padding: 20 }}>
        <div ref={(node) => (this.node = node)}></div>
        <Button
          color="primary"
          onClick={() => {
            const res = ReactDOM.unmountComponentAtNode(this.node);
            console.log(res);
          }}
        >
          å¸è½½
        </Button>
      </div>
    );
  }
}

export default Index;
```

æ•ˆæœï¼š

![img2.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0bf9d42f26414d759defe4c28d4a4fb4~tplv-k3u1fbpfcp-watermark.image?)

#### root.unmount()

`unmountComponentAtNode` åŒæ ·åœ¨`React 18`ä¸­è¢«æ›¿ä»£äº†ï¼Œæ›¿æ¢æˆäº†`createRoot`ä¸­çš„`unmount()`æ–¹æ³•

```jsx
const root = createRoot(container);
root.render(element);

root.unmount();
```

### findDOMNode

**findDOMNode**ï¼šç”¨äºè®¿é—®ç»„ä»¶`DOM`å…ƒç´ èŠ‚ç‚¹ï¼ˆåº”æ€¥æ–¹æ¡ˆï¼‰ï¼Œå®˜æ–¹æ¨èä½¿ç”¨`ref`

éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

- `findDOMNode`åªèƒ½ç”¨åˆ°`æŒ‚è½½`çš„ç»„ä»¶ä¸Š
- `findDOMNode`åªèƒ½ç”¨äºç±»ç»„ä»¶ï¼Œä¸èƒ½ç”¨äºå‡½æ•°å¼ç»„ä»¶
- å¦‚æœç»„ä»¶æ¸²æŸ“ä¸º`null`æˆ–è€…ä¸º`false`ï¼Œé‚£ä¹ˆ`findDOMNode`è¿”å›çš„å€¼ä¹Ÿæ˜¯`null`
- å¦‚æœæ˜¯å¤šä¸ªå­èŠ‚ç‚¹`Fragment`çš„æƒ…å†µï¼Œ`findDOMNode`ä¼šè¿”å›ç¬¬ä¸€ä¸ªéç©ºå­èŠ‚ç‚¹å¯¹åº”çš„ DOM èŠ‚ç‚¹ã€‚
- åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹è¿™ä¸ªæ–¹æ³•å·²ç»è¢«`å¼ƒç”¨`
  ä¸¾ä¸ªä¾‹å­ ğŸŒ°ï¼š

```js
import { Button } from "antd-mobile";
import React, { Component } from "react";
import ReactDOM from "react-dom";

class Index extends Component {
  render() {
    return (
      <div style={{ padding: 20 }}>
        <div>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æœæœ</div>
        <Button
          color="primary"
          onClick={() => {
            console.log(ReactDOM.findDOMNode(this));
          }}
        >
          è·å–å®¹å™¨
        </Button>
      </div>
    );
  }
}

export default Index;
```

æ•ˆæœï¼š
![img3.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d870212ce4a94f43ba040f384564d74d~tplv-k3u1fbpfcp-watermark.image?)

### unstable_batchedUpdates

**unstable_batchedUpdates** :å¯ç”¨äºæ‰‹åŠ¨æ‰¹é‡æ›´æ–° stateï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª`setState`åˆå¹¶ä¸ºä¸€ä¸ªæ›´æ–°è¯·æ±‚

é‚£ä¹ˆè¿™å—æ‰‹åŠ¨åˆå¹¶ï¼Œç”¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‘¢ï¼Ÿæ¥çœ‹çœ‹ä¸‹é¢çš„åœºæ™¯ï¼š

```jsx
import { Button } from "antd-mobile";
import React, { Component } from "react";
import ReactDOM from "react-dom";

class Index extends Component {
  constructor(props) {
    super(props);
    this.state = {
      number: 0,
    };
  }

  render() {
    const { number } = this.state;
    return (
      <div style={{ padding: 20 }}>
        <div>æ•°å­—: {number}</div>
        <Button
          color="primary"
          onClick={() => {
            this.setState({ number: this.state.number + 1 });
            console.log(this.state.number);
            this.setState({ number: this.state.number + 1 });
            console.log(this.state.number);
            this.setState({ number: this.state.number + 1 });
            console.log(this.state.number);
          }}
        >
          ç‚¹å‡»
        </Button>
      </div>
    );
  }
}

export default Index;
```

å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®åï¼Œä¸‰ä¸ªæ‰“å°ä¼šæ‰“å°å‡ºä»€ä¹ˆï¼Ÿ

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/965cbd1c7ee8476db0e62b8e27e34d7a~tplv-k3u1fbpfcp-watermark.image?)
æ­¤æ—¶çš„åœºæ™¯åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”æ¸²æŸ“ä¸€æ¬¡ï¼Œæ¸²æŸ“æ—¶ä¸º 1

é‚£ä¹ˆæˆ‘ä»¬æ‰“ç ´`React`çš„æœºåˆ¶ï¼Œæ¯”å¦‚è¯´ä½¿ç”¨`setTimeout`ç»•è¿‡ï¼Œå†æ¥çœ‹çœ‹ä¼šæ‰“å°å‡ºä»€ä¹ˆï¼š

```jsx
<Button
  color="primary"
  onClick={() => {
    setTimeout(() => {
      this.setState({ number: this.state.number + 1 });
      console.log(this.state.number);
      this.setState({ number: this.state.number + 1 });
      console.log(this.state.number);
      this.setState({ number: this.state.number + 1 });
      console.log(this.state.number);
    }, 100);
  }}
>
  ç‚¹å‡»
</Button>
```

æ­¤æ—¶å°±ä¼šè¿™æ ·ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/20a4768c591d4342a0275bc3a5f66768~tplv-k3u1fbpfcp-watermark.image?)

å› ä¸ºç»•è¿‡äº†äº‹ä»¶æœºåˆ¶ï¼Œæ­¤æ—¶å°±ä¼šæ¸²æŸ“ 3 æ¬¡ï¼Œå¹¶ä¸”æ¸²æŸ“çš„ç»“æœä¸º 3

é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨æƒ³åœ¨`setTimeout`å®ç°`React`çš„äº‹ä»¶æœºåˆ¶è¯¥æ€ä¹ˆåŠï¼Ÿå°±éœ€è¦ç”¨åˆ°`unstable_batchedUpdates`æ¥è§£å†³è¿™ç±»é—®é¢˜

```jsx
<Button
  color="primary"
  onClick={() => {
    setTimeout(() => {
      ReactDOM.unstable_batchedUpdates(() => {
        this.setState({ number: this.state.number + 1 });
        console.log(this.state.number);
        this.setState({ number: this.state.number + 1 });
        console.log(this.state.number);
        this.setState({ number: this.state.number + 1 });
        console.log(this.state.number);
      });
    }, 100);
  }}
>
  ç‚¹å‡»
</Button>
```

æ•ˆæœï¼š

![img4.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09a2ffb14bd5466d871292f271ca0eab~tplv-k3u1fbpfcp-watermark.image?)

## æœ€å

### å‚è€ƒæ–‡æ¡£

- [react å®˜æ–¹æ–‡æ¡£](https://reactjs.org/docs/react-api.html)
- [ã€ŒReact è¿›é˜¶ã€ React å…¨éƒ¨ Hooks ä½¿ç”¨å¤§å…¨ ï¼ˆåŒ…å« React v18 ç‰ˆæœ¬ ï¼‰](https://juejin.cn/post/7118937685653192735)
